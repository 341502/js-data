/*!
* js-data
* @version 3.0.0-alpha.10 - Homepage <http://www.js-data.io/>
* @author Jason Dobry <jason.dobry@gmail.com>
* @copyright (c) 2014-2015 Jason Dobry
* @license MIT <https://github.com/js-data/js-data/blob/master/LICENSE>
*
* @overview Robust framework-agnostic data store.
*/
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.JSData={})}(this,function(e){"use strict";function t(e){return fe(e)===oe}function n(e){return!!e&&"object"===("undefined"==typeof e?"undefined":X.typeof(e))&&e.constructor===Object}function r(e){return fe(e)===ae}function i(e){return fe(e)===te}function o(e){return"function"==typeof e||e&&fe(e)===re}function a(e){return de(e)||ge(e)}function u(e,t){if(t){for(var n=t.split("."),r=n.pop();t=n.shift();)if(e=e[t],null==e)return;return e[r]}}function s(e,t){for(var n=t.split("."),r=n.pop();t=n.shift();)if(e=e[t],null==e)return;e[r]=void 0,delete e[r]}function f(e,t){if(!t)return e;var n=t.split(".");return n.forEach(function(t){e[t]||(e[t]={}),e=e[t]}),e}function c(e,n,r){if(t(n))l(n,function(t,n){c(e,n,t)});else{var i=ye.exec(n);i?f(e,i[1])[i[2]]=r:e[n]=r}}function l(e,t,n){var r=Object.keys(e),i=r.length,o=void 0;for(o=0;i>o;o++)t.call(n,e[r[o]],r[o],e)}function d(e,t){return t&&l(t,function(e,t){var r=this[t];n(e)&&n(r)?d(r,e):this[t]=e},e),e}function h(e){return Promise.resolve(e)}function p(e){return Promise.reject(e)}function v(e,t){for(var n in e){var r=e[n];void 0===t[n]&&!o(r)&&n&&0!==n.indexOf("_")&&(t[n]=r)}}function g(e,t){if(!e||!t)return[];var n=[],r=void 0,i=void 0,o=e.length;for(i=0;o>i;i++)r=e[i],-1===n.indexOf(r)&&-1!==t.indexOf(r)&&n.push(r);return n}function m(e,t){l(t,function(t,n){void 0===e[n]&&(e[n]=t)})}function y(e,t){if(!t||!t.length)return!1;for(var n=void 0,r=0;r<t.length;r++)if("[object RegExp]"===fe(t[r])&&t[r].test(e)||t[r]===e)return n=e;return!!n}function b(e){return de(e)?JSON.parse(e):e}function x(e,n,i,o,a){if(n){if(e===n)throw new Error("Cannot copy! Source and destination are identical.");if(i=i||[],o=o||[],t(e)){var u=i.indexOf(e);if(-1!==u)return o[u];i.push(e),o.push(n)}var s=void 0;if(le(e)){var f=void 0;for(n.length=0,f=0;f<e.length;f++)s=x(e[f],null,i,o,a),t(e[f])&&(i.push(e[f]),o.push(s)),n.push(s)}else{le(n)?n.length=0:l(n,function(e,t){delete n[t]});for(var c in e)if(e.hasOwnProperty(c)){if(y(c,a))continue;s=x(e[c],null,i,o,a),t(e[c])&&(i.push(e[c]),o.push(s)),n[c]=s}}}else n=e,e&&(le(e)?n=x(e,[],i,o,a):ve(e)?n=new Date(e.getTime()):r(e)?(n=new RegExp(e.source,e.toString().match(/[^\/]*$/)[0]),n.lastIndex=e.lastIndex):t(e)&&(n=x(e,Object.create(Object.getPrototypeOf(e)),i,o,a)));return n}function A(e,t,n){return""+t.toUpperCase()+n.toLowerCase()}function _(e){return e.replace(Ae,"").replace(_e,A)}function O(e){return e.split(xe).map(_).join("")}function w(e){return e=O(e),e?e.charAt(0).toLowerCase()+e.slice(1):e}function k(e,t,n,r){e=e||this;var i={};t||n||(t=function(){return i},n=function(e){i=e}),Object.defineProperties(e,{on:{enumerable:!!r,value:function(e,r,i){t.call(this)||n.call(this,{});var o=t.call(this);o[e]=o[e]||[],o[e].push({f:r,c:i})}},off:{enumerable:!!r,value:function(e,r){var i=t.call(this),o=i[e];if(o)if(r){for(var a=0;a<o.length;a++)if(o[a].f===r){o.splice(a,1);break}}else o.splice(0,o.length);else n.call(this,{})}},emit:{enumerable:!!r,value:function(){for(var e=t.call(this)||{},n=arguments.length,r=Array(n),i=0;n>i;i++)r[i]=arguments[i];var o=r.shift(),a=e[o]||[],u=void 0;for(u=0;u<a.length;u++)a[u].f.apply(a[u].c,r);for(a=e.all||[],r.unshift(o),u=0;u<a.length;u++)a[u].f.apply(a[u].c,r)}}})}function I(e,t){for(t=e="";e++<36;t+=51*e&52?(15^e?8^Math.random()*(20^e?16:4):4).toString(16):"-");return t}function C(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function E(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==("undefined"==typeof t?"undefined":X.typeof(t))&&"function"!=typeof t?e:t}function j(e,t){l(t,function(e,n){t[n]={value:e}}),Object.defineProperties(e,t)}function R(e,t){var n=this,r=void 0;return e||(e={}),t||(t={}),e.hasOwnProperty("constructor")?(r=e.constructor,delete e.constructor):r=function(){C(this,r);for(var e=arguments.length,t=Array(e),n=0;e>n;n++)t[n]=arguments[n];var i=E(this,(r.__super__||Object.getPrototypeOf(r)).apply(this,t));return i},r.prototype=Object.create(n&&n.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(r,n):t.strictEs6Class?r.__proto__=n:l(n,function(e,t){r[t]=e}),Object.defineProperty(r,"__super__",{configurable:!0,value:n}),d(r.prototype,e),d(r,t),r}function P(e){C(this,P),this.collection=e,this.data=null}function M(e){return e.replace(ke,"\\$1")}function S(e,t,n){return e===t?0:(n&&(e=n(e),t=n(t)),null===e&&null===t?0:null===e?-1:null===t?1:t>e?-1:e>t?1:0)}function F(e,t,n){return e.splice(t,0,n),e}function L(e,t){return e.splice(t,1),e}function N(e,t,n){for(var r=0,i=e.length,o=void 0,a=void 0;i>r;){if(a=(r+i)/2|0,o=S(t,e[a],n),0===o)return{found:!0,index:a};0>o?i=a:r=a+1}return{found:!1,index:i}}function D(e,t){if(C(this,D),e||(e=[]),!le(e))throw new Error("fieldList must be an array.");t||(t={}),this.fieldList=e,this.fieldGetter=t.fieldGetter,this.hashCode=t.hashCode,this.isIndex=!0,this.keys=[],this.values=[]}function K(e,n){var r=this;C(r,K),t(e)&&!le(e)&&(n=e,e=[]),e||(e=[]),n||(n={}),r.model=n.model,r.model&&r.model.on("all",r._onModelEvent,r),r.autoPk=void 0===n.autoPk?!1:n.autoPk,r.idAttribute=n.idAttribute,r.modelOpts=n.modelOpts||{},r._listeners={},r.onConflict=n.onConflict||"merge";var i=r.modelId();r.index=new D([i],{hashCode:function(e){return u(e,i)}}),r.indexes={},r.added={},r.autoPks={},r.createIndex("addedTimestamps",["$"],{fieldGetter:function(e){return r.added[u(e,i)]}}),e.forEach(function(e){r.index.insertRecord(e),e&&o(e.on)&&e.on("all",r._onModelEvent,r)})}function U(e,t,n){function r(){var n={name:t};return de(t)?o(e.getModel)?e.getModel(t)||n:n:t}function i(){return n.localField||w(r().name)}function a(){return n.foreignKey||n.localKey||w(r().name)+"Id"}n||(n={});var s={enumerable:void 0!==n.enumerable?!!n.enumerable:!1,get:function(){return this._get("links."+i())},set:function(e){return e?(this._set("links."+i(),e),c(this,a(),e[r().idAttribute]),u(this,i())):void 0}},f=s.get,l=s.set;return n.get&&(s.get=function(){var t=this;return n.get(e,r(),this,function(){return f.call(t)})},delete s.writable),n.set&&(s.set=function(t){var i=this;return n.set(e,r(),this,t,function(e){return l.call(i,void 0===e?t:e)})},delete s.writable),s.get&&(s.set||(s.set=function(){})),Object.defineProperty(e.prototype,i(),s),e.relationList||(e.relationList=[]),e.relationFields||(e.relationFields=[]),n.type="belongsTo",n.name=e.name,n.relation=t.name,n.Relation=t,n.getRelation=r,n.getLocalField=i,n.getForeignKey=a,e.relationList.push(n),e.relationFields.push(i()),e}function T(e,t){return function(n){return n.dbg(je,e,t),U(n,e,t)}}function J(e){var t=arguments.length<=1||void 0===arguments[1]?!0:arguments[1];return e=e||{},function(n){return l(e,function(e,r){(void 0===n[r]||t)&&(n[r]=x(e))}),n}}function q(e,t,n){function r(){var n={name:t};return de(t)?o(e.getModel)?e.getModel(t)||n:n:t}function i(){return n.localField||w(r().name)+"Collection"}n||(n={});var a=n.foreignKey,s=n.localKeys,f=n.foreignKeys;a||s||f||(a=n.foreignKey=w(e.name)+"Id");var l={enumerable:void 0!==n.enumerable?!!n.enumerable:!1,get:function(){return this._get("links."+i())},set:function(t){var n=this;if(t)return this._set("links."+i(),t),t&&t.length&&!function(){var i=u(n,e.idAttribute);a?t.forEach(function(e){c(e,a,i)}):s?!function(){var e=[];t.forEach(function(t){e.push(u(t,r().idAttribute))}),c(n,s,e)}():f&&t.forEach(function(e){var t=u(e,f);t?-1===t.indexOf(i)&&t.push(i):c(e,f,[i])})}(),u(this,i())}},d=l.get,h=l.set;return n.get&&(l.get=function(){var t=this;return n.get(e,r(),this,function(){return d.call(t)})}),n.set&&(l.set=function(t){var i=this;return n.set(e,r(),this,t,function(e){return h.call(i,void 0===e?t:e)})}),Object.defineProperty(e.prototype,i(),l),e.relationList||(e.relationList=[]),e.relationFields||(e.relationFields=[]),n.type="hasMany",n.name=e.name,n.relation=r().name,n.Relation=r(),n.getRelation=r,n.getLocalField=i,e.relationList.push(n),e.relationFields.push(i()),e}function z(e,t){return function(n){return n.dbg(Re,e,t),q(n,e,t)}}function $(e,t,n){function r(){var n={name:t};return de(t)?o(e.getModel)?e.getModel(t)||n:n:t}function i(){return n.localField||w(r().name)}function a(){return n.foreignKey||n.localKey||w(e.name)+"Id"}n||(n={});var s={enumerable:void 0!==n.enumerable?!!n.enumerable:!1,get:function(){return this._get("links."+i())},set:function(t){return t?(this._set("links."+i(),t),c(t,a(),u(this,e.idAttribute)),u(this,i())):void 0}};return n.get&&!function(){var r=s.get;s.get=function(){var i=this;return n.get(e,t,this,r?function(){for(var e=arguments.length,t=Array(e),n=0;e>n;n++)t[n]=arguments[n];return r.apply(i,t)}:void 0)}}(),n.set&&!function(){var r=s.set;s.set=function(i){var o=this;return n.set(e,t,this,i,r?function(){for(var e=arguments.length,t=Array(e),n=0;e>n;n++)t[n]=arguments[n];return r.apply(o,t)}:void 0)}}(),Object.defineProperty(e.prototype,i(),s),e.relationList||(e.relationList=[]),e.relationFields||(e.relationFields=[]),n.type="hasOne",n.name=e.name,n.relation=t.name,n.Relation=t,n.getRelation=r,n.getLocalField=i,n.getForeignKey=a,e.relationList.push(n),e.relationFields.push(i()),e}function B(e,t){return function(n){return n.dbg(Pe,"Model:",e,"opts:",t),$(n,e,t)}}function G(e,t,n){var r={enumerable:void 0!==n.enumerable?n.enumerable:!0};return r.get=function(){return this._get("props."+t)},r.set=function(e){var r=this,i=this._get,o=this._set,a=this._unset;return n.track&&!i("creating")&&!function(){var n=i("changing"),s=i("previous."+t),f=i("props."+t),c=i("changed");n||(c=[]);var l=c.indexOf(t);f!==e&&-1===l&&c.push(t),s!==e?o("changes."+t,e):(a("changes."+t),l>=0&&c.splice(l,1)),c.length||(n=!1,a("changing"),a("changed"),i("eventId")&&(clearTimeout(i("eventId")),a("eventId"))),!n&&c.length&&(o("changed",c),o("changing",!0),o("eventId",setTimeout(function(){if(a("changed"),a("eventId"),a("changing"),!i("silent")){var e=void 0;for(e=0;e<c.length;e++)r.emit("change:"+c[e],r,u(r,c[e]));r.emit("change",r,i("changes"))}a("silent")},0)))}(),o("props."+t,e),e},n.get&&(r.get?!function(){var e=r.get;r.get=function(){return n.get.call(this,e)}}():r.get=n.get),n.set&&(r.set?!function(){var e=r.set;r.set=function(t){return n.set.call(this,t,e)}}():r.set=n.set),r}function V(e){return e||(e={}),function(t){return t.dbg(Me,"opts:",e),t.schema||(t.schema={}),J(t.schema,e),l(e,function(e,n){var r=G(t,n,e);r.writable||Object.defineProperty(t.prototype,n,r)}),t}}function H(e,t,n){return n||(n={}),n.op=Se,function(r){r.dbg(Se,"name:",e,"adapter:",t,"opts:",n),r.getAdapters()[e]=t,(n===!0||n.default)&&(r.defaultAdapter=e)}}function Q(e,t){var n=this;C(n,Q),e||(e={}),t||(t={});var r={};Object.defineProperties(n,{_get:{value:function(e){return u(r,e)}},_set:{value:function(e,t){return c(r,e,t)}},_unset:{value:function(e){return s(r,e)}}}),n._set("creating",!0),t.noValidate&&n._set("noValidate",!0),m(n,e),n._unset("creating"),n._set("changes",{}),n._unset("noValidate"),n._set("previous",x(e))}function Z(e){var t=this;C(t,Z),e||(e={}),t.defaults={};for(var n in e)t.defaults[n]=e[n];t.models={},t.collections={}}function W(e){e||(e={}),m(this,e)}var X={};X.typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},X.defineProperty=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e};var Y=1/0,ee=1.7976931348623157e308,te="[object Boolean]",ne="[object Date]",re="[object Function]",ie="[object Number]",oe="[object Object]",ae="[object RegExp]",ue="[object String]",se=Object.prototype.toString,fe=function(e){return se.call(e)},ce=function(e){if(!e)return 0===e?e:0;if(e=+e,e===Y||e===-Y){var t=0>e?-1:1;return t*ee}var n=e%1;return e===e?n?e-n:e:0},le=Array.isArray,de=function(e){return"string"==typeof e||e&&"object"===("undefined"==typeof e?"undefined":X.typeof(e))&&fe(e)===ue},he=function(e){return null===e},pe=function(e){return void 0===e},ve=function(e){return e&&"object"===("undefined"==typeof e?"undefined":X.typeof(e))&&fe(e)===ne},ge=function(e){var t="undefined"==typeof e?"undefined":X.typeof(e);return"number"===t||e&&"object"===t&&fe(e)===ie},me=function(e){return fe(e)===ie&&e==ce(e)},ye=/^(.+)\.(.+)$/,be=JSON.stringify,xe=/\s+/,Ae=/[^A-Za-z]/g,_e=/(\w)(\w*)/g,Oe=Object.freeze({isArray:le,isObject:t,isRegExp:r,isString:de,isNull:he,isUndefined:pe,isDate:ve,isNumber:ge,isInteger:me,isBoolean:i,isFunction:o,isSorN:a,get:u,unset:s,set:c,forOwn:l,deepMixIn:d,resolve:h,reject:p,_:v,intersection:g,fillIn:m,isBlacklisted:y,fromJson:b,toJson:be,copy:x,pascalCase:O,camelCase:w,eventify:k,uuid:I,classCallCheck:C,possibleConstructorReturn:E,addHiddenPropsToTarget:j,extend:R}),we={skip:"",offset:"",where:"",limit:"",orderBy:"",sort:""},ke=/([.*+?^=!:${}()|[\]\/\\])/g,Ie=/%/g,Ce=/_/g;P.ops={"==":function(e,t){return e==t},"===":function(e,t){return e===t},"!=":function(e,t){return e!=t},"!==":function(e,t){return e!==t},">":function(e,t){return e>t},">=":function(e,t){return e>=t},"<":function(e,t){return t>e},"<=":function(e,t){return t>=e},isectEmpty:function(e,t){return!g(e||[],t||[]).length},isectNotEmpty:function(e,t){return g(e||[],t||[]).length},in:function(e,t){return-1!==t.indexOf(e)},notIn:function(e,t){return-1===t.indexOf(e)},contains:function(e,t){return-1!==(e||[]).indexOf(t)},notContains:function(e,t){return-1===(e||[]).indexOf(t)}},j(P.prototype,{compare:function(e,t,n,r){var i=e[t],o=u(n,i[0]),a=u(r,i[0]);return o&&de(o)&&(o=o.toUpperCase()),a&&de(a)&&(a=a.toUpperCase()),n||(n=null),r||(r=null),"DESC"===i[1]?o>a?-1:a>o?1:t<e.length-1?this.compare(e,t+1,n,r):0:a>o?-1:o>a?1:t<e.length-1?this.compare(e,t+1,n,r):0},evaluate:function(e,t,n){return P.ops[t]?P.ops[t](e,n):0===t.indexOf("like")?null!==this.like(n,t.substr(4)).exec(e):0===t.indexOf("notLike")?null===this.like(n,t.substr(7)).exec(e):void 0},like:function(e,t){return new RegExp("^"+M(e).replace(Ie,".*").replace(Ce,".")+"$",t)},getData:function(){return this.data||(this.data=this.collection.index.getAll()),this.data},between:function(e,t,n){n||(n={});var r=this.collection,i=n.index?r.indexes[n.index]:r.index;if(this.data)throw new Error("Cannot access index after first operation!");return this.data=i.between(e,t,n),this},get:function(){var e=arguments.length<=0||void 0===arguments[0]?[]:arguments[0],t=arguments[1];if(t||(t={}),this.data)throw new Error("Cannot access index after first operation!");if(e&&!le(e)&&(e=[e]),!e.length)return this.getData(),this;var n=this.collection,r=t.index?n.indexes[t.index]:n.index;return this.data=r.get(e),this},getAll:function(){var e=this,n={};if(this.data)throw new Error("Cannot access index after first operation!");for(var r=arguments.length,i=Array(r),o=0;r>o;o++)i[o]=arguments[o];if(!i.length||1===i.length&&t(i[0]))return this.getData(),this;i.length&&t(i[i.length-1])&&(n=i[i.length-1],i.pop());var a=this.collection,u=n.index?a.indexes[n.index]:a.index;return this.data=[],i.forEach(function(t){e.data=e.data.concat(u.get(t))}),this},filter:function(e,n){var r=this;return e||(e={}),r.getData(),t(e)?!function(){var n={};t(e.where)&&(n=e.where),l(e,function(e,t){t in we||t in n||(n[t]={"==":e})});var i=[],o=[],a=[];l(n,function(e,n){t(e)||(e={"==":e}),l(e,function(e,t){i.push(n),o.push(t),a.push(e)})}),i.length&&!function(){var e=void 0,t=i.length;r.data=r.data.filter(function(n){var s=!0,f=!0;for(e=0;t>e;e++){var c=o[e],l="|"===c.charAt(0);c=l?c.substr(1):c;var d=r.evaluate(u(n,i[e]),c,a[e]);void 0!==d&&(f=s?d:l?f||d:f&&d),s=!1}return f})}();var s=e.orderBy||e.sort;de(s)&&(s=[[s,"ASC"]]),le(s)||(s=null),s&&!function(){var e=0;s.forEach(function(e,t){de(e)&&(s[t]=[e,"ASC"])}),r.data.sort(function(t,n){return r.compare(s,e,t,n)})}(),ge(e.skip)?r.skip(e.skip):ge(e.offset)&&r.skip(e.offset),ge(e.limit)&&r.limit(e.limit)}():o(e)&&(r.data=r.data.filter(e,n)),r},skip:function(e){if(!ge(e))throw new TypeError("skip: Expected number but found "+("undefined"==typeof e?"undefined":X.typeof(e))+"!");var t=this.getData();return e<t.length?this.data=t.slice(e):this.data=[],this},limit:function(e){if(!ge(e))throw new TypeError("limit: Expected number but found "+("undefined"==typeof e?"undefined":X.typeof(e))+"!");var t=this.getData();return this.data=t.slice(0,Math.min(t.length,e)),this},forEach:function(e,t){return this.getData().forEach(e,t),this},map:function(e,t){return this.data=this.getData().map(e,t),this},mapCall:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;t>r;r++)n[r-1]=arguments[r];return this.data=this.getData().map(function(t){return t[e].apply(t,n)}),this},run:function(){var e=this.data;return this.data=null,e}});var Ee={">":1,">=":1,"<":1,"<=":1};j(D.prototype,{set:function(e,t){le(e)||(e=[e]);var n=e.shift()||null,r=N(this.keys,n);if(0===e.length)if(r.found){var i=N(this.values[r.index],t,this.hashCode);i.found||F(this.values[r.index],i.index,t)}else F(this.keys,r.index,n),F(this.values,r.index,[t]);else if(r.found)this.values[r.index].set(e,t);else{F(this.keys,r.index,n);var o=new D([],{hashCode:this.hashCode});o.set(e,t),F(this.values,r.index,o)}},get:function(e){le(e)||(e=[e]);var t=e.shift()||null,n=N(this.keys,t);return 0===e.length?n.found?this.values[n.index].isIndex?this.values[n.index].getAll():this.values[n.index]:[]:n.found?this.values[n.index].get(e):[]},getAll:function(){var e=[];return this.values.forEach(function(t){e=t.isIndex?e.concat(t.getAll()):e.concat(t)}),e},visitAll:function(e,t){this.values.forEach(function(n){n.isIndex?n.visitAll(e,t):n.forEach(e,t)})},query:function(e){var t=void 0,n=void 0;if(e[">"]?(t=e[">"],e.leftInclusive=!1):e[">="]&&(t=e[">="],e.leftInclusive=!0),e["<"]?(n=e["<"],e.rightInclusive=!1):e["<="]&&(n=e["<="],e.rightInclusive=!0),t.length!==n.length)throw new Error("Key arrays must be same length");var r={};return l(e,function(e,t){Ee[t]||(r[t]=e)}),this.between(t,n,r)},between:function(e,t){var n=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];le(e)||(e=[e]),le(t)||(t=[t]),m(n,{leftInclusive:!0,rightInclusive:!1,limit:void 0,offset:0});var r=this._between(e,t,n);return n.limit?r.slice(n.offset,n.limit+n.offset):r.slice(n.offset)},_between:function(e,t,n){var r=[],i=e.shift(),o=t.shift(),a=void 0;if(a=void 0!==i?N(this.keys,i):{found:!1,index:0},0===e.length){a.found&&n.leftInclusive===!1&&(a.index+=1);for(var u=a.index;u<this.keys.length;u+=1){if(void 0!==o)if(n.rightInclusive){if(this.keys[u]>o)break}else if(this.keys[u]>=o)break;if(r=this.values[u].isIndex?r.concat(this.values[u].getAll()):r.concat(this.values[u]),n.limit&&r.length>=n.limit+n.offset)break}}else for(var u=a.index;u<this.keys.length;u+=1){var s=this.keys[u];if(s>o)break;if(r=this.values[u].isIndex?s===i?r.concat(this.values[u]._between(x(e),t.map(function(){}),n)):s===o?r.concat(this.values[u]._between(e.map(function(){}),x(t),n)):r.concat(this.values[u].getAll()):r.concat(this.values[u]),n.limit&&r.length>=n.limit+n.offset)break}return n.limit?r.slice(0,n.limit+n.offset):r},peek:function(){return this.values.length?this.values[0].isIndex?this.values[0].peek():this.values[0]:[]},remove:function(e,t){le(e)||(e=[e]);var n=e.shift(),r=N(this.keys,n);if(0===e.length){if(r.found){var i=N(this.values[r.index],t,this.hashCode);i.found&&(L(this.values[r.index],i.index),0===this.values[r.index].length&&(L(this.keys,r.index),L(this.values,r.index)))}}else r.found&&this.values[r.index].delete(e,t)},clear:function(){this.keys=[],this.values=[]},insertRecord:function(e){var t=this.fieldList.map(function(t){return o(t)?t(e)||null:e[t]||null});this.set(t,e)},removeRecord:function(e){var t=this,n=void 0;return this.values.forEach(function(r,i){if(r.isIndex){if(r.removeRecord(e))return 0===r.keys.length&&(L(t.keys,i),L(t.values,i)),n=!0,!1}else{var o=N(r,e,t.hashCode);if(o.found)return L(r,o.index),0===r.length&&(L(t.keys,i),L(t.values,i)),n=!0,!1}}),n?e:void 0},updateRecord:function(e){this.removeRecord(e),this.insertRecord(e)}}),j(K.prototype,{_end:function(e,t){var n=this;return t.raw?(t.autoAdd&&(e.data=n.add(e.data,t)),e):(t.autoAdd&&(e=n.add(e,t)),e)},_onModelEvent:function(){this.emit.apply(this,arguments)},add:function(e,t){var n=this;t||(t={}),v(n,t),e=n.beforeAdd(e,t)||e;var r=!1,i=n.modelId(),s=n.model?n.model.relationList||[]:[],f=(new Date).getTime();le(e)||(e=[e],r=!0),e=e.map(function(e){var r=n.modelId(e),h=!1;if(!a(r)){if(!t.autoPk)throw new TypeError(i+": Expected string or number, found "+("undefined"==typeof r?"undefined":X.typeof(r))+"!");r=I(),c(e,i,r),h=!0}var p=n.get(r);if(e===p)return p;if(s.forEach(function(t){var i=t.getRelation();if(i.idAttribute){var a=i.idAttribute,s=t.foreignKey,f=u(e,t.getLocalField());if(o(t.add))t.add(n,t,e);else if(f&&t.add!==!1)if(le(f))f=f.map(function(e){if(!i.is(e))try{s&&c(e,s,r),e=i.createInstance(e)}catch(e){throw new Error("Failed to insert "+t.type+' relation: "'+t.relation+'"! '+e.message)}return e}),t.localKeys&&c(e,t.localKeys,f.map(function(e){return u(e,a)}));else if(!i.is(f))try{s&&c(f,t.foreignKey,r),f=i.createInstance(f)}catch(e){throw new Error("Failed to insert "+t.type+' relation: "'+t.relation+'"!')}c(e,t.localField,f)}}),p){var v=t.onConflict||n.onConflict;"merge"===v?d(p,e):"replace"===v&&(l(p,function(t,n){n===i||e.hasOwnProperty(n)||delete p[n]}),p.set(e)),e=p,n.updateIndexes(e)}else e=n.model?n.model.createInstance(e):e,n.index.insertRecord(e),l(n.indexes,function(t,n){t.insertRecord(e)}),e&&o(e.on)&&(e.on("all",n._onModelEvent,n),n.emit("add",e));return n.added[r]=f,h&&(n.autoPks[r]=e),e});var h=r?e.length?e[0]:void 0:e;return n.afterAdd(e,t,h)||h},afterAdd:function(){},afterRemove:function(){},afterRemoveAll:function(){},beforeAdd:function(){},beforeRemove:function(){},beforeRemoveAll:function(){},between:function(e,t,n){return this.query().between(e,t,n).run()},create:function(e,t){var n=this,r=n.modelId(e);return t||(t={}),m(t,n.modelOpts),n.model.create(e,t).then(function(e){return n.autoPks[r]&&n.remove(r),n._end(e,t)})},createIndex:function(e,t,n){var r=this;de(e)&&void 0===t&&(t=[e]),n||(n={}),n.hashCode=n.hashCode||function(e){return r.modelId(e)};var i=r.indexes[e]=new D(t,n);return r.index.visitAll(i.insertRecord,i),r},createMany:function(e,t){var n=this;return t||(t={}),m(t,n.modelOpts),n.model.createMany(e,t).then(function(r){return e.forEach(function(e){var t=n.modelId(e);n.autoPks[t]&&n.remove(t)}),n._end(r,t)})},destroy:function(e,t){var n=this;return t||(t={}),m(t,n.modelOpts),n.model.destroy(e,t).then(function(r){return t.raw?r.data=n.remove(e,t):r=n.remove(e,t),r})},destroyAll:function(e,t){var n=this;return t||(t={}),m(t,n.modelOpts),n.model.destroyAll(e,t).then(function(r){return t.raw?r.data=n.removeAll(e,t):r=n.removeAll(e,t),r})},filter:function(e,t){return this.query().filter(e,t).run()},find:function(e,t){var n=this;return t||(t={}),m(t,n.modelOpts),n.model.find(e,t).then(function(e){return n._end(e,t)})},findAll:function(e,t){var n=this;return t||(t={}),m(t,n.modelOpts),n.model.findAll(e,t).then(function(e){return n._end(e,t)})},forEach:function(e,t){this.index.visitAll(e,t)},get:function(e){var t=this.query().get(e).run();return t.length?t[0]:void 0},getAll:function(){var e;return(e=this.query()).getAll.apply(e,arguments).run()},getAutoPkItems:function(){var e=this;return e.getAll().filter(function(t){return e.autoPks[e.modelId(t)]})},limit:function(e){return this.query().limit(e).run()},map:function(e,t){var n=[];return this.index.visitAll(function(r){n.push(e.call(t,r))}),n},mapCall:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;t>r;r++)n[r-1]=arguments[r];var i=[];return this.index.visitAll(function(t){i.push(t[e].apply(t,n))}),i},modelId:function(e){var t=this;return e?u(e,t.modelId()):t.model?t.model.idAttribute:t.idAttribute||"id"},query:function(){return new P(this)},reduce:function(e,t){var n=this.getAll();return n.reduce(e,t)},remove:function(e,t){var n=this;t||(t={}),n.beforeRemove(e,t);var r=n.get(e);return r&&(delete n.added[e],delete n.autoPks[e],n.index.removeRecord(r),l(n.indexes,function(e,t){e.removeRecord(r)}),r&&o(r.off)&&(r.off("all",n._onModelEvent,n),n.emit("remove",r))),n.afterRemove(e,t,r)||r},removeAll:function(e,t){var n=this;t||(t={}),n.beforeRemoveAll(e,t);var r=n.filter(e);return r.forEach(function(e){n.remove(n.modelId(e))}),n.afterRemoveAll(e,t,r)||r},skip:function(e){return this.query().skip(e).run()},toJSON:function(e){return this.mapCall("toJSON",e)},update:function(e,t,n){var r=this;return n||(n={}),m(n,r.modelOpts),r.model.update(e,t,n).then(function(e){return r._end(e,n)})},updateAll:function(e,t,n){var r=this;return n||(n={}),m(n,r.modelOpts),r.model.updateAll(e,t,n).then(function(e){return r._end(e,n)})},updateIndex:function(e,t){t||(t={});var n=t.index?this.indexes[t.index]:this.index;n.updateRecord(e)},updateIndexes:function(e){var t=this;t.index.updateRecord(e),l(t.indexes,function(t,n){t.updateRecord(e)})},updateMany:function(e,t){var n=this;return t||(t={}),m(t,n.modelOpts),n.model.updateMany(e,t).then(function(e){return n._end(e,t)})}}),k(K.prototype,function(){return this._listeners},function(e){this._listeners=e});var je="belongsTo",Re="hasMany",Pe="hasOne",Me="setSchema",Se="registerAdapter",Fe=h,Le=function(){for(var e=arguments.length,t=Array(e),n=0;e>n;n++)t[n]=arguments[n];var r=this,i=t.pop();r.dbg.apply(r,[i.op].concat(t)),(i.notify||void 0===i.notify&&r.notify)&&setTimeout(function(){r.emit.apply(r,[i.op].concat(t))})};j(Q.prototype,{schema:function(e){var t=this.constructor.schema;return e?t[e]:t},create:function(e){return this.constructor.create(this,e)},beforeSave:function(){},save:function(e){var t=void 0,n=void 0,r=this,i=r.constructor;return e||(e={}),v(r,e),n=e.adapter=r.getAdapterName(e),t=e.op="beforeSave",Fe(r[t](e)).then(function(){return t=e.op="save",i.dbg(t,r,e),r.getAdapter(n)[t](i,r,e)}).then(function(n){return t=e.op="afterSave",Fe(r[t](n,e)).then(function(t){return n=t||n,e.raw?(r.set(n.data),n.data=r):r.set(n),i.end(n,e)})})},afterSave:function(){},beforeLoadRelations:function(){},loadRelations:function(e,t){var n=void 0,r=this,i=r.constructor,s=i.relationList||[];return e||(e=[]),t||(t={}),v(i,t),t.adapter=i.getAdapterName(t),n=t.op="beforeLoadRelations",Fe(r[n](e,t)).then(function(){return de(e)&&(e=[e]),n=t.op="loadRelations",i.dbg(n,r,e,t),Promise.all(s.map(function(e){if(o(e.load))return e.load(i,e,r,t);var n=void 0;if("hasMany"===e.type&&e.foreignKey)n=e.Relation.findAll(X.defineProperty({},e.foreignKey,u(r,i.idAttribute)),t);else if(e.foreignKey){var s=u(r,e.foreignKey);a(s)&&(n=e.Relation.find(s,t))}else e.localKeys?n=e.Relation.findAll(X.defineProperty({},e.Relation.idAttribute,{in:u(r,e.localKeys)}),t):e.foreignKeys&&(n=e.Relation.findAll(X.defineProperty({},e.Relation.idAttribute,{contains:u(r,i.idAttribute)}),t));return n&&(n=n.then(function(n){t.raw&&(n=n.data),c(r,e.localField,"hasOne"===e.type?n.length?n[0]:void 0:n)})),n}))}).then(function(){return n=t.op="afterLoadRelations",Fe(r[n](e,t)).then(function(){return r})})},afterLoadRelations:function(){},destroy:function(e){var t=this.constructor;return t.destroy(u(this,t.idAttribute),e)},get:function(e){return u(this,e)},set:function(e,n,r){var i=this;t(e)&&(r=n),r||(r={}),r.silent&&i._set("silent",!0),c(i,e,n),i._get("eventId")||i._unset("silent")},unset:function(e,t){t||(t={}),t.silent&&this._set("silent",!0),s(this,e),this._get("eventId")||this._unset("silent")},hashCode:function(){return u(this,this.constructor.idAttribute)},changes:function(e){return e?this._get("changes."+e):this._get("changes")},hasChanges:function(){return!!(this._get("changed")||[]).length},commit:function(){return this._unset("changed"),this._set("changes",{}),this._set("previous",x(this)),this},previous:function(e){return e?this._get("previous."+e):this._get("previous")},revert:function(e){var t=this,n=this._get("previous")||{};return e||(e={}),e.preserve||(e.preserve=[]),l(this,function(r,i){i!==t.constructor.idAttribute&&!n.hasOwnProperty(i)&&t.hasOwnProperty(i)&&-1===e.preserve.indexOf(i)&&delete t[i]}),l(n,function(n,r){-1===e.preserve.indexOf(r)&&(t[r]=n)}),this.commit(),this},toJSON:function(e){return this.constructor.toJSON(this,e)}}),m(Q,{_adapters:null,_adaptersOwner:null,_listeners:null,_listenersOwner:null,csp:!1,defaultAdapter:"http",debug:!1,idAttribute:"id",notify:!0,pojo:!1,relationsEnumerable:!1,raw:!1,upsert:!0,_events:function(e){return e?this._listeners=e:this._listenersOwner!==this&&(this._listeners={},this._listenersOwner=this),this._listeners},end:function(e,t){var n=this;if(t.raw&&v(t,e),!t.pojo){var r=t.raw?e.data:e;r=le(r)?r.map(function(e){return n.createInstance(e)}):n.createInstance(r),t.raw?e.data=r:e=r}return t.notify&&setTimeout(function(){n.emit(t.op,e,t)}),e},createInstance:function(e,t){var n=this;return e instanceof n?e:new n(e,t)},is:function(e,t){var n=this;return n.instanceClass&&!t?e instanceof n.instanceClass:e instanceof n},toJSON:function(e,t){var n=this;t||(t={});var r=e;if(n.is(e)){r={};for(var i in e)r[i]=e[i];n&&n.relationList&&t.with&&(de(t.with)&&(t.with=[t.with]),n.relationList.forEach(function(n){var i=void 0;-1!==t.with.indexOf(n.relation)?i=n.relation:-1!==t.with.indexOf(n.localField)&&(i=n.localField),i&&!function(){var o={with:t.with.slice()};o.with.splice(o.with.indexOf(i),1),o.with.forEach(function(e,t){e&&0===e.indexOf(i)&&e.length>=i.length&&"."===e[i.length]?o.with[t]=e.substr(i.length+1):o.with[t]=""});var a=u(e,n.localField);a&&(le(a)?c(r,n.localField,a.map(function(e){return n.Relation.toJSON(e,o)})):c(r,n.localField,n.Relation.toJSON(a,o)))}()}))}return r},getAdapter:function(e){this.dbg("getAdapter","name:",e);var t=this.getAdapterName(e);if(!t)throw new ReferenceError(t+" not found!");return this.getAdapters()[t]},getAdapterName:function(e){return e||(e={}),de(e)&&(e={adapter:e}),e.adapter||e.defaultAdapter},getAdapters:function(){if(this._adaptersOwner!==this){var e=this._adapters;this._adapters={},e&&m(this._adapters,e),this._adaptersOwner=this}return this._adapters},getSchema:function(){return this._schema},beforeCreate:Le,checkUpsertCreate:function(e,t){var n=this;return(t.upsert||void 0===t.upsert&&n.upsert)&&u(e,n.idAttribute)},create:function(e,t){var n=void 0,r=void 0,i=this;return e||(e={}),t||(t={}),i.checkUpsertCreate(e,t)?i.update(u(e,i.idAttribute),e,t):(v(i,t),r=t.adapter=i.getAdapterName(t),n=t.op="beforeCreate",Fe(i[n](e,t)).then(function(o){e=o||e,n=t.op="create";var a=i.toJSON(e,t);return i.dbg(n,a,t),i.getAdapter(r)[n](i,a,t)}).then(function(e){return n=t.op="afterCreate",Fe(i[n](e,t)).then(function(n){return e=n||e,i.end(e,t)})}))},afterCreate:Le,beforeCreateMany:Le,checkUpsertCreateMany:function(e,t){var n=this;return t.upsert||void 0===t.upsert&&n.upsert?e.reduce(function(e,t){return e&&u(t,n.idAttribute)},!0):void 0},createMany:function(e,t){var n=void 0,r=void 0,i=this;return e||(e=[]),t||(t={}),i.checkUpsertCreateMany(e,t)?i.updateMany(e,t):(v(i,t),r=t.adapter=i.getAdapterName(t),n=t.op="beforeCreateMany",Fe(i[n](e,t)).then(function(o){e=o||e,n=t.op="createMany";var a=e.map(function(e){return i.toJSON(e,t)});return i.dbg(n,a,t),i.getAdapter(r)[n](i,a,t)}).then(function(e){return n=t.op="afterCreateMany",Fe(i[n](e,t)).then(function(n){return e=n||e,i.end(e,t)})}))},afterCreateMany:Le,beforeFind:Le,find:function(e,t){var n=void 0,r=void 0,i=this;return t||(t={}),v(i,t),r=t.adapter=i.getAdapterName(t),n=t.op="beforeFind",Fe(i[n](e,t)).then(function(o){return e=void 0===o?e:o,n=t.op="find",i.dbg(n,e,t),i.getAdapter(r)[n](i,e,t)}).then(function(e){return n=t.op="afterFind",Fe(i[n](e,t)).then(function(n){return e=n||e,i.end(e,t)})})},afterFind:Le,beforeFindAll:Le,findAll:function(e,t){var n=void 0,r=void 0,i=this;return e||(e={}),t||(t={}),v(i,t),r=t.adapter=i.getAdapterName(t),n=t.op="beforeFindAll",Fe(i[n](e,t)).then(function(o){
return e=o||e,n=t.op="findAll",i.dbg(n,e,t),i.getAdapter(r)[n](i,e,t)}).then(function(r){return n=t.op="afterFindAll",Fe(i[n](r,e,t)).then(function(e){return r=e||r,i.end(r,t)})})},afterFindAll:Le,beforeUpdate:Le,update:function(e,t,n){var r=void 0,i=void 0,o=this;return t||(t={}),n||(n={}),v(o,n),i=n.adapter=o.getAdapterName(n),r=n.op="beforeUpdate",Fe(o[r](e,t,n)).then(function(a){t=a||t,r=n.op="update";var u=o.toJSON(t,n);return o.dbg(r,e,u,n),o.getAdapter(i)[r](o,e,u,n)}).then(function(t){return r=n.op="afterUpdate",Fe(o[r](e,t,n)).then(function(e){return t=e||t,o.end(t,n)})})},afterUpdate:Le,beforeUpdateMany:Le,updateMany:function(e,t){var n=void 0,r=void 0,i=this;return e||(e=[]),t||(t={}),v(i,t),r=t.adapter=i.getAdapterName(t),n=t.op="beforeUpdateMany",Fe(i[n](e,t)).then(function(o){e=o||e,n=t.op="updateMany";var a=e.map(function(e){return i.toJSON(e,t)});return i.dbg(n,a,t),i.getAdapter(r)[n](i,a,t)}).then(function(e){return n=t.op="afterUpdateMany",Fe(i[n](e,t)).then(function(n){return e=n||e,i.end(e,t)})})},afterUpdateMany:Le,beforeUpdateAll:Le,updateAll:function(e,t,n){var r=void 0,i=void 0,o=this;return e||(e={}),t||(t={}),n||(n={}),v(o,n),i=n.adapter=o.getAdapterName(n),r=n.op="beforeUpdateAll",Fe(o[r](e,t,n)).then(function(a){t=a||t,r=n.op="updateAll";var u=o.toJSON(t,n);return o.dbg(r,e,u,n),o.getAdapter(i)[r](o,e,u,n)}).then(function(t){return r=n.op="afterUpdateAll",Fe(o[r](e,t,n)).then(function(e){return t=e||t,o.end(t,n)})})},afterUpdateAll:Le,beforeDestroy:Le,destroy:function(e,t){var n=void 0,r=void 0,i=this;return t||(t={}),v(i,t),r=t.adapter=i.getAdapterName(t),n=t.op="beforeDestroy",Fe(i[n](e,t)).then(function(o){return e=void 0===o?e:o,n=t.op="destroy",i.dbg(n,e,t),i.getAdapter(r)[n](i,e,t)}).then(function(e){return n=t.op="afterDestroy",Fe(i[n](e,t)).then(function(n){return e=n||e,t.raw?(v(t,e),e):e})})},afterDestroy:Le,beforeDestroyAll:Le,destroyAll:function(e,t){var n=void 0,r=void 0,i=this;return e||(e={}),t||(t={}),v(i,t),r=t.adapter=i.getAdapterName(t),n=t.op="beforeDestroyAll",Fe(i[n](e,t)).then(function(o){return e=o||e,n=t.op="destroyAll",i.dbg(n,e,t),i.getAdapter(r)[n](i,e,t)}).then(function(r){return n=t.op="afterDestroyAll",Fe(i[n](r,e,t)).then(function(e){return r=e||r,t.raw?(v(t,r),r):r})})},afterDestroyAll:Le,log:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;t>r;r++)n[r-1]=arguments[r];if(e&&!n.length&&(n.push(e),e="debug"),"debug"!==e||this.debug){var i=e.toUpperCase()+": ("+this.name+")";if(console[e]){var o;(o=console)[e].apply(o,[i].concat(n))}else{var a;(a=console).log.apply(a,[i].concat(n))}}},dbg:function(){for(var e=arguments.length,t=Array(e),n=0;e>n;n++)t[n]=arguments[n];this.log.apply(this,["debug"].concat(t))},belongsTo:function(e,t){return T(e,t)(this)},hasMany:function(e,t){return z(e,t)(this)},hasOne:function(e,t){return B(e,t)(this)},setSchema:function(e){return V(e)(this)},configure:function(e){return J(e)(this)},registerAdapter:function(e,t,n){return H(e,t,n)(this)},extend:function(e,t){var n=this,r=void 0;n.dbg("extend","props:",e,"classProps:",t),e||(e={}),t||(t={});var i=e.initialize;if(delete e.initialize,e.hasOwnProperty("constructor"))r=e.constructor,delete e.constructor;else{if(!t.name)throw new TypeError("name: Expected string, found "+X.typeof(t.name)+"!");if(t.csp)r=function(){C(this,r);for(var e=arguments.length,t=Array(e),n=0;e>n;n++)t[n]=arguments[n];var o=E(this,(r.__super__||Object.getPrototypeOf(r)).apply(this,t));return i&&i.apply(o,t),o};else{var o=O(t.name),a="return function "+o+"() {\n                        classCallCheck(this, "+o+")\n                        for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {\n                          args[_key] = arguments[_key];\n                        }\n                        var _this = possibleConstructorReturn(this, ("+o+".__super__ || Object.getPrototypeOf("+o+")).apply(this, args));\n                        if (initialize) {\n                          initialize.apply(_this, arguments)\n                        }\n                        return _this\n                      }";r=new Function("classCallCheck","possibleConstructorReturn","Parent","initialize",a)(C,E,n,i)}}t.shortname=t.shortname||w(r.name||t.name),delete t.name;var u=t.schema;return delete t.schema,r.prototype=Object.create(n&&n.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(r,n):t.strictEs6Class?r.__proto__=n:l(n,function(e,t){r[t]=e}),Object.defineProperty(r,"__super__",{configurable:!0,value:n}),J(e)(r.prototype),J(t)(r),u&&V(u)(r),r}}),k(Q,function(){return this._events()},function(e){this._events(e)},!0),k(Q.prototype,function(){return this._get("events")},function(e){this._set("events",e)}),j(Z.prototype,{defineModel:function(e,n){var r=this;t(e)&&(n=e,e=n.name),n||(n={}),n.relations||(n.relations={}),m(n,r.defaults);var i=n.methods||{};delete n.methods;var o=r.models[n.extends],a=(o||Q).extend(i,n);return r.models[e]=a,a.getModel=function(e){return r.models[e]},l(n.relations,function(e,n){l(e,function(e,i){t(e)&&(e=[e]),e.forEach(function(e){var t=r.models[i]||i;return"belongsTo"===n?a.belongsTo(t,e):"hasOne"===n?a.hasOne(t,e):a.hasMany(t,e)})})}),a},defineCollection:function(e,t,n){var r=this;t||(t={}),de(t.model)&&(t.model=r.models[e]);var i=new(n||K)([],t);return r.collection[e]=i,i},model:function(e){return this.models[e]},collection:function(e){return this.collections[e]},registerAdapter:function(){for(var e=arguments.length,t=Array(e),n=0;e>n;n++)t[n]=arguments[n];l(this.models,function(e){e.registerAdapter.apply(e,t)})}}),Z.prototype.defineResource=Z.prototype.defineModel;var Ne={array:le,boolean:i,integer:me,null:he,number:ge,object:t,string:de},De={},Ke={},Ue=function(e,t){var n="";return e&&(n+=ge(e)?"["+e+"]":t?"."+e:""+e),n},Te=function(e){e||(e={});var t="",n=e.path||[];return n.forEach(function(e){t+=Ue(e,t)}),t+=Ue(e.prop,t)},Je=function(e,t,n){return{expected:t,actual:""+e,path:Te(n)}},qe=function(e,t,n,r){r.push(Je(e,t,n))},ze=function(e,t,n,r){var i=n[e];return t.length>i?Je(t.length,"length no more than "+i,r):void 0},$e=function(e,t,n,r){var i=n[e];return t.length<i?Je(t.length,"length no less than "+i,r):void 0},Be=function(e,t,n,r){return!pe(n[e])&&Ke[e](t,n,r)},Ge=function(e,t,n,r){var i=[];return e.forEach(function(e){i=i.concat(Be(e,t,n,r)||[])}),i.length?i:void 0},Ve=["enum","type","allOf","anyOf","oneOf","not"],He=["items","maxItems","minItems","uniqueItems"],Qe=["multipleOf","maximum","minimum"],Ze=["maxProperties","minProperties","required","properties","dependencies"],We=["maxLength","minLength","pattern"],Xe=function(e,t,n){return Ge(Ve,e,t,n)},Ye=function e(n,r,i){var a=[];i||(i={});var u=void 0,s=i.prop;if(!pe(r)){if(!t(r))throw new Error('Invalid schema at path: "'+i.path+'"');return pe(i.path)&&(i.path=[]),pe(i.prop)||(u=!0,i.path.push(i.prop),i.prop=void 0),r.extends&&(a=o(r.extends.validate)?a.concat(r.extends.validate(n,i)||[]):a.concat(e(n,r.extends,i)||[])),pe(n)?(r.required===!0&&qe(n,"a value",i,a),u&&(i.path.pop(),i.prop=s),a.length?a:void 0):(a=a.concat(Xe(n,r,i)||[]),u&&(i.path.pop(),i.prop=s),a.length?a:void 0)}};m(Ke,{allOf:function(e,t,n){var r=[];return t.allOf.forEach(function(t){r=r.concat(Ye(e,t,n)||[])}),r.length?void 0:r},anyOf:function(e,t,n){var r=!1,i=[];return t.anyOf.forEach(function(t){var o=Ye(e,t,n);o?i=i.concat(o):r=!0}),r?void 0:i},dependencies:function(e,t,n){},enum:function(e,t,n){var r=t.enum;return-1===r.indexOf(e)?Je(e,"one of ("+r.join(", ")+")",n):void 0},items:function e(t,n,r){r||(r={});for(var e=n.items,i=[],o=le(e),a=t.length,u=0;a>u;u++)o&&(e=n.items[u]),r.prop=u,i=i.concat(Ye(t[u],e,r)||[]);return i.length?i:void 0},maximum:function e(t,n,r){var e=n.maximum,i=n.exclusiveMaximum;return("undefined"==typeof t?"undefined":X.typeof(t))===("undefined"==typeof e?"undefined":X.typeof(e))&&(i?t>e:t>=e)?Je(t,"no more than "+e,r):void 0},maxItems:function(e,t,n){return ze("maxItems",e,t,n)},maxLength:function(e,t,n){return ze("maxLength",e,t,n)},maxProperties:function e(t,n,r){var e=n.maxProperties,i=Object.keys(t).length;return i>e?Je(i,"no more than "+e+" properties",r):void 0},minimum:function e(t,n,r){var e=n.minimum,i=n.exclusiveMinimum;return("undefined"==typeof t?"undefined":X.typeof(t))===("undefined"==typeof e?"undefined":X.typeof(e))&&(i?e>t:e>=t)?Je(t,"no less than "+e,r):void 0},minItems:function(e,t,n){return $e("minItems",e,t,n)},minLength:function(e,t,n){return $e("minLength",e,t,n)},minProperties:function e(t,n,r){var e=n.minProperties,i=Object.keys(t).length;return e>i?Je(i,"no more than "+e+" properties",r):void 0},multipleOf:function(e,t,n){},not:function(e,t,n){return Ye(e,t.not,n)?void 0:Je("succeeded","should have failed",n)},oneOf:function(e,t,n){var r=!1,i=[];return t.oneOf.forEach(function(t){var o=Ye(e,t,n);if(o)i=i.concat(o);else{if(r)return i=[Je("valid against more than one","valid against only one",n)],r=!1,!1;r=!0}}),r?void 0:i},pattern:function e(t,n,r){var e=n.pattern;return de(t)&&!t.match(e)?Je(t,e,r):void 0},properties:function e(n,r,i){i||(i={});var o=pe(r.additionalProperties)?!0:r.additionalProperties,a={},e=r.properties||{},u=r.patternProperties||{},s=[];l(n,function(e,t){a[t]=void 0}),l(e||{},function(e,t){pe(n[t])&&!pe(e.default)&&(n[t]=x(e.default)),i.prop=t,s=s.concat(Ye(n[t],e,i)||[]),delete a[t]}),l(u,function(e,t){l(a,function(r,o){o.match(t)&&(i.prop=o,s=s.concat(Ye(n[o],e,i)||[]),delete a[o])})});var f=Object.keys(a);return o===!1?f.length&&qe("extra fields: "+f.join(", "),"no extra fields",i,s):t(o)&&f.forEach(function(e){i.prop=e,s=s.concat(Ye(n[e],o,i)||[])}),s.length?s:void 0},required:function e(t,n,r){var e=n.required,i=[];return r.existingOnly||e.forEach(function(e){if(pe(u(t,e))){var n=r.prop;r.prop=e,qe(void 0,"a value",r,i),r.prop=n}}),i.length?i:void 0},type:function e(t,n,r){var e=n.type,i=void 0;if(de(e)&&(e=[e]),e.forEach(function(e){return Ne[e](t,n,r)?(i=e,!1):void 0}),!i)return Je(t?"undefined"==typeof t?"undefined":X.typeof(t):""+t,"one of ("+e.join(", ")+")",r);var o=De[i];return o?o(t,n,r):void 0},uniqueItems:function(e,t,n){if(e&&e.length&&t.uniqueItems){var r=e.length,i=void 0,o=void 0,a=void 0;for(o=r-1;o>0;o--)for(i=e[o],a=o-1;a>=0;a--)if(i===e[a])return Je(i,"no duplicates",n)}}}),m(De,{array:function(e,t,n){return Ge(He,e,t,n)},integer:function(e,t,n){return De.numeric(e,t,n)},number:function(e,t,n){return De.numeric(e,t,n)},numeric:function(e,t,n){return Ge(Qe,e,t,n)},object:function(e,t,n){return Ge(Ze,e,t,n)},string:function(e,t,n){return Ge(We,e,t,n)}}),W.prototype.validate=function(e,t){return Ye(e,this,t)};var et=Oe,tt={full:"<%= pkg.version %>",major:parseInt("<%= major %>",10),minor:parseInt("<%= minor %>",10),patch:parseInt("<%= patch %>",10),alpha:"<%= alpha %>",beta:"<%= beta %>"};e.utils=et,e.version=tt,e.Collection=K,e.Query=P,e.DS=Z,e.belongsTo=T,e.configure=J,e.hasMany=z,e.hasOne=B,e.setSchema=V,e.registerAdapter=H,e.Model=Q,e.types=Ne,e.typeGroupValidators=De,e.validationKeywords=Ke,e.validate=Ye,e.Schema=W});
//# sourceMappingURL=dist/js-data.min.map