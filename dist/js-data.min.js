/**
* @author Jason Dobry <jason.dobry@gmail.com>
* @file js-data.min.js
* @version 1.0.0-alpha.5-3 - Homepage <http://www.js-data.io/>
* @copyright (c) 2014 Jason Dobry
* @license MIT <https://github.com/js-data/js-data/blob/master/LICENSE>
*
* @overview Data store.
*/
!function(a){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=a();else if("function"==typeof define&&define.amd)define([],a);else{var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.JSData=a()}}(function(){var define,module,exports;return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(require,module,exports){!function(global){"use strict";function detectObjectObserve(){function a(a){b=a}if("function"!=typeof Object.observe||"function"!=typeof Array.observe)return!1;var b=[],c={},d=[];return Object.observe(c,a),Array.observe(d,a),c.id=1,c.id=2,delete c.id,d.push(1,2),d.length=0,Object.deliverChangeRecords(a),5!==b.length?!1:"add"!=b[0].type||"update"!=b[1].type||"delete"!=b[2].type||"splice"!=b[3].type||"splice"!=b[4].type?!1:(Object.unobserve(c,a),Array.unobserve(d,a),!0)}function detectEval(){if("undefined"!=typeof chrome&&chrome.app&&chrome.app.runtime)return!1;try{var a=new Function("","return true;");return a()}catch(b){return!1}}function dirtyCheck(a){for(var b=0;MAX_DIRTY_CHECK_CYCLES>b&&a.check_();)b++;return global.testingExposeCycleCount&&(global.dirtyCheckCycleCount=b),b>0}function objectIsEmpty(a){for(var b in a)return!1;return!0}function diffIsEmpty(a){return objectIsEmpty(a.added)&&objectIsEmpty(a.removed)&&objectIsEmpty(a.changed)}function diffObjectFromOldObject(a,b){var c={},d={},e={};for(var f in b){var g=a[f];(void 0===g||g!==b[f])&&(f in a?g!==b[f]&&(e[f]=g):d[f]=void 0)}for(var f in a)f in b||(c[f]=a[f]);return Array.isArray(a)&&a.length!==b.length&&(e.length=a.length),{added:c,removed:d,changed:e}}function runEOMTasks(){if(!eomTasks.length)return!1;for(var a=0;a<eomTasks.length;a++)eomTasks[a]();return eomTasks.length=0,!0}function newObservedObject(){function a(a){b&&b.state_===OPENED&&!d&&b.check_(a)}var b,c,d=!1,e=!0;return{open:function(c){if(b)throw Error("ObservedObject in use");e||Object.deliverChangeRecords(a),b=c,e=!1},observe:function(b,d){c=b,d?Array.observe(c,a):Object.observe(c,a)},deliver:function(b){d=b,Object.deliverChangeRecords(a),d=!1},close:function(){b=void 0,Object.unobserve(c,a),observedObjectCache.push(this)}}}function getObservedObject(a,b,c){var d=observedObjectCache.pop()||newObservedObject();return d.open(a),d.observe(b,c),d}function Observer(){this.state_=UNOPENED,this.callback_=void 0,this.target_=void 0,this.directObserver_=void 0,this.value_=void 0,this.id_=nextObserverId++}function addToAll(a){Observer._allObserversCount++,collectObservers&&allObservers.push(a)}function removeFromAll(){Observer._allObserversCount--}function ObjectObserver(a){Observer.call(this),this.value_=a,this.oldObject_=void 0}function diffObjectFromChangeRecords(a,b,c){for(var d={},e={},f=0;f<b.length;f++){var g=b[f];expectedRecordTypes[g.type]?(g.name in c||(c[g.name]=g.oldValue),"update"!=g.type&&("add"!=g.type?g.name in d?(delete d[g.name],delete c[g.name]):e[g.name]=!0:g.name in e?delete e[g.name]:d[g.name]=!0)):(console.error("Unknown changeRecord type: "+g.type),console.error(g))}for(var h in d)d[h]=a[h];for(var h in e)e[h]=void 0;var i={};for(var h in c)if(!(h in d||h in e)){var j=a[h];c[h]!==j&&(i[h]=j)}return{added:d,removed:e,changed:i}}var hasObserve=detectObjectObserve(),hasEval=detectEval(),createObject="__proto__"in{}?function(a){return a}:function(a){var b=a.__proto__;if(!b)return a;var c=Object.create(b);return Object.getOwnPropertyNames(a).forEach(function(b){Object.defineProperty(c,b,Object.getOwnPropertyDescriptor(a,b))}),c},MAX_DIRTY_CHECK_CYCLES=1e3,eomTasks=[],runEOM=hasObserve?function(){var a={pingPong:!0},b=!1;return Object.observe(a,function(){runEOMTasks(),b=!1}),function(c){eomTasks.push(c),b||(b=!0,a.pingPong=!a.pingPong)}}():function(){return function(a){eomTasks.push(a)}}(),observedObjectCache=[],UNOPENED=0,OPENED=1,CLOSED=2,nextObserverId=1;Observer.prototype={open:function(a,b){if(this.state_!=UNOPENED)throw Error("Observer has already been opened.");return addToAll(this),this.callback_=a,this.target_=b,this.connect_(),this.state_=OPENED,this.value_},close:function(){this.state_==OPENED&&(removeFromAll(this),this.disconnect_(),this.value_=void 0,this.callback_=void 0,this.target_=void 0,this.state_=CLOSED)},deliver:function(){this.state_==OPENED&&dirtyCheck(this)},report_:function(a){try{this.callback_.apply(this.target_,a)}catch(b){Observer._errorThrownDuringCallback=!0,console.error("Exception caught during observer callback: "+(b.stack||b))}},discardChanges:function(){return this.check_(void 0,!0),this.value_}};var collectObservers=!hasObserve,allObservers;Observer._allObserversCount=0,collectObservers&&(allObservers=[]);var runningMicrotaskCheckpoint=!1,hasDebugForceFullDelivery=hasObserve&&hasEval&&function(){try{return eval("%RunMicrotasks()"),!0}catch(ex){return!1}}();global.Platform=global.Platform||{},global.Platform.performMicrotaskCheckpoint=function(){if(!runningMicrotaskCheckpoint){if(hasDebugForceFullDelivery)return void eval("%RunMicrotasks()");if(collectObservers){runningMicrotaskCheckpoint=!0;var cycles=0,anyChanged,toCheck;do{cycles++,toCheck=allObservers,allObservers=[],anyChanged=!1;for(var i=0;i<toCheck.length;i++){var observer=toCheck[i];observer.state_==OPENED&&(observer.check_()&&(anyChanged=!0),allObservers.push(observer))}runEOMTasks()&&(anyChanged=!0)}while(MAX_DIRTY_CHECK_CYCLES>cycles&&anyChanged);global.testingExposeCycleCount&&(global.dirtyCheckCycleCount=cycles),runningMicrotaskCheckpoint=!1}}},collectObservers&&(global.Platform.clearObservers=function(){allObservers=[]}),ObjectObserver.prototype=createObject({__proto__:Observer.prototype,arrayObserve:!1,connect_:function(){hasObserve?this.directObserver_=getObservedObject(this,this.value_,this.arrayObserve):this.oldObject_=this.copyObject(this.value_)},copyObject:function(a){var b=Array.isArray(a)?[]:{};for(var c in a)b[c]=a[c];return Array.isArray(a)&&(b.length=a.length),b},check_:function(a){var b,c;if(hasObserve){if(!a)return!1;c={},b=diffObjectFromChangeRecords(this.value_,a,c)}else c=this.oldObject_,b=diffObjectFromOldObject(this.value_,this.oldObject_);return diffIsEmpty(b)?!1:(hasObserve||(this.oldObject_=this.copyObject(this.value_)),this.report_([b.added||{},b.removed||{},b.changed||{},function(a){return c[a]}]),!0)},disconnect_:function(){hasObserve?(this.directObserver_.close(),this.directObserver_=void 0):this.oldObject_=void 0},deliver:function(){this.state_==OPENED&&(hasObserve?this.directObserver_.deliver(!1):dirtyCheck(this))},discardChanges:function(){return this.directObserver_?this.directObserver_.deliver(!0):this.oldObject_=this.copyObject(this.value_),this.value_}});var observerSentinel={},expectedRecordTypes={add:!0,update:!0,"delete":!0};global.Observer=Observer,global.Observer.runEOM_=runEOM,global.Observer.observerSentinel_=observerSentinel,global.Observer.hasObjectObserve=hasObserve,global.ObjectObserver=ObjectObserver}(exports)},{}],2:[function(a,b){"use strict";b.exports=function(a){function b(a){var b=new c(a),d=b.promise();return d.isRejected()?d:(b.setHowMany(1),b.setUnwrap(),b.init(),d)}var c=a._SomePromiseArray;a.any=function(a){return b(a)},a.prototype.any=function(){return b(this)}}},{}],3:[function(a,b){(function(c){"use strict";function d(){this._isTickUsed=!1,this._schedule=e,this._length=0,this._lateBuffer=new f(16),this._functionBuffer=new f(65536);var a=this;this.consumeFunctionBuffer=function(){a._consumeFunctionBuffer()}}var e=a("./schedule.js"),f=a("./queue.js"),g=a("./util.js").errorObj,h=a("./util.js").tryCatch1,i="undefined"!=typeof c?c:void 0;d.prototype.haveItemsQueued=function(){return this._length>0},d.prototype.invokeLater=function(a,b,c){void 0===i||null==i.domain||a.domain||(a=i.domain.bind(a)),this._lateBuffer.push(a,b,c),this._queueTick()},d.prototype.invoke=function(a,b,c){void 0===i||null==i.domain||a.domain||(a=i.domain.bind(a));var d=this._functionBuffer;d.push(a,b,c),this._length=d.length(),this._queueTick()},d.prototype._consumeFunctionBuffer=function(){for(var a=this._functionBuffer;a.length()>0;){var b=a.shift(),c=a.shift(),d=a.shift();b.call(c,d)}this._reset(),this._consumeLateBuffer()},d.prototype._consumeLateBuffer=function(){for(var a=this._lateBuffer;a.length()>0;){var b=a.shift(),c=a.shift(),d=a.shift(),e=h(b,c,d);if(e===g){if(this._queueTick(),null==b.domain)throw e.e;b.domain.emit("error",e.e)}}},d.prototype._queueTick=function(){this._isTickUsed||(this._schedule(this.consumeFunctionBuffer),this._isTickUsed=!0)},d.prototype._reset=function(){this._isTickUsed=!1,this._length=0},b.exports=new d}).call(this,a("_process"))},{"./queue.js":26,"./schedule.js":29,"./util.js":36,_process:38}],4:[function(a,b){"use strict";var c=a("./promise.js")();b.exports=c},{"./promise.js":21}],5:[function(a,b){"use strict";var c=Object.create;if(c){var d=c(null),e=c(null);d[" size"]=e[" size"]=0}b.exports=function(b){function c(a){return new Function("obj","                                             \n        'use strict'                                                         \n        var len = this.length;                                               \n        switch(len) {                                                        \n            case 1: return obj.methodName(this[0]);                          \n            case 2: return obj.methodName(this[0], this[1]);                 \n            case 3: return obj.methodName(this[0], this[1], this[2]);        \n            case 0: return obj.methodName();                                 \n            default: return obj.methodName.apply(obj, this);                 \n        }                                                                    \n        ".replace(/methodName/g,a))}function f(a){return new Function("obj","                                             \n        'use strict';                                                        \n        return obj.propertyName;                                             \n        ".replace("propertyName",a))}function g(a,b,c){var d=c[a];if("function"!=typeof d){if(!o(a))return null;if(d=b(a),c[a]=d,c[" size"]++,c[" size"]>512){for(var e=Object.keys(c),f=0;256>f;++f)delete c[e[f]];c[" size"]=e.length-256}}return d}function h(a){return g(a,c,d)}function i(a){return g(a,f,e)}function j(a){return a[this.pop()].apply(a,this)}function k(a){return a[this]}function l(a){return a[this]}var m=a("./util.js"),n=m.canEvaluate,o=m.isIdentifier;b.prototype.call=function(a){for(var b=arguments.length,c=new Array(b-1),d=1;b>d;++d)c[d-1]=arguments[d];if(n){var e=h(a);if(null!==e)return this._then(e,void 0,void 0,c,void 0)}return c.push(a),this._then(j,void 0,void 0,c,void 0)},b.prototype.get=function(a){var b,c="number"==typeof a;if(c)b=l;else if(n){var d=i(a);b=null!==d?d:k}else b=k;return this._then(b,void 0,void 0,a,void 0)}}},{"./util.js":36}],6:[function(a,b){"use strict";b.exports=function(b,c){var d=a("./errors.js"),e=d.canAttach,f=a("./async.js"),g=d.CancellationError;b.prototype._cancel=function(a){if(!this.isCancellable())return this;for(var b,c=this;void 0!==(b=c._cancellationParent)&&b.isCancellable();)c=b;this._unsetCancellable(),c._attachExtraTrace(a),c._rejectUnchecked(a)},b.prototype.cancel=function(a){return this.isCancellable()?(a=void 0!==a?e(a)?a:new Error(a+""):new g,f.invokeLater(this._cancel,this,a),this):this},b.prototype.cancellable=function(){return this._cancellable()?this:(this._setCancellable(),this._cancellationParent=void 0,this)},b.prototype.uncancellable=function(){var a=new b(c);return a._propagateFrom(this,6),a._follow(this),a._unsetCancellable(),a},b.prototype.fork=function(a,b,c){var d=this._then(a,b,c,void 0,void 0);return d._setCancellable(),d._cancellationParent=void 0,d}}},{"./async.js":3,"./errors.js":11}],7:[function(a,b){"use strict";b.exports=function(){function b(a){var b;if("function"==typeof a)b="[function "+(a.name||"anonymous")+"]";else{b=a.toString();var d=/\[object [a-zA-Z0-9$_]+\]/;if(d.test(b))try{var e=JSON.stringify(a);b=e}catch(f){}0===b.length&&(b="(empty array)")}return"(<"+c(b)+">, no stack trace)"}function c(a){var b=41;return a.length<b?a:a.substr(0,b-3)+"..."}function d(a,b){this.captureStackTrace(d,b)}var e=a("./util.js").inherits,f=a("./es5.js").defineProperty,g=new RegExp("\\b(?:[a-zA-Z0-9.]+\\$_\\w+|tryCatch(?:1|2|3|4|Apply)|new \\w*PromiseArray|\\w*PromiseArray\\.\\w*PromiseArray|setTimeout|CatchFilter\\$_\\w+|makeNodePromisified|processImmediate|process._tickCallback|nextTick|Async\\$\\w+)\\b"),h=null,i=null;e(d,Error),d.prototype.captureStackTrace=function(a,b){j(this,a,b)},d.possiblyUnhandledRejection=function(a){if("object"==typeof console){var b;if("object"==typeof a||"function"==typeof a){var c=a.stack;b="Possibly unhandled "+i(c,a)}else b="Possibly unhandled "+String(a);"function"==typeof console.error||"object"==typeof console.error?console.error(b):("function"==typeof console.log||"object"==typeof console.log)&&console.log(b)}},d.combine=function(a,b){for(var c=a.length-1,d=a[c],e=-1,f=b.length-1;f>=0;--f)if(b[f]===d){e=f;break}for(var f=e;f>=0;--f){var i=b[f];if(a[c]!==i)break;a.pop(),c--}a.push("From previous event:");for(var j=a.concat(b),k=[],f=0,l=j.length;l>f;++f)g.test(j[f])&&h.test(j[f])||f>0&&!h.test(j[f])&&"From previous event:"!==j[f]||k.push(j[f]);return k},d.protectErrorMessageNewlines=function(a){for(var b=0;b<a.length&&!h.test(a[b]);++b);if(!(1>=b)){for(var c=[],d=0;b>d;++d)c.push(a.shift());a.unshift(c.join("\x00"))}},d.isSupported=function(){return"function"==typeof j};var j=function k(){if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){h=/^\s*at\s*/,i=function(a,c){return"string"==typeof a?a:void 0!==c.name&&void 0!==c.message?c.name+". "+c.message:b(c)};var a=Error.captureStackTrace;return function(b,c){a(b,c)}}var c=new Error;if("string"==typeof c.stack&&"function"==typeof"".startsWith&&c.stack.startsWith("stackDetection@")&&"stackDetection"===k.name){f(Error,"stackTraceLimit",{writable:!0,enumerable:!1,configurable:!1,value:25}),h=/@/;var d=/[@\n]/;return i=function(a,c){return"string"==typeof a?c.name+". "+c.message+"\n"+a:void 0!==c.name&&void 0!==c.message?c.name+". "+c.message:b(c)},function(a){for(var b=(new Error).stack,c=b.split(d),e=c.length,f="",g=0;e>g;g+=2)f+=c[g],f+="@",f+=c[g+1],f+="\n";a.stack=f}}return i=function(a,c){return"string"==typeof a?a:"object"!=typeof c&&"function"!=typeof c||void 0===c.name||void 0===c.message?b(c):c.name+". "+c.message},null}();return d}},{"./es5.js":13,"./util.js":36}],8:[function(a,b){"use strict";b.exports=function(b){function c(a,b,c){this._instances=a,this._callback=b,this._promise=c}function d(a,b){var c={},d=g(a,c,b);if(d===h)return d;var e=i(c);return e.length?(h.e=new j("Catch filter must inherit from Error or be a simple predicate function"),h):d}var e=a("./util.js"),f=a("./errors.js"),g=e.tryCatch1,h=e.errorObj,i=a("./es5.js").keys,j=f.TypeError;return c.prototype.doFilter=function(a){for(var c=this._callback,e=this._promise,i=e._boundTo,j=0,k=this._instances.length;k>j;++j){var l=this._instances[j],m=l===Error||null!=l&&l.prototype instanceof Error;if(m&&a instanceof l){var n=g(c,i,a);return n===h?(b.e=n.e,b):n}if("function"==typeof l&&!m){var o=d(l,a);if(o===h){var p=f.canAttach(h.e)?h.e:new Error(h.e+"");this._promise._attachExtraTrace(p),a=h.e;break}if(o){var n=g(c,i,a);return n===h?(b.e=n.e,b):n}}}return b.e=a,b},c}},{"./errors.js":11,"./es5.js":13,"./util.js":36}],9:[function(a,b){"use strict";var c=a("./util.js"),d=c.isPrimitive,e=c.wrapsPrimitiveReceiver;b.exports=function(a){var b=function(){return this},c=function(){throw this},f=function(a,b){return 1===b?function(){throw a}:2===b?function(){return a}:void 0};a.prototype["return"]=a.prototype.thenReturn=function(a){return e&&d(a)?this._then(f(a,2),void 0,void 0,void 0,void 0):this._then(b,void 0,void 0,a,void 0)},a.prototype["throw"]=a.prototype.thenThrow=function(a){return e&&d(a)?this._then(f(a,1),void 0,void 0,void 0,void 0):this._then(c,void 0,void 0,a,void 0)}}},{"./util.js":36}],10:[function(a,b){"use strict";b.exports=function(a,b){var c=a.reduce;a.prototype.each=function(a){return c(this,a,null,b)},a.each=function(a,d){return c(a,d,null,b)}}},{}],11:[function(a,b){"use strict";function c(a){try{n(a,"isOperational",!0)}catch(b){}}function d(a){return null==a?!1:a instanceof h||a.isOperational===!0}function e(a){return a instanceof Error}function f(a){return e(a)}function g(a,b){function c(d){return this instanceof c?(this.message="string"==typeof d?d:b,this.name=a,void(Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor))):new c(d)}return m(c,Error),c}function h(a){this.name="OperationalError",this.message=a,this.cause=a,this.isOperational=!0,a instanceof Error?(this.message=a.message,this.stack=a.stack):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}var i,j,k=a("./es5.js").freeze,l=a("./util.js"),m=l.inherits,n=l.notEnumerableProp,o=g("CancellationError","cancellation error"),p=g("TimeoutError","timeout error"),q=g("AggregateError","aggregate error");try{i=TypeError,j=RangeError}catch(r){i=g("TypeError","type error"),j=g("RangeError","range error")}for(var s="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),t=0;t<s.length;++t)"function"==typeof Array.prototype[s[t]]&&(q.prototype[s[t]]=Array.prototype[s[t]]);q.prototype.length=0,q.prototype.isOperational=!0;var u=0;q.prototype.toString=function(){var a=Array(4*u+1).join(" "),b="\n"+a+"AggregateError of:\n";u++,a=Array(4*u+1).join(" ");for(var c=0;c<this.length;++c){for(var d=this[c]===this?"[Circular AggregateError]":this[c]+"",e=d.split("\n"),f=0;f<e.length;++f)e[f]=a+e[f];d=e.join("\n"),b+=d+"\n"}return u--,b},m(h,Error);var v="__BluebirdErrorTypes__",w=Error[v];w||(w=k({CancellationError:o,TimeoutError:p,OperationalError:h,RejectionError:h,AggregateError:q}),n(Error,v,w)),b.exports={Error:Error,TypeError:i,RangeError:j,CancellationError:w.CancellationError,OperationalError:w.OperationalError,TimeoutError:w.TimeoutError,AggregateError:w.AggregateError,originatesFromRejection:d,markAsOriginatingFromRejection:c,canAttach:f}},{"./es5.js":13,"./util.js":36}],12:[function(a,b){"use strict";b.exports=function(b){function c(a){var c=new d(a),e=b.rejected(c),f=e._peekContext();return null!=f&&f._attachExtraTrace(c),e}var d=a("./errors.js").TypeError;return c}},{"./errors.js":11}],13:[function(a,b){var c=function(){"use strict";return void 0===this}();if(c)b.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,keys:Object.keys,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:c};else{var d={}.hasOwnProperty,e={}.toString,f={}.constructor.prototype,g=function(a){var b=[];for(var c in a)d.call(a,c)&&b.push(c);return b},h=function(a,b,c){return a[b]=c.value,a},i=function(a){return a},j=function(a){try{return Object(a).constructor.prototype}catch(b){return f}},k=function(a){try{return"[object Array]"===e.call(a)}catch(b){return!1}};b.exports={isArray:k,keys:g,defineProperty:h,freeze:i,getPrototypeOf:j,isES5:c}}},{}],14:[function(a,b){"use strict";b.exports=function(a,b){var c=a.map;a.prototype.filter=function(a,d){return c(this,a,d,b)},a.filter=function(a,d,e){return c(a,d,e,b)}}},{}],15:[function(a,b){"use strict";b.exports=function(b,c,d){function e(){return this}function f(){throw this}function g(a){return function(){return a}}function h(a){return function(){throw a}}function i(a,b,c){var d;return d=m&&n(b)?c?g(b):h(b):c?e:f,a._then(d,o,void 0,b,void 0)}function j(a){var e=this.promise,f=this.handler,g=e._isBound()?f.call(e._boundTo):f();if(void 0!==g){var h=d(g,void 0);if(h instanceof b)return i(h,a,e.isFulfilled())}return e.isRejected()?(c.e=a,c):a}function k(a){var c=this.promise,e=this.handler,f=c._isBound()?e.call(c._boundTo,a):e(a);if(void 0!==f){var g=d(f,void 0);if(g instanceof b)return i(g,a,!0)}return a}var l=a("./util.js"),m=l.wrapsPrimitiveReceiver,n=l.isPrimitive,o=l.thrower;b.prototype._passThroughHandler=function(a,b){if("function"!=typeof a)return this.then();var c={promise:this,handler:a};return this._then(b?j:k,b?j:void 0,void 0,c,void 0)},b.prototype.lastly=b.prototype["finally"]=function(a){return this._passThroughHandler(a,!0)},b.prototype.tap=function(a){return this._passThroughHandler(a,!1)}}},{"./util.js":36}],16:[function(a,b){"use strict";b.exports=function(b,c,d,e){function f(a,c){for(var d=l,g=b,h=c.length,i=0;h>i;++i){var j=m(c[i],void 0,a);if(j===d)return g.reject(d.e);var k=e(j,f);if(k instanceof g)return k}return null}function g(a,c,e){var f=this._promise=new b(d);f._setTrace(void 0),this._generatorFunction=a,this._receiver=c,this._generator=void 0,this._yieldHandlers="function"==typeof e?[e].concat(n):n}var h=a("./errors.js"),i=h.TypeError,j=a("./util.js").deprecated,k=a("./util.js"),l=k.errorObj,m=k.tryCatch1,n=[];g.prototype.promise=function(){return this._promise},g.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._next(void 0)},g.prototype._continue=function(a){if(a===l){this._generator=void 0;var c=h.canAttach(a.e)?a.e:new Error(a.e+"");return this._promise._attachExtraTrace(c),void this._promise._reject(a.e,c)}var d=a.value;if(a.done===!0)this._generator=void 0,this._promise._tryFollow(d)||this._promise._fulfill(d);else{var g=e(d,void 0);if(!(g instanceof b)&&(g=f(g,this._yieldHandlers),null===g))return void this._throw(new i("A value was yielded that could not be treated as a promise"));g._then(this._next,this._throw,void 0,this,null)}},g.prototype._throw=function(a){h.canAttach(a)&&this._promise._attachExtraTrace(a),this._continue(m(this._generator["throw"],this._generator,a))},g.prototype._next=function(a){this._continue(m(this._generator.next,this._generator,a))},b.coroutine=function(a,b){if("function"!=typeof a)throw new i("generatorFunction must be a function");var c=Object(b).yieldHandler,d=g;return function(){var b=a.apply(this,arguments),e=new d(void 0,void 0,c);return e._generator=b,e._next(void 0),e.promise()}},b.coroutine.addYieldHandler=function(a){if("function"!=typeof a)throw new i("fn must be a function");n.push(a)},b.spawn=function(a){if(j("Promise.spawn is deprecated. Use Promise.coroutine instead."),"function"!=typeof a)return c("generatorFunction must be a function");var d=new g(a,this),e=d.promise();return d._run(b.spawn),e}}},{"./errors.js":11,"./util.js":36}],17:[function(a,b){"use strict";b.exports=function(b,c,d,e){function f(a){this._reject(a)}var g=a("./util.js"),h=g.canEvaluate,i=g.tryCatch1,j=g.errorObj;if(h){for(var k=function(a){return new Function("value","holder","                             \n            'use strict';                                                    \n            holder.pIndex = value;                                           \n            holder.checkFulfillment(this);                                   \n            ".replace(/Index/g,a))},l=function(a){for(var b=[],c=1;a>=c;++c)b.push("holder.p"+c);return new Function("holder","                                      \n            'use strict';                                                    \n            var callback = holder.fn;                                        \n            return callback(values);                                         \n            ".replace(/values/g,b.join(", ")))},m=[],n=[void 0],o=1;5>=o;++o)m.push(k(o)),n.push(l(o));var p=function(a,b){this.p1=this.p2=this.p3=this.p4=this.p5=null,this.fn=b,this.total=a,this.now=0};p.prototype.callers=n,p.prototype.checkFulfillment=function(a){var b=this.now;b++;var c=this.total;if(b>=c){var d=this.callers[c],e=i(d,void 0,this);e===j?a._rejectUnchecked(e.e):a._tryFollow(e)||a._fulfillUnchecked(e)}else this.now=b}}b.join=function(){var a,g=arguments.length-1;if(g>0&&"function"==typeof arguments[g]&&(a=arguments[g],6>g&&h)){var i=new b(e);i._setTrace(void 0);for(var j=new p(g,a),k=m,l=0;g>l;++l){var n=d(arguments[l],void 0);n instanceof b?n.isPending()?n._then(k[l],f,void 0,i,j):n.isFulfilled()?k[l].call(i,n._settledValue,j):(i._reject(n._settledValue),n._unsetRejectionIsUnhandled()):k[l].call(i,n,j)}return i}for(var o=arguments.length,q=new Array(o),r=0;o>r;++r)q[r]=arguments[r];var i=new c(q).promise();return void 0!==a?i.spread(a):i}}},{"./util.js":36}],18:[function(a,b){"use strict";b.exports=function(b,c,d,e,f){function g(a,b,c,d){this.constructor$(a),this._callback=b,this._preservedValues=d===f?new Array(this.length()):null,this._limit=c,this._inFlight=0,this._queue=c>=1?[]:m,this._init$(void 0,-2)}function h(a,b,c,d){var e="object"==typeof c&&null!==c?c.concurrency:0;return e="number"==typeof e&&isFinite(e)&&e>=1?e:0,new g(a,b,e,d)}var i=a("./util.js"),j=i.tryCatch3,k=i.errorObj,l={},m=[];i.inherits(g,c),g.prototype._init=function(){},g.prototype._promiseFulfilled=function(a,c){var d=this._values;if(null!==d){var f=this.length(),g=this._preservedValues,h=this._limit;if(d[c]===l){if(d[c]=a,h>=1&&(this._inFlight--,this._drainQueue(),this._isResolved()))return}else{if(h>=1&&this._inFlight>=h)return d[c]=a,void this._queue.push(c);null!==g&&(g[c]=a);var i=this._callback,m=this._promise._boundTo,n=j(i,m,a,c,f);if(n===k)return this._reject(n.e);var o=e(n,void 0);if(o instanceof b){if(o.isPending())return h>=1&&this._inFlight++,d[c]=l,o._proxyPromiseArray(this,c);if(!o.isFulfilled())return o._unsetRejectionIsUnhandled(),this._reject(o.reason());n=o.value()}d[c]=n}var p=++this._totalResolved;p>=f&&(null!==g?this._filter(d,g):this._resolve(d))}},g.prototype._drainQueue=function(){for(var a=this._queue,b=this._limit,c=this._values;a.length>0&&this._inFlight<b;){var d=a.pop();this._promiseFulfilled(c[d],d)}},g.prototype._filter=function(a,b){for(var c=b.length,d=new Array(c),e=0,f=0;c>f;++f)a[f]&&(d[e++]=b[f]);d.length=e,this._resolve(d)},g.prototype.preservedValues=function(){return this._preservedValues},b.prototype.map=function(a,b){return"function"!=typeof a?d("fn must be a function"):h(this,a,b,null).promise()},b.map=function(a,b,c,e){return"function"!=typeof b?d("fn must be a function"):h(a,b,c,e).promise()}}},{"./util.js":36}],19:[function(a,b){"use strict";b.exports=function(b){function c(a){throw a}function d(a,b){if(!g.isArray(a))return e(a,b);var d=g.tryCatchApply(this,[null].concat(a),b);d===k&&h.invokeLater(c,void 0,d.e)}function e(a,b){var d=this,e=void 0===a?j(d,b,null):i(d,b,null,a);e===k&&h.invokeLater(c,void 0,e.e)}function f(a,b){var d=this,e=j(d,b,a);e===k&&h.invokeLater(c,void 0,e.e)}var g=a("./util.js"),h=a("./async.js"),i=g.tryCatch2,j=g.tryCatch1,k=g.errorObj;b.prototype.nodeify=function(a,b){if("function"==typeof a){var c=e;void 0!==b&&Object(b).spread&&(c=d),this._then(c,f,void 0,a,this._boundTo)}return this}}},{"./async.js":3,"./util.js":36}],20:[function(a,b){"use strict";b.exports=function(b,c){var d=a("./util.js"),e=a("./async.js"),f=a("./errors.js"),g=d.tryCatch1,h=d.errorObj;b.prototype.progressed=function(a){return this._then(void 0,void 0,a,void 0,void 0)},b.prototype._progress=function(a){this._isFollowingOrFulfilledOrRejected()||this._progressUnchecked(a)},b.prototype._clearFirstHandlerData$Base=b.prototype._clearFirstHandlerData,b.prototype._clearFirstHandlerData=function(){this._clearFirstHandlerData$Base(),this._progressHandler0=void 0},b.prototype._progressHandlerAt=function(a){return 0===a?this._progressHandler0:this[(a<<2)+a-5+2]},b.prototype._doProgressWith=function(a){var c=a.value,d=a.handler,e=a.promise,i=a.receiver,j=g(d,i,c);if(j===h){if(null!=j.e&&"StopProgressPropagation"!==j.e.name){var k=f.canAttach(j.e)?j.e:new Error(j.e+"");e._attachExtraTrace(k),e._progress(j.e)}}else j instanceof b?j._then(e._progress,null,null,e,void 0):e._progress(j)},b.prototype._progressUnchecked=function(a){if(this.isPending())for(var d=this._length(),f=this._progress,g=0;d>g;g++){var h=this._progressHandlerAt(g),i=this._promiseAt(g);if(i instanceof b)"function"==typeof h?e.invoke(this._doProgressWith,this,{handler:h,promise:i,receiver:this._receiverAt(g),value:a}):e.invoke(f,i,a);else{var j=this._receiverAt(g);"function"==typeof h?h.call(j,a,i):j instanceof b&&j._isProxied()?j._progressUnchecked(a):j instanceof c&&j._promiseProgressed(a,i)}}}}},{"./async.js":3,"./errors.js":11,"./util.js":36}],21:[function(a,b){(function(c){"use strict";function d(a){try{Promise===a&&(Promise=e)}catch(b){}return a}var e;"undefined"!=typeof Promise&&(e=Promise),b.exports=function(){function b(a){if("function"!=typeof a)throw new x("the promise constructor requires a resolver function");if(this.constructor!==b)throw new x("the promise constructor cannot be invoked directly");this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,this._settledValue=void 0,this._boundTo=void 0,a!==j&&this._resolveFromResolver(a)}function e(a){return a[0]}function f(){return new b.PromiseInspection(this)}var g=a("./util.js"),h=a("./async.js"),i=a("./errors.js"),j=function(){},k={},l={e:null},m=a("./thenables.js")(b,j),n=a("./promise_array.js")(b,j,m),o=a("./captured_trace.js")(),p=a("./catch_filter.js")(l),q=a("./promise_resolver.js"),r=g.isArray,s=g.errorObj,t=g.tryCatch1,u=g.tryCatch2,v=g.tryCatchApply,w=i.RangeError,x=i.TypeError,y=i.CancellationError,z=i.TimeoutError,A=i.OperationalError,B=i.originatesFromRejection,C=i.markAsOriginatingFromRejection,D=i.canAttach,E=g.thrower,F=a("./errors_api_rejection")(b),G=function(){return new x("circular promise resolution chain")};b.prototype.bind=function(a){var c=m(a,void 0),d=new b(j);if(c instanceof b){var f=c.then(function(a){d._setBoundTo(a)}),g=b.all([this,f]).then(e);d._follow(g)}else d._follow(this),d._setBoundTo(a);return d._propagateFrom(this,3),d},b.prototype.toString=function(){return"[object Promise]"},b.prototype.caught=b.prototype["catch"]=function(a){var c=arguments.length;if(c>1){var d,e=new Array(c-1),f=0;for(d=0;c-1>d;++d){var g=arguments[d];if("function"!=typeof g){var h=new x("A catch filter must be an error constructor or a filter function");return this._attachExtraTrace(h),b.reject(h)}e[f++]=g}e.length=f,a=arguments[d],this._resetTrace();var i=new p(e,a,this);return this._then(void 0,i.doFilter,void 0,i,void 0)}return this._then(void 0,a,void 0,void 0,void 0)},b.prototype.reflect=function(){return this._then(f,f,void 0,this,void 0)},b.prototype.then=function(a,b,c){return this._then(a,b,c,void 0,void 0)},b.prototype.done=function(a,b,c){var d=this._then(a,b,c,void 0,void 0);d._setIsFinal()},b.prototype.spread=function(a,b){return this._then(a,b,void 0,k,void 0)},b.prototype.isCancellable=function(){return!this.isResolved()&&this._cancellable()},b.prototype.toJSON=function(){var a={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(a.fulfillmentValue=this._settledValue,a.isFulfilled=!0):this.isRejected()&&(a.rejectionReason=this._settledValue,a.isRejected=!0),a},b.prototype.all=function(){return new n(this).promise()},b.is=function(a){return a instanceof b},b.all=function(a){return new n(a).promise()},b.prototype.error=function(a){return this.caught(B,a)},b.prototype._resolveFromSyncValue=function(a){if(a===s){this._cleanValues(),this._setRejected();var c=a.e;this._settledValue=c,this._tryAttachExtraTrace(c),this._ensurePossibleRejectionHandled()}else{var d=m(a,void 0);d instanceof b?this._follow(d):(this._cleanValues(),this._setFulfilled(),this._settledValue=a)}},b.method=function(a){if("function"!=typeof a)throw new x("fn must be a function");return function(){var c;switch(arguments.length){case 0:c=t(a,this,void 0);
break;case 1:c=t(a,this,arguments[0]);break;case 2:c=u(a,this,arguments[0],arguments[1]);break;default:for(var d=arguments.length,e=new Array(d),f=0;d>f;++f)e[f]=arguments[f];c=v(a,e,this)}var g=new b(j);return g._setTrace(void 0),g._resolveFromSyncValue(c),g}},b.attempt=b["try"]=function(a,c,d){if("function"!=typeof a)return F("fn must be a function");var e=r(c)?v(a,c,d):t(a,d,c),f=new b(j);return f._setTrace(void 0),f._resolveFromSyncValue(e),f},b.defer=b.pending=function(){var a=new b(j);return a._setTrace(void 0),new q(a)},b.bind=function(a){var c=m(a,void 0),d=new b(j);if(d._setTrace(void 0),c instanceof b){var e=c.then(function(a){d._setBoundTo(a)});d._follow(e)}else d._setBoundTo(a),d._setFulfilled();return d},b.cast=function(a){var c=m(a,void 0);if(!(c instanceof b)){var d=c;c=new b(j),c._setTrace(void 0),c._setFulfilled(),c._cleanValues(),c._settledValue=d}return c},b.resolve=b.fulfilled=b.cast,b.reject=b.rejected=function(a){var c=new b(j);if(c._setTrace(void 0),C(a),c._cleanValues(),c._setRejected(),c._settledValue=a,!D(a)){var d=new Error(a+"");c._setCarriedStackTrace(d)}return c._ensurePossibleRejectionHandled(),c},b.onPossiblyUnhandledRejection=function(a){o.possiblyUnhandledRejection="function"==typeof a?a:void 0};var H;b.onUnhandledRejectionHandled=function(a){H="function"==typeof a?a:void 0};var I=!1||!("undefined"==typeof c||"string"!=typeof c.execPath||"object"!=typeof c.env||!c.env.BLUEBIRD_DEBUG&&"development"!==c.env.NODE_ENV);b.longStackTraces=function(){if(h.haveItemsQueued()&&I===!1)throw new Error("cannot enable long stack traces after promises have been created");I=o.isSupported()},b.hasLongStackTraces=function(){return I&&o.isSupported()},b.prototype._then=function(a,c,d,e,f){var g=void 0!==f,i=g?f:new b(j);if(!g){if(I){var k=this._peekContext()===this._traceParent;i._traceParent=k?this._traceParent:this}i._propagateFrom(this,7)}var l=this._addCallbacks(a,c,d,i,e);return this.isResolved()&&h.invoke(this._queueSettleAt,this,l),i},b.prototype._length=function(){return 262143&this._bitField},b.prototype._isFollowingOrFulfilledOrRejected=function(){return(939524096&this._bitField)>0},b.prototype._isFollowing=function(){return 536870912===(536870912&this._bitField)},b.prototype._setLength=function(a){this._bitField=-262144&this._bitField|262143&a},b.prototype._setFulfilled=function(){this._bitField=268435456|this._bitField},b.prototype._setRejected=function(){this._bitField=134217728|this._bitField},b.prototype._setFollowing=function(){this._bitField=536870912|this._bitField},b.prototype._setIsFinal=function(){this._bitField=33554432|this._bitField},b.prototype._isFinal=function(){return(33554432&this._bitField)>0},b.prototype._cancellable=function(){return(67108864&this._bitField)>0},b.prototype._setCancellable=function(){this._bitField=67108864|this._bitField},b.prototype._unsetCancellable=function(){this._bitField=-67108865&this._bitField},b.prototype._setRejectionIsUnhandled=function(){this._bitField=2097152|this._bitField},b.prototype._unsetRejectionIsUnhandled=function(){this._bitField=-2097153&this._bitField,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},b.prototype._isRejectionUnhandled=function(){return(2097152&this._bitField)>0},b.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=524288|this._bitField},b.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=-524289&this._bitField},b.prototype._isUnhandledRejectionNotified=function(){return(524288&this._bitField)>0},b.prototype._setCarriedStackTrace=function(a){this._bitField=1048576|this._bitField,this._fulfillmentHandler0=a},b.prototype._unsetCarriedStackTrace=function(){this._bitField=-1048577&this._bitField,this._fulfillmentHandler0=void 0},b.prototype._isCarryingStackTrace=function(){return(1048576&this._bitField)>0},b.prototype._getCarriedStackTrace=function(){return this._isCarryingStackTrace()?this._fulfillmentHandler0:void 0},b.prototype._receiverAt=function(a){var b=0===a?this._receiver0:this[(a<<2)+a-5+4];return this._isBound()&&void 0===b?this._boundTo:b},b.prototype._promiseAt=function(a){return 0===a?this._promise0:this[(a<<2)+a-5+3]},b.prototype._fulfillmentHandlerAt=function(a){return 0===a?this._fulfillmentHandler0:this[(a<<2)+a-5+0]},b.prototype._rejectionHandlerAt=function(a){return 0===a?this._rejectionHandler0:this[(a<<2)+a-5+1]},b.prototype._addCallbacks=function(a,b,c,d,e){var f=this._length();if(f>=262138&&(f=0,this._setLength(0)),0===f)this._promise0=d,void 0!==e&&(this._receiver0=e),"function"!=typeof a||this._isCarryingStackTrace()||(this._fulfillmentHandler0=a),"function"==typeof b&&(this._rejectionHandler0=b),"function"==typeof c&&(this._progressHandler0=c);else{var g=(f<<2)+f-5;this[g+3]=d,this[g+4]=e,this[g+0]="function"==typeof a?a:void 0,this[g+1]="function"==typeof b?b:void 0,this[g+2]="function"==typeof c?c:void 0}return this._setLength(f+1),f},b.prototype._setProxyHandlers=function(a,b){var c=this._length();if(c>=262138&&(c=0,this._setLength(0)),0===c)this._promise0=b,this._receiver0=a;else{var d=(c<<2)+c-5;this[d+3]=b,this[d+4]=a,this[d+0]=this[d+1]=this[d+2]=void 0}this._setLength(c+1)},b.prototype._proxyPromiseArray=function(a,b){this._setProxyHandlers(a,b)},b.prototype._proxyPromise=function(a){a._setProxied(),this._setProxyHandlers(a,-15)},b.prototype._setBoundTo=function(a){void 0!==a?(this._bitField=8388608|this._bitField,this._boundTo=a):this._bitField=-8388609&this._bitField},b.prototype._isBound=function(){return 8388608===(8388608&this._bitField)},b.prototype._resolveFromResolver=function(a){function b(a){d._tryFollow(a)||d._fulfill(a)}function c(a){var b=D(a)?a:new Error(a+"");d._attachExtraTrace(b),C(a),d._reject(a,b===a?void 0:b)}var d=this;this._setTrace(void 0),this._pushContext();var e=u(a,void 0,b,c);if(this._popContext(),void 0!==e&&e===s){var f=e.e,g=D(f)?f:new Error(f+"");d._reject(f,g)}},b.prototype._spreadSlowCase=function(a,b,c,d){var e=new n(c).promise(),f=e._then(function(){return a.apply(d,arguments)},void 0,void 0,k,void 0);b._follow(f)},b.prototype._callSpread=function(a,c,d){var e=this._boundTo;if(r(d))for(var f=0,g=d.length;g>f;++f)if(m(d[f],void 0)instanceof b)return void this._spreadSlowCase(a,c,d,e);return c._pushContext(),v(a,d,e)},b.prototype._callHandler=function(a,b,c,d){var e;return b!==k||this.isRejected()?(c._pushContext(),e=t(a,b,d)):e=this._callSpread(a,c,d),c._popContext(),e},b.prototype._settlePromiseFromHandler=function(a,c,d,e){if(!(e instanceof b))return void a.call(c,d,e);if(!e.isResolved()){var f=this._callHandler(a,c,e,d);if(!e._isFollowing())if(f===s||f===e||f===l){var g=f===e?G():f.e,h=D(g)?g:new Error(g+"");f!==l&&e._attachExtraTrace(h),e._rejectUnchecked(g,h)}else{var i=m(f,e);if(i instanceof b){if(i.isRejected()&&!i._isCarryingStackTrace()&&!D(i._settledValue)){var h=new Error(i._settledValue+"");e._attachExtraTrace(h),i._setCarriedStackTrace(h)}e._follow(i),e._propagateFrom(i,1)}else e._fulfillUnchecked(f)}}},b.prototype._follow=function(a){this._setFollowing(),a.isPending()?(this._propagateFrom(a,1),a._proxyPromise(this)):a.isFulfilled()?this._fulfillUnchecked(a._settledValue):this._rejectUnchecked(a._settledValue,a._getCarriedStackTrace()),a._isRejectionUnhandled()&&a._unsetRejectionIsUnhandled(),I&&null==a._traceParent&&(a._traceParent=this)},b.prototype._tryFollow=function(a){if(this._isFollowingOrFulfilledOrRejected()||a===this)return!1;var c=m(a,void 0);return c instanceof b?(this._follow(c),!0):!1},b.prototype._resetTrace=function(){I&&(this._trace=new o(void 0===this._peekContext()))},b.prototype._setTrace=function(a){if(I){var b=this._peekContext();this._traceParent=b;var c=void 0===b;this._trace=void 0!==a&&a._traceParent===b?a._trace:new o(c)}return this},b.prototype._tryAttachExtraTrace=function(a){D(a)&&this._attachExtraTrace(a)},b.prototype._attachExtraTrace=function(a){if(I){var b=this,c=a.stack;c="string"==typeof c?c.split("\n"):[],o.protectErrorMessageNewlines(c);for(var d=1,e=1;null!=b&&null!=b._trace;)c=o.combine(c,b._trace.stack.split("\n")),b=b._traceParent,e++;var f=Error.stackTraceLimit||10,g=(f+d)*e,h=c.length;h>g&&(c.length=g),h>0&&(c[0]=c[0].split("\x00").join("\n")),a.stack=c.length<=d?"(No stack trace)":c.join("\n")}},b.prototype._cleanValues=function(){this._cancellable()&&(this._cancellationParent=void 0)},b.prototype._propagateFrom=function(a,b){(1&b)>0&&a._cancellable()&&(this._setCancellable(),this._cancellationParent=a),(4&b)>0&&this._setBoundTo(a._boundTo),(2&b)>0&&this._setTrace(a)},b.prototype._fulfill=function(a){this._isFollowingOrFulfilledOrRejected()||this._fulfillUnchecked(a)},b.prototype._reject=function(a,b){this._isFollowingOrFulfilledOrRejected()||this._rejectUnchecked(a,b)},b.prototype._settlePromiseAt=function(a){var c=this.isFulfilled()?this._fulfillmentHandlerAt(a):this._rejectionHandlerAt(a),d=this._settledValue,e=this._receiverAt(a),f=this._promiseAt(a);if("function"==typeof c)this._settlePromiseFromHandler(c,e,d,f);else{var g=!1,h=this.isFulfilled();void 0!==e&&(e instanceof b&&e._isProxied()?(e._unsetProxied(),h?e._fulfillUnchecked(d):e._rejectUnchecked(d,this._getCarriedStackTrace()),g=!0):e instanceof n&&(h?e._promiseFulfilled(d,f):e._promiseRejected(d,f),g=!0)),g||(h?f._fulfill(d):f._reject(d,this._getCarriedStackTrace()))}a>=4&&this._queueGC()},b.prototype._isProxied=function(){return 4194304===(4194304&this._bitField)},b.prototype._setProxied=function(){this._bitField=4194304|this._bitField},b.prototype._unsetProxied=function(){this._bitField=-4194305&this._bitField},b.prototype._isGcQueued=function(){return-1073741824===(-1073741824&this._bitField)},b.prototype._setGcQueued=function(){this._bitField=-1073741824|this._bitField},b.prototype._unsetGcQueued=function(){this._bitField=1073741823&this._bitField},b.prototype._queueGC=function(){this._isGcQueued()||(this._setGcQueued(),h.invokeLater(this._gc,this,void 0))},b.prototype._gc=function(){for(var a=5*this._length()-5,b=0;a>b;b++)delete this[b];this._clearFirstHandlerData(),this._setLength(0),this._unsetGcQueued()},b.prototype._clearFirstHandlerData=function(){this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0},b.prototype._queueSettleAt=function(a){this._isRejectionUnhandled()&&this._unsetRejectionIsUnhandled(),h.invoke(this._settlePromiseAt,this,a)},b.prototype._fulfillUnchecked=function(a){if(this.isPending()){if(a===this){var b=G();return this._attachExtraTrace(b),this._rejectUnchecked(b,void 0)}this._cleanValues(),this._setFulfilled(),this._settledValue=a;var c=this._length();c>0&&h.invoke(this._settlePromises,this,c)}},b.prototype._rejectUncheckedCheckError=function(a){var b=D(a)?a:new Error(a+"");this._rejectUnchecked(a,b===a?void 0:b)},b.prototype._rejectUnchecked=function(a,b){if(this.isPending()){if(a===this){var c=G();return this._attachExtraTrace(c),this._rejectUnchecked(c)}if(this._cleanValues(),this._setRejected(),this._settledValue=a,this._isFinal())return void h.invokeLater(E,void 0,void 0===b?a:b);var d=this._length();void 0!==b&&this._setCarriedStackTrace(b),d>0?h.invoke(this._rejectPromises,this,null):this._ensurePossibleRejectionHandled()}},b.prototype._rejectPromises=function(){this._settlePromises(),this._unsetCarriedStackTrace()},b.prototype._settlePromises=function(){for(var a=this._length(),b=0;a>b;b++)this._settlePromiseAt(b)},b.prototype._ensurePossibleRejectionHandled=function(){this._setRejectionIsUnhandled(),void 0!==o.possiblyUnhandledRejection&&h.invokeLater(this._notifyUnhandledRejection,this,void 0)},b.prototype._notifyUnhandledRejectionIsHandled=function(){"function"==typeof H&&h.invokeLater(H,void 0,this)},b.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var a=this._settledValue,b=this._getCarriedStackTrace();this._setUnhandledRejectionIsNotified(),void 0!==b&&(this._unsetCarriedStackTrace(),a=b),"function"==typeof o.possiblyUnhandledRejection&&o.possiblyUnhandledRejection(a,this)}};var J=[];return b.prototype._peekContext=function(){var a=J.length-1;return a>=0?J[a]:void 0},b.prototype._pushContext=function(){I&&J.push(this)},b.prototype._popContext=function(){I&&J.pop()},b.noConflict=function(){return d(b)},b.setScheduler=function(a){if("function"!=typeof a)throw new x("fn must be a function");h._schedule=a},o.isSupported()||(b.longStackTraces=function(){},I=!1),b._makeSelfResolutionError=G,a("./finally.js")(b,l,m),a("./direct_resolve.js")(b),a("./synchronous_inspection.js")(b),a("./join.js")(b,n,m,j),b.RangeError=w,b.CancellationError=y,b.TimeoutError=z,b.TypeError=x,b.OperationalError=A,b.RejectionError=A,b.AggregateError=i.AggregateError,g.toFastProperties(b),g.toFastProperties(b.prototype),b.Promise=b,a("./timers.js")(b,j,m),a("./race.js")(b,j,m),a("./call_get.js")(b),a("./generators.js")(b,F,j,m),a("./map.js")(b,n,F,m,j),a("./nodeify.js")(b),a("./promisify.js")(b,j),a("./props.js")(b,n,m),a("./reduce.js")(b,n,F,m,j),a("./settle.js")(b,n),a("./some.js")(b,n,F),a("./progress.js")(b,n),a("./cancel.js")(b,j),a("./filter.js")(b,j),a("./any.js")(b,n),a("./each.js")(b,j),a("./using.js")(b,F,m),b.prototype=b.prototype,b}}).call(this,a("_process"))},{"./any.js":2,"./async.js":3,"./call_get.js":5,"./cancel.js":6,"./captured_trace.js":7,"./catch_filter.js":8,"./direct_resolve.js":9,"./each.js":10,"./errors.js":11,"./errors_api_rejection":12,"./filter.js":14,"./finally.js":15,"./generators.js":16,"./join.js":17,"./map.js":18,"./nodeify.js":19,"./progress.js":20,"./promise_array.js":22,"./promise_resolver.js":23,"./promisify.js":24,"./props.js":25,"./race.js":27,"./reduce.js":28,"./settle.js":30,"./some.js":31,"./synchronous_inspection.js":32,"./thenables.js":33,"./timers.js":34,"./using.js":35,"./util.js":36,_process:38}],22:[function(a,b){"use strict";b.exports=function(b,c,d){function e(a){switch(a){case-1:return void 0;case-2:return[];case-3:return{}}}function f(a){var d=this._promise=new b(c),e=void 0;a instanceof b&&(e=a,d._propagateFrom(e,5)),d._setTrace(e),this._values=a,this._length=0,this._totalResolved=0,this._init(void 0,-2)}var g=a("./errors.js").canAttach,h=a("./util.js"),i=h.isArray;return f.prototype.length=function(){return this._length},f.prototype.promise=function(){return this._promise},f.prototype._init=function j(a,c){var f=d(this._values,void 0);if(f instanceof b){if(this._values=f,f._setBoundTo(this._promise._boundTo),!f.isFulfilled())return f.isPending()?void f._then(j,this._reject,void 0,this,c):(f._unsetRejectionIsUnhandled(),void this._reject(f._settledValue));if(f=f._settledValue,!i(f)){var g=new b.TypeError("expecting an array, a promise or a thenable");return void this.__hardReject__(g)}}else if(!i(f)){var g=new b.TypeError("expecting an array, a promise or a thenable");return void this.__hardReject__(g)}if(0===f.length)return void(-5===c?this._resolveEmptyArray():this._resolve(e(c)));for(var h=this.getActualLength(f.length),k=h,l=this.shouldCopyValues()?new Array(h):this._values,m=!1,n=0;h>n;++n){var o=d(f[n],void 0);o instanceof b?o.isPending()?o._proxyPromiseArray(this,n):(o._unsetRejectionIsUnhandled(),m=!0):m=!0,l[n]=o}this._values=l,this._length=k,m&&this._scanDirectValues(h)},f.prototype._settlePromiseAt=function(a){var c=this._values[a];c instanceof b?c.isFulfilled()?this._promiseFulfilled(c._settledValue,a):c.isRejected()&&this._promiseRejected(c._settledValue,a):this._promiseFulfilled(c,a)},f.prototype._scanDirectValues=function(a){for(var b=0;a>b&&!this._isResolved();++b)this._settlePromiseAt(b)},f.prototype._isResolved=function(){return null===this._values},f.prototype._resolve=function(a){this._values=null,this._promise._fulfill(a)},f.prototype.__hardReject__=f.prototype._reject=function(a){this._values=null;var b=g(a)?a:new Error(a+"");this._promise._attachExtraTrace(b),this._promise._reject(a,b)},f.prototype._promiseProgressed=function(a,b){this._isResolved()||this._promise._progress({index:b,value:a})},f.prototype._promiseFulfilled=function(a,b){if(!this._isResolved()){this._values[b]=a;var c=++this._totalResolved;c>=this._length&&this._resolve(this._values)}},f.prototype._promiseRejected=function(a){this._isResolved()||(this._totalResolved++,this._reject(a))},f.prototype.shouldCopyValues=function(){return!0},f.prototype.getActualLength=function(a){return a},f}},{"./errors.js":11,"./util.js":36}],23:[function(a,b){"use strict";function c(a){return a instanceof Error&&n.getPrototypeOf(a)===Error.prototype}function d(a){var b;return b=c(a)?new k(a):a,i.markAsOriginatingFromRejection(b),b}function e(a){function b(b,c){if(null!==a){if(b){var e=d(h(b));a._attachExtraTrace(e),a._reject(e)}else if(arguments.length>2){for(var f=arguments.length,g=new Array(f-1),i=1;f>i;++i)g[i-1]=arguments[i];a._fulfill(g)}else a._fulfill(c);a=null}}return b}var f,g=a("./util.js"),h=g.maybeWrapAsError,i=a("./errors.js"),j=i.TimeoutError,k=i.OperationalError,l=a("./async.js"),m=g.haveGetters,n=a("./es5.js");if(f=m?function(a){this.promise=a}:function(a){this.promise=a,this.asCallback=e(a),this.callback=this.asCallback},m){var o={get:function(){return e(this.promise)}};n.defineProperty(f.prototype,"asCallback",o),n.defineProperty(f.prototype,"callback",o)}f._nodebackForPromise=e,f.prototype.toString=function(){return"[object PromiseResolver]"},f.prototype.resolve=f.prototype.fulfill=function(a){if(!(this instanceof f))throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.");var b=this.promise;b._tryFollow(a)||l.invoke(b._fulfill,b,a)},f.prototype.reject=function(a){if(!(this instanceof f))throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.");var b=this.promise;i.markAsOriginatingFromRejection(a);var c=i.canAttach(a)?a:new Error(a+"");b._attachExtraTrace(c),l.invoke(b._reject,b,a),c!==a&&l.invoke(this._setCarriedStackTrace,this,c)},f.prototype.progress=function(a){if(!(this instanceof f))throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.");l.invoke(this.promise._progress,this.promise,a)},f.prototype.cancel=function(){l.invoke(this.promise.cancel,this.promise,void 0)},f.prototype.timeout=function(){this.reject(new j("timeout"))},f.prototype.isResolved=function(){return this.promise.isResolved()},f.prototype.toJSON=function(){return this.promise.toJSON()},f.prototype._setCarriedStackTrace=function(a){this.promise.isRejected()&&this.promise._setCarriedStackTrace(a)},b.exports=f},{"./async.js":3,"./errors.js":11,"./es5.js":13,"./util.js":36}],24:[function(a,b){"use strict";b.exports=function(b,c){function d(a){return a.replace(/([$])/,"\\$")}function e(a){try{return a.__isPromisified__===!0}catch(b){return!1}}function f(a,b,c){var d=s.getDataPropertyOrDefault(a,b+c,A);return d?e(d):!1}function g(a,b,c){for(var d=0;d<a.length;d+=2){var e=a[d];if(c.test(e))for(var f=e.replace(c,""),g=0;g<a.length;g+=2)if(a[g]===f)throw new x("Cannot promisify an API that has normal methods with '"+b+"'-suffix")}}function h(a,b,c,d){for(var h=s.inheritedDataKeys(a),i=[],j=0;j<h.length;++j){var k=h[j],l=a[k];"function"!=typeof l||e(l)||f(a,k,b)||!d(k,l,a)||i.push(k,l)}return g(i,b,c),i}function i(a){for(var b=[a],c=Math.max(0,a-1-5),d=a-1;d>=c;--d)d!==a&&b.push(d);for(var d=a+1;5>=d;++d)b.push(d);return b}function j(a){return s.filledRange(a,"arguments[","]")}function k(a){return s.filledRange(a,"_arg","")}function l(a){return"number"==typeof a.length?Math.max(Math.min(a.length,1024),0):0}function m(a){return s.isIdentifier(a)?"."+a:"['"+a.replace(/(['\\])/g,"\\$1")+"']"}function n(a,d,e,f,g){function h(b){var c,e=j(b).join(", "),f=b>0?", ":"";return c="string"==typeof a?"                                                          \n                this.method({{args}}, fn);                                   \n                break;                                                       \n            ".replace(".method",m(a)):d===r?"                                                         \n                callback.call(this, {{args}}, fn);                           \n                break;                                                       \n            ":void 0!==d?"                                                         \n                callback.call(receiver, {{args}}, fn);                       \n                break;                                                       \n            ":"                                                         \n                callback({{args}}, fn);                                      \n                break;                                                       \n            ",c.replace("{{args}}",e).replace(", ",f)}function n(){for(var b="",c=0;c<p.length;++c)b+="case "+p[c]+":"+h(p[c]);var e;return e="string"==typeof a?"                                                  \n                this.property.apply(this, args);                             \n            ".replace(".property",m(a)):d===r?"                                                  \n                callback.apply(this, args);                                  \n            ":"                                                  \n                callback.apply(receiver, args);                              \n            ",b+="                                                             \n        default:                                                             \n            var args = new Array(len + 1);                                   \n            var i = 0;                                                       \n            for (var i = 0; i < len; ++i) {                                  \n               args[i] = arguments[i];                                       \n            }                                                                \n            args[i] = fn;                                                    \n            [CodeForCall]                                                    \n            break;                                                           \n        ".replace("[CodeForCall]",e)}var o=Math.max(0,l(f)-1),p=i(o),q="string"==typeof e&&s.isIdentifier(e)?e+g:"promisified";return new Function("Promise","callback","receiver","withAppended","maybeWrapAsError","nodebackForPromise","INTERNAL","                                         \n        var ret = function FunctionName(Parameters) {                        \n            'use strict';                                                    \n            var len = arguments.length;                                      \n            var promise = new Promise(INTERNAL);                             \n            promise._setTrace(void 0);                                       \n            var fn = nodebackForPromise(promise);                            \n            try {                                                            \n                switch(len) {                                                \n                    [CodeForSwitchCase]                                      \n                }                                                            \n            } catch (e) {                                                    \n                var wrapped = maybeWrapAsError(e);                           \n                promise._attachExtraTrace(wrapped);                          \n                promise._reject(wrapped);                                    \n            }                                                                \n            return promise;                                                  \n        };                                                                   \n        ret.__isPromisified__ = true;                                        \n        return ret;                                                          \n        ".replace("FunctionName",q).replace("Parameters",k(o)).replace("[CodeForSwitchCase]",n()))(b,a,d,u,v,t,c)}function o(a,d){function e(){var e=d;d===r&&(e=this),"string"==typeof a&&(a=e[a]);var f=new b(c);f._setTrace(void 0);var g=t(f);try{a.apply(e,u(arguments,g))}catch(h){var i=v(h);f._attachExtraTrace(i),f._reject(i)}return f}return e.__isPromisified__=!0,e}function p(a,b,c,e){for(var f=new RegExp(d(b)+"$"),g=h(a,b,f,c),i=0,j=g.length;j>i;i+=2){var k=g[i],l=g[i+1],m=k+b;a[m]=e===B?B(k,r,k,l,b):e(l)}return s.toFastProperties(a),a}function q(a,b){return B(a,b,void 0,a)}var r={},s=a("./util.js"),t=a("./promise_resolver.js")._nodebackForPromise,u=s.withAppended,v=s.maybeWrapAsError,w=s.canEvaluate,x=a("./errors").TypeError,y="Async",z=function(a,b){return s.isIdentifier(a)&&"_"!==a.charAt(0)&&!s.isClass(b)},A={__isPromisified__:!0},B=w?n:o;b.promisify=function(a,b){if("function"!=typeof a)throw new x("fn must be a function");return e(a)?a:q(a,arguments.length<2?r:b)},b.promisifyAll=function(a,b){if("function"!=typeof a&&"object"!=typeof a)throw new x("the target of promisifyAll must be an object or a function");b=Object(b);var c=b.suffix;"string"!=typeof c&&(c=y);var d=b.filter;"function"!=typeof d&&(d=z);var e=b.promisifier;if("function"!=typeof e&&(e=B),!s.isIdentifier(c))throw new RangeError("suffix must be a valid identifier");for(var f=s.inheritedDataKeys(a,{includeHidden:!0}),g=0;g<f.length;++g){var h=a[f[g]];"constructor"!==f[g]&&s.isClass(h)&&(p(h.prototype,c,d,e),p(h,c,d,e))}return p(a,c,d,e)}}},{"./errors":11,"./promise_resolver.js":23,"./util.js":36}],25:[function(a,b){"use strict";b.exports=function(b,c,d){function e(a){for(var b=j.keys(a),c=b.length,d=new Array(2*c),e=0;c>e;++e){var f=b[e];d[e]=a[f],d[e+c]=f}this.constructor$(d)}function f(a){var c,f=d(a,void 0);return i(f)?(c=f instanceof b?f._then(b.props,void 0,void 0,void 0,void 0):new e(f).promise(),f instanceof b&&c._propagateFrom(f,4),c):h("cannot await properties of a non-object")}var g=a("./util.js"),h=a("./errors_api_rejection")(b),i=g.isObject,j=a("./es5.js");g.inherits(e,c),e.prototype._init=function(){this._init$(void 0,-3)},e.prototype._promiseFulfilled=function(a,b){if(!this._isResolved()){this._values[b]=a;var c=++this._totalResolved;if(c>=this._length){for(var d={},e=this.length(),f=0,g=this.length();g>f;++f)d[this._values[f+e]]=this._values[f];this._resolve(d)}}},e.prototype._promiseProgressed=function(a,b){this._isResolved()||this._promise._progress({key:this._values[b+this.length()],value:a})},e.prototype.shouldCopyValues=function(){return!1},e.prototype.getActualLength=function(a){return a>>1},b.prototype.props=function(){return f(this)},b.props=function(a){return f(a)}}},{"./errors_api_rejection":12,"./es5.js":13,"./util.js":36}],26:[function(a,b){"use strict";function c(a,b,c,d,e){for(var f=0;e>f;++f)c[f+d]=a[f+b]}function d(a){this._capacity=a,this._length=0,this._front=0,this._makeCapacity()}d.prototype._willBeOverCapacity=function(a){return this._capacity<a},d.prototype._pushOne=function(a){var b=this.length();this._checkCapacity(b+1);var c=this._front+b&this._capacity-1;this[c]=a,this._length=b+1},d.prototype.push=function(a,b,c){var d=this.length()+3;if(this._willBeOverCapacity(d))return this._pushOne(a),this._pushOne(b),void this._pushOne(c);var e=this._front+d-3;this._checkCapacity(d);var f=this._capacity-1;this[e+0&f]=a,this[e+1&f]=b,this[e+2&f]=c,this._length=d},d.prototype.shift=function(){var a=this._front,b=this[a];return this[a]=void 0,this._front=a+1&this._capacity-1,this._length--,b},d.prototype.length=function(){return this._length},d.prototype._makeCapacity=function(){for(var a=this._capacity,b=0;a>b;++b)this[b]=void 0},d.prototype._checkCapacity=function(a){this._capacity<a&&this._resizeTo(this._capacity<<3)},d.prototype._resizeTo=function(a){var b=this._front,d=this._capacity,e=new Array(d),f=this.length();if(c(this,0,e,0,d),this._capacity=a,this._makeCapacity(),this._front=0,d>=b+f)c(e,b,this,0,f);else{var g=f-(b+f&d-1);c(e,b,this,0,g),c(e,0,this,g,f-g)}},b.exports=d},{}],27:[function(a,b){"use strict";b.exports=function(b,c,d){function e(a,e){var j=d(a,void 0);if(j instanceof b)return h(j);if(!g(a))return f("expecting an array, a promise or a thenable");var k=new b(c);void 0!==e?k._propagateFrom(e,7):k._setTrace(void 0);for(var l=k._fulfill,m=k._reject,n=0,o=a.length;o>n;++n){var p=a[n];(void 0!==p||i.call(a,n))&&b.cast(p)._then(l,m,void 0,k,null)}return k}var f=a("./errors_api_rejection.js")(b),g=a("./util.js").isArray,h=function(a){return a.then(function(b){return e(b,a)})},i={}.hasOwnProperty;b.race=function(a){return e(a,void 0)},b.prototype.race=function(){return e(this,void 0)}}},{"./errors_api_rejection.js":12,"./util.js":36}],28:[function(a,b){"use strict";b.exports=function(b,c,d,e,f){function g(a,c,d,g){this.constructor$(a),this._preservedValues=g===f?[]:null,this._zerothIsAccum=void 0===d,this._gotAccum=!1,this._reducingIndex=this._zerothIsAccum?1:0,this._valuesPhase=void 0;var h=e(d,void 0),i=!1,j=h instanceof b;j&&(h.isPending()?h._proxyPromiseArray(this,-1):h.isFulfilled()?(d=h.value(),this._gotAccum=!0):(h._unsetRejectionIsUnhandled(),this._reject(h.reason()),i=!0)),j||this._zerothIsAccum||(this._gotAccum=!0),this._callback=c,this._accum=d,i||this._init$(void 0,-5)}function h(a,b,c,e){if("function"!=typeof b)return d("fn must be a function");var f=new g(a,b,c,e);return f.promise()}var i=a("./util.js"),j=i.tryCatch4,k=i.tryCatch3,l=i.errorObj;i.inherits(g,c),g.prototype._init=function(){},g.prototype._resolveEmptyArray=function(){(this._gotAccum||this._zerothIsAccum)&&this._resolve(null!==this._preservedValues?[]:this._accum)},g.prototype._promiseFulfilled=function(a,c){var d=this._values;if(null!==d){var f,g=this.length(),h=this._preservedValues,i=null!==h,m=this._gotAccum,n=this._valuesPhase;if(!n)for(n=this._valuesPhase=Array(g),f=0;g>f;++f)n[f]=0;if(f=n[c],0===c&&this._zerothIsAccum?(m||(this._accum=a,this._gotAccum=m=!0),n[c]=0===f?1:2):-1===c?m||(this._accum=a,this._gotAccum=m=!0):0===f?n[c]=1:(n[c]=2,m&&(this._accum=a)),m){for(var o,p=this._callback,q=this._promise._boundTo,r=this._reducingIndex;g>r;++r)if(f=n[r],2!==f){if(1!==f)return;if(a=d[r],a instanceof b){if(!a.isFulfilled())return a.isPending()?void 0:(a._unsetRejectionIsUnhandled(),this._reject(a.reason()));a=a._settledValue}if(i?(h.push(a),o=k(p,q,a,r,g)):o=j(p,q,this._accum,a,r,g),o===l)return this._reject(o.e);var s=e(o,void 0);if(s instanceof b){if(s.isPending())return n[r]=4,s._proxyPromiseArray(this,r);if(!s.isFulfilled())return s._unsetRejectionIsUnhandled(),this._reject(s.reason());o=s.value()}this._reducingIndex=r+1,this._accum=o}else this._reducingIndex=r+1;this._reducingIndex<g||this._resolve(i?h:this._accum)}}},b.prototype.reduce=function(a,b){return h(this,a,b,null)},b.reduce=function(a,b,c,d){return h(a,b,c,d)}}},{"./util.js":36}],29:[function(a,b){(function(a){"use strict";var c,d;if("object"==typeof a&&"string"==typeof a.version)c=function(b){a.nextTick(b)};else if("undefined"!=typeof MutationObserver&&(d=MutationObserver)||"undefined"!=typeof WebKitMutationObserver&&(d=WebKitMutationObserver))c=function(){var a=document.createElement("div"),b=void 0,c=new d(function(){var a=b;b=void 0,a()});return c.observe(a,{attributes:!0}),function(c){b=c,a.classList.toggle("foo")}}();else{if("undefined"==typeof setTimeout)throw new Error("no async scheduler available");c=function(a){setTimeout(a,0)}}b.exports=c}).call(this,a("_process"))},{_process:38}],30:[function(a,b){"use strict";b.exports=function(b,c){function d(a){this.constructor$(a)}var e=b.PromiseInspection,f=a("./util.js");f.inherits(d,c),d.prototype._promiseResolved=function(a,b){this._values[a]=b;var c=++this._totalResolved;c>=this._length&&this._resolve(this._values)},d.prototype._promiseFulfilled=function(a,b){if(!this._isResolved()){var c=new e;c._bitField=268435456,c._settledValue=a,this._promiseResolved(b,c)}},d.prototype._promiseRejected=function(a,b){if(!this._isResolved()){var c=new e;
c._bitField=134217728,c._settledValue=a,this._promiseResolved(b,c)}},b.settle=function(a){return new d(a).promise()},b.prototype.settle=function(){return new d(this).promise()}}},{"./util.js":36}],31:[function(a,b){"use strict";b.exports=function(b,c,d){function e(a){this.constructor$(a),this._howMany=0,this._unwrap=!1,this._initialized=!1}function f(a,b){if((0|b)!==b||0>b)return d("expecting a positive integer");var c=new e(a),f=c.promise();return f.isRejected()?f:(c.setHowMany(b),c.init(),f)}var g=a("./util.js"),h=a("./errors.js").RangeError,i=a("./errors.js").AggregateError,j=g.isArray;g.inherits(e,c),e.prototype._init=function(){if(this._initialized){if(0===this._howMany)return void this._resolve([]);this._init$(void 0,-5);var a=j(this._values);!this._isResolved()&&a&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}},e.prototype.init=function(){this._initialized=!0,this._init()},e.prototype.setUnwrap=function(){this._unwrap=!0},e.prototype.howMany=function(){return this._howMany},e.prototype.setHowMany=function(a){this._isResolved()||(this._howMany=a)},e.prototype._promiseFulfilled=function(a){this._isResolved()||(this._addFulfilled(a),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),this._resolve(1===this.howMany()&&this._unwrap?this._values[0]:this._values)))},e.prototype._promiseRejected=function(a){if(!this._isResolved()&&(this._addRejected(a),this.howMany()>this._canPossiblyFulfill())){for(var b=new i,c=this.length();c<this._values.length;++c)b.push(this._values[c]);this._reject(b)}},e.prototype._fulfilled=function(){return this._totalResolved},e.prototype._rejected=function(){return this._values.length-this.length()},e.prototype._addRejected=function(a){this._values.push(a)},e.prototype._addFulfilled=function(a){this._values[this._totalResolved++]=a},e.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},e.prototype._getRangeError=function(a){var b="Input array must contain at least "+this._howMany+" items but contains only "+a+" items";return new h(b)},e.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},b.some=function(a,b){return f(a,b)},b.prototype.some=function(a){return f(this,a)},b._SomePromiseArray=e}},{"./errors.js":11,"./util.js":36}],32:[function(a,b){"use strict";b.exports=function(a){function b(a){void 0!==a?(this._bitField=a._bitField,this._settledValue=a.isResolved()?a._settledValue:void 0):(this._bitField=0,this._settledValue=void 0)}b.prototype.isFulfilled=a.prototype.isFulfilled=function(){return(268435456&this._bitField)>0},b.prototype.isRejected=a.prototype.isRejected=function(){return(134217728&this._bitField)>0},b.prototype.isPending=a.prototype.isPending=function(){return 0===(402653184&this._bitField)},b.prototype.value=a.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise");return this._settledValue},b.prototype.error=b.prototype.reason=a.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise");return this._settledValue},b.prototype.isResolved=a.prototype.isResolved=function(){return(402653184&this._bitField)>0},a.PromiseInspection=b}},{}],33:[function(a,b){"use strict";b.exports=function(b,c){function d(a){try{return a.then}catch(b){return j.e=b,j}}function e(a,e){if(k(a)){if(a instanceof b)return a;if(f(a)){var h=new b(c);return h._setTrace(void 0),a._then(h._fulfillUnchecked,h._rejectUncheckedCheckError,h._progressUnchecked,h,null),h._setFollowing(),h}var l=d(a);if(l===j)return void 0!==e&&i(l.e)&&e._attachExtraTrace(l.e),b.reject(l.e);if("function"==typeof l)return g(a,l,e)}return a}function f(a){return l.call(a,"_promise0")}function g(a,c,d){function e(c){if(!j){if(j=!0,a===c){var e=b._makeSelfResolutionError();return void 0!==d&&d._attachExtraTrace(e),void h.promise._reject(e,void 0)}h.resolve(c)}}function f(a){if(!j){j=!0;var b=i(a)?a:new Error(a+"");void 0!==d&&d._attachExtraTrace(b),h.promise._reject(a,b)}}function g(a){if(!j){var b=h.promise;"function"==typeof b._progress&&b._progress(a)}}var h=b.defer(),j=!1;try{c.call(a,e,f,g)}catch(k){if(!j){j=!0;var l=i(k)?k:new Error(k+"");void 0!==d&&d._attachExtraTrace(l),h.promise._reject(k,l)}}return h.promise}var h=a("./util.js"),i=a("./errors.js").canAttach,j=h.errorObj,k=h.isObject,l={}.hasOwnProperty;return e}},{"./errors.js":11,"./util.js":36}],34:[function(a,b){"use strict";var c=function(a,b){var c=arguments.length,d=arguments[2],e=arguments[3],f=c>=5?arguments[4]:void 0;return setTimeout(function(){a(d,e,f)},0|b)};b.exports=function(b,d,e){function f(a){var b=this;return b instanceof Number&&(b=+b),clearTimeout(b),a}function g(a){var b=this;throw b instanceof Number&&(b=+b),clearTimeout(b),a}var h=(a("./util.js"),a("./errors.js")),i=(a("./errors_api_rejection")(b),b.TimeoutError),j=function(a,b,c){if(a.isPending()){"string"!=typeof b&&(b="operation timed out after "+c+" ms");var d=new i(b);h.markAsOriginatingFromRejection(d),a._attachExtraTrace(d),a._cancel(d)}},k=function(a,b){b._fulfill(a)},l=b.delay=function(a,f){void 0===f&&(f=a,a=void 0),f=+f;var g=e(a,void 0),h=new b(d);return g instanceof b?(h._propagateFrom(g,7),h._follow(g),h.then(function(a){return b.delay(a,f)})):(h._setTrace(void 0),c(k,f,a,h),h)};b.prototype.delay=function(a){return l(this,a)},b.prototype.timeout=function(a,e){a=+a;var h=new b(d);h._propagateFrom(this,7),h._follow(this);var i=c(j,a,h,e,a);return h.cancellable()._then(f,g,void 0,i,void 0)}}},{"./errors.js":11,"./errors_api_rejection":12,"./util.js":36}],35:[function(a,b){"use strict";b.exports=function(b,c,d){function e(a){for(var c=a.length,d=0;c>d;++d){var e=a[d];if(e.isRejected())return b.reject(e.error());a[d]=e.value()}return a}function f(a){setTimeout(function(){throw a},0)}function g(a){var b=d(a,void 0);return b!==a&&"function"==typeof a._isDisposable&&"function"==typeof a._getDisposer&&a._isDisposable()&&b._setDisposable(a._getDisposer()),b}function h(a,c){function e(){if(h>=i)return j.resolve();var k=g(a[h++]);if(k instanceof b&&k._isDisposable()){try{k=d(k._getDisposer().tryDispose(c),void 0)}catch(l){return f(l)}if(k instanceof b)return k._then(e,f,null,null,null)}e()}var h=0,i=a.length,j=b.defer();return e(),j.promise}function i(a){var b=new o;return b._settledValue=a,b._bitField=268435456,h(this,b).thenReturn(a)}function j(a){var b=new o;return b._settledValue=a,b._bitField=134217728,h(this,b).thenThrow(a)}function k(a,b){this._data=a,this._promise=b}function l(a,b){this.constructor$(a,b)}var m=a("./errors.js").TypeError,n=a("./util.js").inherits,o=b.PromiseInspection;k.prototype.data=function(){return this._data},k.prototype.promise=function(){return this._promise},k.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():null},k.prototype.tryDispose=function(a){var b=this.resource(),c=null!==b?this.doDispose(b,a):null;return this._promise._unsetDisposable(),this._data=this._promise=null,c},k.isDisposer=function(a){return null!=a&&"function"==typeof a.resource&&"function"==typeof a.tryDispose},n(l,k),l.prototype.doDispose=function(a,b){var c=this.data();return c.call(a,a,b)},b.using=function(){var a=arguments.length;if(2>a)return c("you must pass at least 2 arguments to Promise.using");var d=arguments[a-1];if("function"!=typeof d)return c("fn must be a function");a--;for(var f=new Array(a),g=0;a>g;++g){var h=arguments[g];if(k.isDisposer(h)){var l=h;h=h.promise(),h._setDisposable(l)}f[g]=h}return b.settle(f).then(e).spread(d)._then(i,j,void 0,f,void 0)},b.prototype._setDisposable=function(a){this._bitField=262144|this._bitField,this._disposer=a},b.prototype._isDisposable=function(){return(262144&this._bitField)>0},b.prototype._getDisposer=function(){return this._disposer},b.prototype._unsetDisposable=function(){this._bitField=-262145&this._bitField,this._disposer=void 0},b.prototype.disposer=function(a){if("function"==typeof a)return new l(a,this);throw new m}}},{"./errors.js":11,"./util.js":36}],36:[function(a,b,c){"use strict";function d(a,b,c){try{return a.call(b,c)}catch(d){return x.e=d,x}}function e(a,b,c,d){try{return a.call(b,c,d)}catch(e){return x.e=e,x}}function f(a,b,c,d,e){try{return a.call(b,c,d,e)}catch(f){return x.e=f,x}}function g(a,b,c,d,e,f){try{return a.call(b,c,d,e,f)}catch(g){return x.e=g,x}}function h(a,b,c){try{return a.apply(c,b)}catch(d){return x.e=d,x}}function i(a){return"string"==typeof a?a:""+a}function j(a){return null==a||a===!0||a===!1||"string"==typeof a||"number"==typeof a}function k(a){return!j(a)}function l(a){return j(a)?new Error(i(a)):a}function m(a,b){var c,d=a.length,e=new Array(d+1);for(c=0;d>c;++c)e[c]=a[c];return e[c]=b,e}function n(a,b,c){if(!u.isES5)return{}.hasOwnProperty.call(a,b)?a[b]:void 0;var d=Object.getOwnPropertyDescriptor(a,b);return null!=d?null==d.get&&null==d.set?d.value:c:void 0}function o(a,b,c){if(j(a))return a;var d={value:c,configurable:!0,enumerable:!1,writable:!0};return u.defineProperty(a,b,d),a}function p(a){throw a}function q(a){try{if("function"==typeof a){var b=u.keys(a.prototype);return b.length>0&&!(1===b.length&&"constructor"===b[0])}return!1}catch(c){return!1}}function r(a){function b(){}return b.prototype=a,b}function s(a){return B.test(a)}function t(a,b,c){for(var d=new Array(a),e=0;a>e;++e)d[e]=b+e+c;return d}var u=a("./es5.js"),v=function(){try{var a={};return u.defineProperty(a,"f",{get:function(){return 3}}),3===a.f}catch(b){return!1}}(),w="undefined"==typeof navigator,x={e:{}},y=function(a,b){function c(){this.constructor=a,this.constructor$=b;for(var c in b.prototype)d.call(b.prototype,c)&&"$"!==c.charAt(c.length-1)&&(this[c+"$"]=b.prototype[c])}var d={}.hasOwnProperty;return c.prototype=b.prototype,a.prototype=new c,a.prototype},z=function(){return"string"!==this}.call("string"),A=function(){return u.isES5?function(a,b){for(var c=[],d=Object.create(null),e=Object(b).includeHidden?Object.getOwnPropertyNames:Object.keys;null!=a;){var f;try{f=e(a)}catch(g){return c}for(var h=0;h<f.length;++h){var i=f[h];if(!d[i]){d[i]=!0;var j=Object.getOwnPropertyDescriptor(a,i);null!=j&&null==j.get&&null==j.set&&c.push(i)}}a=u.getPrototypeOf(a)}return c}:function(a){var b=[];for(var c in a)b.push(c);return b}}(),B=/^[a-z$_][a-z$_0-9]*$/i,C={isClass:q,isIdentifier:s,inheritedDataKeys:A,getDataPropertyOrDefault:n,thrower:p,isArray:u.isArray,haveGetters:v,notEnumerableProp:o,isPrimitive:j,isObject:k,canEvaluate:w,errorObj:x,tryCatch1:d,tryCatch2:e,tryCatch3:f,tryCatch4:g,tryCatchApply:h,inherits:y,withAppended:m,asString:i,maybeWrapAsError:l,wrapsPrimitiveReceiver:z,toFastProperties:r,filledRange:t};b.exports=C},{"./es5.js":13}],37:[function(a,b){(function(a,c){(function(){"use strict";function d(a){return"function"==typeof a||"object"==typeof a&&null!==a}function e(a){return"function"==typeof a}function f(a){return"object"==typeof a&&null!==a}function g(){}function h(){return function(){a.nextTick(l)}}function i(){var a=0,b=new O(l),c=document.createTextNode("");return b.observe(c,{characterData:!0}),function(){c.data=a=++a%2}}function j(){var a=new MessageChannel;return a.port1.onmessage=l,function(){a.port2.postMessage(0)}}function k(){return function(){setTimeout(l,1)}}function l(){for(var a=0;L>a;a+=2){var b=Q[a],c=Q[a+1];b(c),Q[a]=void 0,Q[a+1]=void 0}L=0}function m(){}function n(){return new TypeError("You cannot resolve a promise with itself")}function o(){return new TypeError("A promises callback cannot return that same promise.")}function p(a){try{return a.then}catch(b){return U.error=b,U}}function q(a,b,c,d){try{a.call(b,c,d)}catch(e){return e}}function r(a,b,c){M(function(a){var d=!1,e=q(c,b,function(c){d||(d=!0,b!==c?u(a,c):w(a,c))},function(b){d||(d=!0,x(a,b))},"Settle: "+(a._label||" unknown promise"));!d&&e&&(d=!0,x(a,e))},a)}function s(a,b){b._state===S?w(a,b._result):a._state===T?x(a,b._result):y(b,void 0,function(b){u(a,b)},function(b){x(a,b)})}function t(a,b){if(b.constructor===a.constructor)s(a,b);else{var c=p(b);c===U?x(a,U.error):void 0===c?w(a,b):e(c)?r(a,b,c):w(a,b)}}function u(a,b){a===b?x(a,n()):d(b)?t(a,b):w(a,b)}function v(a){a._onerror&&a._onerror(a._result),z(a)}function w(a,b){a._state===R&&(a._result=b,a._state=S,0===a._subscribers.length||M(z,a))}function x(a,b){a._state===R&&(a._state=T,a._result=b,M(v,a))}function y(a,b,c,d){var e=a._subscribers,f=e.length;a._onerror=null,e[f]=b,e[f+S]=c,e[f+T]=d,0===f&&a._state&&M(z,a)}function z(a){var b=a._subscribers,c=a._state;if(0!==b.length){for(var d,e,f=a._result,g=0;g<b.length;g+=3)d=b[g],e=b[g+c],d?C(c,d,e,f):e(f);a._subscribers.length=0}}function A(){this.error=null}function B(a,b){try{return a(b)}catch(c){return V.error=c,V}}function C(a,b,c,d){var f,g,h,i,j=e(c);if(j){if(f=B(c,d),f===V?(i=!0,g=f.error,f=null):h=!0,b===f)return void x(b,o())}else f=d,h=!0;b._state!==R||(j&&h?u(b,f):i?x(b,g):a===S?w(b,f):a===T&&x(b,f))}function D(a,b){try{b(function(b){u(a,b)},function(b){x(a,b)})}catch(c){x(a,c)}}function E(a,b,c,d){this._instanceConstructor=a,this.promise=new a(m,d),this._abortOnReject=c,this._validateInput(b)?(this._input=b,this.length=b.length,this._remaining=b.length,this._init(),0===this.length?w(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&w(this.promise,this._result))):x(this.promise,this._validationError())}function F(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function G(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function H(a,b){this._id=_++,this._label=b,this._state=void 0,this._result=void 0,this._subscribers=[],m!==a&&(e(a)||F(),this instanceof H||G(),D(this,a))}var I;I=Array.isArray?Array.isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)};var J,K=I,L=(Date.now||function(){return(new Date).getTime()},Object.create||function(a){if(arguments.length>1)throw new Error("Second argument not supported");if("object"!=typeof a)throw new TypeError("Argument must be an object");return g.prototype=a,new g},0),M=function(a,b){Q[L]=a,Q[L+1]=b,L+=2,2===L&&J()},N="undefined"!=typeof window?window:{},O=N.MutationObserver||N.WebKitMutationObserver,P="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,Q=new Array(1e3);J="undefined"!=typeof a&&"[object process]"==={}.toString.call(a)?h():O?i():P?j():k();var R=void 0,S=1,T=2,U=new A,V=new A;E.prototype._validateInput=function(a){return K(a)},E.prototype._validationError=function(){return new Error("Array Methods must be provided an Array")},E.prototype._init=function(){this._result=new Array(this.length)};var W=E;E.prototype._enumerate=function(){for(var a=this.length,b=this.promise,c=this._input,d=0;b._state===R&&a>d;d++)this._eachEntry(c[d],d)},E.prototype._eachEntry=function(a,b){var c=this._instanceConstructor;f(a)?a.constructor===c&&a._state!==R?(a._onerror=null,this._settledAt(a._state,b,a._result)):this._willSettleAt(c.resolve(a),b):(this._remaining--,this._result[b]=this._makeResult(S,b,a))},E.prototype._settledAt=function(a,b,c){var d=this.promise;d._state===R&&(this._remaining--,this._abortOnReject&&a===T?x(d,c):this._result[b]=this._makeResult(a,b,c)),0===this._remaining&&w(d,this._result)},E.prototype._makeResult=function(a,b,c){return c},E.prototype._willSettleAt=function(a,b){var c=this;y(a,void 0,function(a){c._settledAt(S,b,a)},function(a){c._settledAt(T,b,a)})};var X=function(a,b){return new W(this,a,!0,b).promise},Y=function(a,b){function c(a){u(f,a)}function d(a){x(f,a)}var e=this,f=new e(m,b);if(!K(a))return x(f,new TypeError("You must pass an array to race.")),f;for(var g=a.length,h=0;f._state===R&&g>h;h++)y(e.resolve(a[h]),void 0,c,d);return f},Z=function(a,b){var c=this;if(a&&"object"==typeof a&&a.constructor===c)return a;var d=new c(m,b);return u(d,a),d},$=function(a,b){var c=this,d=new c(m,b);return x(d,a),d},_=0,ab=H;H.all=X,H.race=Y,H.resolve=Z,H.reject=$,H.prototype={constructor:H,then:function(a,b,c){var d=this,e=d._state;if(e===S&&!a||e===T&&!b)return this;d._onerror=null;var f=new this.constructor(m,c),g=d._result;if(e){var h=arguments[e-1];M(function(){C(e,f,h,g)})}else y(d,f,a,b);return f},"catch":function(a,b){return this.then(null,a,b)}};var bb=function(){var a;a="undefined"!=typeof c?c:"undefined"!=typeof window&&window.document?window:self;var b="Promise"in a&&"resolve"in a.Promise&&"reject"in a.Promise&&"all"in a.Promise&&"race"in a.Promise&&function(){var b;return new a.Promise(function(a){b=a}),e(b)}();b||(a.Promise=ab)},cb={Promise:ab,polyfill:bb};"function"==typeof define&&define.amd?define(function(){return cb}):"undefined"!=typeof b&&b.exports?b.exports=cb:"undefined"!=typeof this&&(this.ES6Promise=cb)}).call(this)}).call(this,a("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:38}],38:[function(a,b){function c(){}var d=b.exports={};d.nextTick=function(){var a="undefined"!=typeof window&&window.setImmediate,b="undefined"!=typeof window&&window.MutationObserver,c="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(a)return function(a){return window.setImmediate(a)};var d=[];if(b){var e=document.createElement("div"),f=new MutationObserver(function(){var a=d.slice();d.length=0,a.forEach(function(a){a()})});return f.observe(e,{attributes:!0}),function(a){d.length||e.setAttribute("yes","no"),d.push(a)}}return c?(window.addEventListener("message",function(a){var b=a.source;if((b===window||null===b)&&"process-tick"===a.data&&(a.stopPropagation(),d.length>0)){var c=d.shift();c()}},!0),function(a){d.push(a),window.postMessage("process-tick","*")}):function(a){setTimeout(a,0)}}(),d.title="browser",d.browser=!0,d.env={},d.argv=[],d.on=c,d.addListener=c,d.once=c,d.off=c,d.removeListener=c,d.removeAllListeners=c,d.emit=c,d.binding=function(){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(){throw new Error("process.chdir is not supported")}},{}],39:[function(a,b){function c(a,b){return-1!==d(a,b)}var d=a("./indexOf");b.exports=c},{"./indexOf":44}],40:[function(a,b){function c(a,b,c){b=d(b,c);var e=[];if(null==a)return e;for(var f,g=-1,h=a.length;++g<h;)f=a[g],b(f,g,a)&&e.push(f);return e}var d=a("../function/makeIterator_");b.exports=c},{"../function/makeIterator_":51}],41:[function(a,b){function c(a,b,c){var e=d(a,b,c);return e>=0?a[e]:void 0}var d=a("./findIndex");b.exports=c},{"./findIndex":42}],42:[function(a,b){function c(a,b,c){if(b=d(b,c),null==a)return-1;for(var e=-1,f=a.length;++e<f;)if(b(a[e],e,a))return e;return-1}var d=a("../function/makeIterator_");b.exports=c},{"../function/makeIterator_":51}],43:[function(a,b){function c(a,b,c){if(null!=a)for(var d=-1,e=a.length;++d<e&&b.call(c,a[d],d,a)!==!1;);}b.exports=c},{}],44:[function(a,b){function c(a,b,c){if(c=c||0,null==a)return-1;for(var d=a.length,e=0>c?d+c:c;d>e;){if(a[e]===b)return e;e++}return-1}b.exports=c},{}],45:[function(a,b){function c(a){return null!=a&&""!==a}function d(a,b){return b=b||"",e(a,c).join(b)}var e=a("./filter");b.exports=d},{"./filter":40}],46:[function(a,b){function c(a,b){var c=d(a,b);-1!==c&&a.splice(c,1)}var d=a("./indexOf");b.exports=c},{"./indexOf":44}],47:[function(a,b){function c(a,b,c){var d=a.length;b=null==b?0:0>b?Math.max(d+b,0):Math.min(b,d),c=null==c?d:0>c?Math.max(d+c,0):Math.min(c,d);for(var e=[];c>b;)e.push(a[b++]);return e}b.exports=c},{}],48:[function(a,b){function c(a,b){if(null==a)return[];if(a.length<2)return a;null==b&&(b=d);var f,g,h;return f=~~(a.length/2),g=c(a.slice(0,f),b),h=c(a.slice(f,a.length),b),e(g,h,b)}function d(a,b){return b>a?-1:a>b?1:0}function e(a,b,c){for(var d=[];a.length&&b.length;)d.push(c(a[0],b[0])<=0?a.shift():b.shift());return a.length&&d.push.apply(d,a),b.length&&d.push.apply(d,b),d}b.exports=c},{}],49:[function(a,b){function c(a,b){var c={};if(null==a)return c;var e,f=-1,g=a.length;if(d(b))for(;++f<g;)e=a[f],c[b(e)]=e;else for(;++f<g;)e=a[f],c[e[b]]=e;return c}var d=a("../lang/isFunction");b.exports=c},{"../lang/isFunction":58}],50:[function(a,b){function c(a){return a}b.exports=c},{}],51:[function(a,b){function c(a,b){if(null==a)return d;switch(typeof a){case"function":return"undefined"!=typeof b?function(c,d,e){return a.call(b,c,d,e)}:a;case"object":return function(b){return f(b,a)};case"string":case"number":return e(a)}}var d=a("./identity"),e=a("./prop"),f=a("../object/deepMatches");b.exports=c},{"../object/deepMatches":67,"./identity":50,"./prop":52}],52:[function(a,b){function c(a){return function(b){return b[a]}}b.exports=c},{}],53:[function(a,b){function c(a){switch(h(a)){case"Object":return d(a);case"Array":return g(a);case"RegExp":return e(a);case"Date":return f(a);default:return a}}function d(a){return i(a)?j({},a):a}function e(a){var b="";return b+=a.multiline?"m":"",b+=a.global?"g":"",b+=a.ignoreCase?"i":"",new RegExp(a.source,b)}function f(a){return new Date(+a)}function g(a){return a.slice()}var h=a("./kindOf"),i=a("./isPlainObject"),j=a("../object/mixIn");b.exports=c},{"../object/mixIn":73,"./isPlainObject":62,"./kindOf":65}],54:[function(a,b){function c(a,b){switch(h(a)){case"Object":return d(a,b);case"Array":return e(a,b);default:return f(a)}}function d(a,b){if(i(a)){var d={};return g(a,function(a,d){this[d]=c(a,b)},d),d}return b?b(a):a}function e(a,b){for(var d=[],e=-1,f=a.length;++e<f;)d[e]=c(a[e],b);return d}var f=a("./clone"),g=a("../object/forOwn"),h=a("./kindOf"),i=a("./isPlainObject");b.exports=c},{"../object/forOwn":70,"./clone":53,"./isPlainObject":62,"./kindOf":65}],55:[function(a,b){var c=a("./isKind"),d=Array.isArray||function(a){return c(a,"Array")};b.exports=d},{"./isKind":59}],56:[function(a,b){function c(a){return d(a,"Boolean")}var d=a("./isKind");b.exports=c},{"./isKind":59}],57:[function(a,b){function c(a){if(null==a)return!0;if("string"==typeof a||e(a))return!a.length;if("object"==typeof a){var b=!0;return d(a,function(){return b=!1,!1}),b}return!0}var d=a("../object/forOwn"),e=a("./isArray");b.exports=c},{"../object/forOwn":70,"./isArray":55}],58:[function(a,b){function c(a){return d(a,"Function")}var d=a("./isKind");b.exports=c},{"./isKind":59}],59:[function(a,b){function c(a,b){return d(a)===b}var d=a("./kindOf");b.exports=c},{"./kindOf":65}],60:[function(a,b){function c(a){return d(a,"Number")}var d=a("./isKind");b.exports=c},{"./isKind":59}],61:[function(a,b){function c(a){return d(a,"Object")}var d=a("./isKind");b.exports=c},{"./isKind":59}],62:[function(a,b){function c(a){return!!a&&"object"==typeof a&&a.constructor===Object}b.exports=c},{}],63:[function(a,b){function c(a){return d(a,"RegExp")}var d=a("./isKind");b.exports=c},{"./isKind":59}],64:[function(a,b){function c(a){return d(a,"String")}var d=a("./isKind");b.exports=c},{"./isKind":59}],65:[function(a,b){function c(a){return null===a?"Null":a===d?"Undefined":e.exec(f.call(a))[1]}var d,e=/^\[object (.*)\]$/,f=Object.prototype.toString;b.exports=c},{}],66:[function(a,b){function c(a){return null==a?"":a.toString()}b.exports=c},{}],67:[function(a,b){function c(a,b){for(var c=-1,d=a.length;++c<d;)if(f(a[c],b))return!0;return!1}function d(a,b){for(var d=-1,e=b.length;++d<e;)if(!c(a,b[d]))return!1;return!0}function e(a,b){var c=!0;return g(b,function(b,d){return f(a[d],b)?void 0:c=!1}),c}function f(a,b){return a&&"object"==typeof a?h(a)&&h(b)?d(a,b):e(a,b):a===b}var g=a("./forOwn"),h=a("../lang/isArray");b.exports=f},{"../lang/isArray":55,"./forOwn":70}],68:[function(a,b){function c(a){for(var b,c=0,f=arguments.length;++c<f;)b=arguments[c],b&&e(b,d,a);return a}function d(a,b){var d=this[b];f(a)&&f(d)?c(d,a):this[b]=a}var e=a("./forOwn"),f=a("../lang/isPlainObject");b.exports=c},{"../lang/isPlainObject":62,"./forOwn":70}],69:[function(a,b){function c(){g=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],f=!0;for(var a in{toString:null})f=!1}function d(a,b,d){var i,j=0;null==f&&c();for(i in a)if(e(b,a,i,d)===!1)break;if(f)for(var k=a.constructor,l=!!k&&a===k.prototype;(i=g[j++])&&("constructor"===i&&(l||!h(a,i))||a[i]===Object.prototype[i]||e(b,a,i,d)!==!1););}function e(a,b,c,d){return a.call(d,b[c],c,b)}var f,g,h=a("./hasOwn");b.exports=d},{"./hasOwn":71}],70:[function(a,b){function c(a,b,c){e(a,function(e,f){return d(a,f)?b.call(c,a[f],f,a):void 0})}var d=a("./hasOwn"),e=a("./forIn");b.exports=c},{"./forIn":69,"./hasOwn":71}],71:[function(a,b){function c(a,b){return Object.prototype.hasOwnProperty.call(a,b)}b.exports=c},{}],72:[function(a,b){function c(){var a,b,g,h,i=1;for(h=e(arguments[0]);g=arguments[i++];)for(a in g)d(g,a)&&(b=g[a],h[a]=f(b)&&f(h[a])?c(h[a],b):e(b));return h}var d=a("./hasOwn"),e=a("../lang/deepClone"),f=a("../lang/isObject");b.exports=c},{"../lang/deepClone":54,"../lang/isObject":61,"./hasOwn":71}],73:[function(a,b){function c(a){for(var b,c=0,f=arguments.length;++c<f;)b=arguments[c],null!=b&&e(b,d,a);return a}function d(a,b){this[b]=a}var e=a("./forOwn");b.exports=c},{"./forOwn":70}],74:[function(a,b){function c(a,b){return b?(d(b.split("."),function(b){a[b]||(a[b]={}),a=a[b]}),a):a}var d=a("../array/forEach");b.exports=c},{"../array/forEach":43}],75:[function(a,b){function c(a){for(var b,c="string"!=typeof arguments[1]?arguments[1]:d(arguments,1),e={},f=0;b=c[f++];)e[b]=a[b];return e}var d=a("../array/slice");b.exports=c},{"../array/slice":47}],76:[function(a,b){function c(a,b,c){var e=/^(.+)\.(.+)$/.exec(b);e?d(a,e[1])[e[2]]=c:a[b]=c}var d=a("./namespace");b.exports=c},{"./namespace":74}],77:[function(a,b){function c(a){return a=d(a),a=e(a),a=f(a).replace(/[\-_]/g," ").replace(/\s[a-z]/g,g).replace(/\s+/g,"").replace(/^[A-Z]/g,h)}var d=a("../lang/toString"),e=a("./replaceAccents"),f=a("./removeNonWord"),g=a("./upperCase"),h=a("./lowerCase");b.exports=c},{"../lang/toString":66,"./lowerCase":78,"./removeNonWord":81,"./replaceAccents":82,"./upperCase":83}],78:[function(a,b){function c(a){return a=d(a),a.toLowerCase()}var d=a("../lang/toString");b.exports=c},{"../lang/toString":66}],79:[function(a,b){function c(){var a=d(e(arguments),"/");return a.replace(/([^:\/]|^)\/{2,}/g,"$1/")}var d=a("../array/join"),e=a("../array/slice");b.exports=c},{"../array/join":45,"../array/slice":47}],80:[function(a,b){function c(a){return a=d(a),e(a).replace(/^[a-z]/,f)}var d=a("../lang/toString"),e=a("./camelCase"),f=a("./upperCase");b.exports=c},{"../lang/toString":66,"./camelCase":77,"./upperCase":83}],81:[function(a,b){function c(a){return a=d(a),a.replace(e,"")}var d=a("../lang/toString"),e=/[^\x20\x2D0-9A-Z\x5Fa-z\xC0-\xD6\xD8-\xF6\xF8-\xFF]/g;b.exports=c},{"../lang/toString":66}],82:[function(a,b){function c(a){return a=d(a),a.search(/[\xC0-\xFF]/g)>-1&&(a=a.replace(/[\xC0-\xC5]/g,"A").replace(/[\xC6]/g,"AE").replace(/[\xC7]/g,"C").replace(/[\xC8-\xCB]/g,"E").replace(/[\xCC-\xCF]/g,"I").replace(/[\xD0]/g,"D").replace(/[\xD1]/g,"N").replace(/[\xD2-\xD6\xD8]/g,"O").replace(/[\xD9-\xDC]/g,"U").replace(/[\xDD]/g,"Y").replace(/[\xDE]/g,"P").replace(/[\xE0-\xE5]/g,"a").replace(/[\xE6]/g,"ae").replace(/[\xE7]/g,"c").replace(/[\xE8-\xEB]/g,"e").replace(/[\xEC-\xEF]/g,"i").replace(/[\xF1]/g,"n").replace(/[\xF2-\xF6\xF8]/g,"o").replace(/[\xF9-\xFC]/g,"u").replace(/[\xFE]/g,"p").replace(/[\xFD\xFF]/g,"y")),a}var d=a("../lang/toString");b.exports=c},{"../lang/toString":66}],83:[function(a,b){function c(a){return a=d(a),a.toUpperCase()}var d=a("../lang/toString");b.exports=c},{"../lang/toString":66}],84:[function(a,b){function c(a,b,c){var f=this,g=f.definitions[a];c=c||{},b=b||{};var h=new d.Promise(function(f,h){g?d.isObject(b)?(c=d._(g,c),f(b)):h(new e.IA('"attrs" must be an object!')):h(new e.NER(a))});return g&&c.upsert&&b[g.idAttribute]?f.update(a,b[g.idAttribute],b,c):h.then(function(a){return c.beforeValidate.call(a,c,a)}).then(function(a){return c.validate.call(a,c,a)}).then(function(a){return c.afterValidate.call(a,c,a)}).then(function(a){return c.beforeCreate.call(a,c,a)}).then(function(a){return c.notify&&f.emit(c,"beforeCreate",d.merge({},a)),f.getAdapter(c).create(g,a,c)}).then(function(a){return c.afterCreate.call(a,c,a)}).then(function(b){if(c.notify&&f.emit(c,"afterCreate",d.merge({},b)),c.cacheResponse){var e=f.inject(g.name,b,c),h=e[g.idAttribute];return f.store[a].completedQueries[h]=(new Date).getTime(),e}return f.createInstance(a,b,c)})}var d=a("../../utils"),e=a("../../errors");b.exports=c},{"../../errors":105,"../../utils":107}],85:[function(a,b){function c(a,b,c){var f,g=this,h=g.definitions[a];return new d.Promise(function(i,j){b=d.resolveId(h,b),h?d.isString(b)||d.isNumber(b)?(f=g.get(a,b)||{id:b},c=d._(h,c),i(f)):j(new e.IA('"id" must be a string or a number!')):j(new e.NER(a))}).then(function(a){return c.beforeDestroy.call(a,c,a)}).then(function(e){return c.notify&&g.emit(c,"beforeDestroy",d.merge({},e)),c.eagerEject&&g.eject(a,b),g.getAdapter(c).destroy(h,b,c)}).then(function(){return c.afterDestroy.call(f,c,f)}).then(function(e){return c.notify&&g.emit(c,"afterDestroy",d.merge({},e)),g.eject(a,b),b})["catch"](function(b){throw c&&c.eagerEject&&f&&g.inject(a,f,{notify:!1}),b})}var d=a("../../utils"),e=a("../../errors");b.exports=c},{"../../errors":105,"../../utils":107}],86:[function(a,b){function c(a,b,c){var f,g,h=this,i=h.definitions[a];return b=b||{},new d.Promise(function(f,g){i?d.isObject(b)?(c=d._(i,c),f()):g(new e.IA('"params" must be an object!')):g(new e.NER(a))}).then(function(){return g=h.defaults.defaultFilter.call(h,a,b),c.beforeDestroy(c,g)}).then(function(){return c.notify&&h.emit(c,"beforeDestroy",g),c.eagerEject&&(f=h.ejectAll(a,b)),h.getAdapter(c).destroyAll(i,b,c)}).then(function(){return c.afterDestroy(c,g)}).then(function(){return c.notify&&h.emit(c,"afterDestroy",g),f||h.ejectAll(a,b)})["catch"](function(b){throw c&&c.eagerEject&&f&&h.inject(a,f,{notify:!1}),b})}var d=a("../../utils"),e=a("../../errors");b.exports=c},{"../../errors":105,"../../utils":107}],87:[function(a,b){function c(a,b,c){var f=this,g=f.definitions[a],h=f.store[a];return new d.Promise(function(i,j){g?d.isString(b)||d.isNumber(b)?(c=d._(g,c),(c.bypassCache||!c.cacheResponse)&&delete h.completedQueries[b],b in h.completedQueries?i(f.get(a,b)):i()):j(new e.IA('"id" must be a string or a number!')):j(new e.NER(a))}).then(function(d){return b in h.completedQueries?d:(b in h.pendingQueries||(h.pendingQueries[b]=f.getAdapter(c).find(g,b,c).then(function(d){return delete h.pendingQueries[b],c.cacheResponse?(h.completedQueries[b]=(new Date).getTime(),f.inject(a,d,c)):f.createInstance(a,d,c)})),h.pendingQueries[b])})["catch"](function(a){throw h&&delete h.pendingQueries[b],a})}var d=a("../../utils"),e=a("../../errors");b.exports=c},{"../../errors":105,"../../utils":107}],88:[function(a,b){function c(a,b,c,d){var f=this,g=f.store[b],h=f.definitions[b].idAttribute,i=(new Date).getTime();a=a||[],delete g.pendingQueries[c],g.completedQueries[c]=i,g.collectionModified=e.updateTimestamp(g.collectionModified);var j=f.inject(b,a,d);return e.isArray(j)?e.forEach(j,function(a){a&&a[h]&&(g.completedQueries[a[h]]=i)}):(console.warn(errorPrefix(b)+"response is expected to be an array!"),g.completedQueries[j[h]]=i),j}function d(a,b,d){var g,h=this,i=h.definitions[a],j=h.store[a];return new e.Promise(function(c,k){b=b||{},h.definitions[a]?e.isObject(b)?(d=e._(i,d),g=e.toJson(b),(d.bypassCache||!d.cacheResponse)&&delete j.completedQueries[g],g in j.completedQueries?c(h.filter(a,b,d)):c()):k(new f.IA('"params" must be an object!')):k(new f.NER(a))}).then(function(f){return g in j.completedQueries?f:(g in j.pendingQueries||(j.pendingQueries[g]=h.getAdapter(d).findAll(i,b,d).then(function(b){return delete j.pendingQueries[g],d.cacheResponse?c.call(h,b,a,g,d):(e.forEach(b,function(c,e){b[e]=h.createInstance(a,c,d)}),b)})),j.pendingQueries[g])})["catch"](function(a){throw j&&delete j.pendingQueries[g],a})}var e=a("../../utils"),f=a("../../errors");
b.exports=d},{"../../errors":105,"../../utils":107}],89:[function(a,b){function c(a,b){var c=this,d=c.definitions[a],f=c.store[a];return new e.Promise(function(g,h){if(d){b=e._(d,b),b.hasOwnProperty("notify")||(b.notify=!1);for(var i,j=[],k=(new Date).getTime();(i=f.expiresHeap.peek())&&i.expires<k;)j.push(i.item),delete i.item,f.expiresHeap.pop();g(j)}else h(new c.errors.NER(a))}).then(function(g){if((b.isInterval||b.notify)&&c.emit(d,"beforeReap",g),"inject"===b.reapAction)e.forEach(g,function(a){var b=a[d.idAttribute];f.expiresHeap.push({item:a,timestamp:f.saved[b],expires:d.maxAge?f.saved[b]+d.maxAge:Number.MAX_VALUE})});else if("eject"===b.reapAction)e.forEach(g,function(b){c.eject(a,b[d.idAttribute])});else if("refresh"===b.reapAction){var h=[];return e.forEach(g,function(b){h.push(c.refresh(a,b[d.idAttribute]))}),e.Promise.all(h)}return g}).then(function(a){return(b.isInterval||b.notify)&&c.emit(d,"afterReap",a),a})}function d(a,b,c){var d=this;return new e.Promise(function(g,h){var i=d.definitions[a];b=e.resolveId(d.definitions[a],b),i?e.isString(b)||e.isNumber(b)?(c=e._(i,c),c.bypassCache=!0,g(d.get(a,b))):h(new f.IA('"id" must be a string or a number!')):h(new d.errors.NER(a))}).then(function(e){return e?d.find(a,b,c):e})}var e=a("../../utils"),f=a("../../errors");b.exports={create:a("./create"),destroy:a("./destroy"),destroyAll:a("./destroyAll"),find:a("./find"),findAll:a("./findAll"),loadRelations:a("./loadRelations"),reap:c,refresh:d,save:a("./save"),update:a("./update"),updateAll:a("./updateAll")}},{"../../errors":105,"../../utils":107,"./create":84,"./destroy":85,"./destroyAll":86,"./find":87,"./findAll":88,"./loadRelations":90,"./save":91,"./update":92,"./updateAll":93}],90:[function(a,b){function c(a,b,c,f){var g=this,h=g.definitions[a],i=[];return new d.Promise(function(j,k){if((d.isString(b)||d.isNumber(b))&&(b=g.get(a,b)),d.isString(c)&&(c=[c]),h)if(d.isObject(b))if(d.isArray(c)){f=d._(h,f),f.hasOwnProperty("findBelongsTo")||(f.findBelongsTo=!0),f.hasOwnProperty("findHasMany")||(f.findHasMany=!0);var l=[];d.forEach(h.relationList,function(a){var e=a.relation;if(d.contains(c,e)){var j,k={};f.allowSimpleWhere?k[a.foreignKey]=b[h.idAttribute]:(k.where={},k.where[a.foreignKey]={"==":b[h.idAttribute]}),"hasMany"===a.type&&k[a.foreignKey]?j=g.findAll(e,k,f):"hasOne"===a.type?a.localKey&&b[a.localKey]?j=g.find(e,b[a.localKey],f):a.foreignKey&&k[a.foreignKey]&&(j=g.findAll(e,k,f).then(function(a){return a.length?a[0]:null})):b[a.localKey]&&(j=g.find(e,b[a.localKey],f)),j&&(l.push(j),i.push(a.localField))}}),j(l)}else k(new e.IA('"relations" must be a string or an array!'));else k(new e.IA('"instance(id)" must be a string, number or object!'));else k(new e.NER(a))}).then(function(a){return d.Promise.all(a)}).then(function(a){return d.forEach(i,function(c,d){b[c]=a[d]}),b})}var d=a("../../utils"),e=a("../../errors");b.exports=c},{"../../errors":105,"../../utils":107}],91:[function(a,b){function c(a,b,c){var f,g=this,h=g.definitions[a];return new d.Promise(function(i,j){b=d.resolveId(h,b),h?d.isString(b)||d.isNumber(b)?g.get(a,b)?(f=g.get(a,b),c=d._(h,c),i(f)):j(new e.R('id "'+b+'" not found in cache!')):j(new e.IA('"id" must be a string or a number!')):j(new e.NER(a))}).then(function(a){return c.beforeValidate.call(a,c,a)}).then(function(a){return c.validate.call(a,c,a)}).then(function(a){return c.afterValidate.call(a,c,a)}).then(function(a){return c.beforeUpdate.call(a,c,a)}).then(function(e){if(c.notify&&g.emit(c,"beforeUpdate",d.merge({},e)),c.changesOnly){var f=g.store[a];d.w&&f.observers[b].deliver();var i=[],j=g.changes(a,b);for(var k in j.added)i.push(k);for(k in j.changed)i.push(k);if(j=d.pick(e,i),d.isEmpty(j))return e;e=j}return g.getAdapter(c).update(h,b,e,c)}).then(function(a){return c.afterUpdate.call(a,c,a)}).then(function(a){return c.notify&&g.emit(c,"afterUpdate",d.merge({},a)),c.cacheResponse?g.inject(h.name,a,c):a})}var d=a("../../utils"),e=a("../../errors");b.exports=c},{"../../errors":105,"../../utils":107}],92:[function(a,b){function c(a,b,c,f){var g=this,h=g.definitions[a];return new d.Promise(function(g,i){b=d.resolveId(h,b),h?d.isString(b)||d.isNumber(b)?(f=d._(h,f),g(c)):i(new e.IA('"id" must be a string or a number!')):i(new e.NER(a))}).then(function(a){return f.beforeValidate.call(a,f,a)}).then(function(a){return f.validate.call(a,f,a)}).then(function(a){return f.afterValidate.call(a,f,a)}).then(function(a){return f.beforeUpdate.call(a,f,a)}).then(function(a){return f.notify&&g.emit(f,"beforeUpdate",d.merge({},a)),g.getAdapter(f).update(h,b,a,f)}).then(function(a){return f.afterUpdate.call(a,f,a)}).then(function(a){return f.notify&&g.emit(f,"afterUpdate",d.merge({},a)),f.cacheResponse?g.inject(h.name,a,f):a})}var d=a("../../utils"),e=a("../../errors");b.exports=c},{"../../errors":105,"../../utils":107}],93:[function(a,b){function c(a,b,c,f){var g=this,h=g.definitions[a];return new d.Promise(function(c,g){h?(f=d._(h,f),c(b)):g(new e.NER(a))}).then(function(a){return f.beforeValidate.call(a,f,a)}).then(function(a){return f.validate.call(a,f,a)}).then(function(a){return f.afterValidate.call(a,f,a)}).then(function(a){return f.beforeUpdate.call(a,f,a)}).then(function(a){return f.notify&&g.emit(f,"beforeUpdate",d.merge({},a)),g.getAdapter(f).updateAll(h,a,c,f)}).then(function(a){return f.afterUpdate.call(a,f,a)}).then(function(a){return f.notify&&g.emit(f,"afterUpdate",d.merge({},b)),f.cacheResponse?g.inject(h.name,a,f):a})}var d=a("../../utils"),e=a("../../errors");b.exports=c},{"../../errors":105,"../../utils":107}],94:[function(a,b){function c(a,b,c){c(null,b)}function d(a,b){return b}function e(a,b,c,d){var f=a[b],g=c[f[0]],h=d[f[0]];return i.isString(g)&&(g=i.upperCase(g)),i.isString(h)&&(h=i.upperCase(h)),"DESC"===f[1]?g>h?-1:h>g?1:b<a.length-1?e(a,b+1,c,d):0:h>g?-1:g>h?1:b<a.length-1?e(a,b+1,c,d):0}function f(){}function g(b){b=b||{};try{h=a("js-data-schema")}catch(c){}if(!h)try{h=window.Schemator}catch(c){}(h||b.schemator)&&(this.schemator=b.schemator||new h),this.store={},this.definitions={},this.adapters={},this.defaults=new f,this.observe=l,i.deepMixIn(this.defaults,b)}var h,i=a("../utils"),j=(a("../errors"),a("./sync_methods")),k=a("./async_methods"),l=a("../../lib/observe-js/observe-js"),m=f.prototype;m.idAttribute="id",m.basePath="",m.endpoint="",m.useClass=!0,m.keepChangeHistory=!1,m.resetHistoryOnInject=!0,m.eagerEject=!1,m.eagerInject=!1,m.allowSimpleWhere=!0,m.defaultAdapter="http",m.loadFromServer=!1,m.notify=!!i.w,m.upsert=!!i.w,m.cacheResponse=!!i.w,m.bypassCache=!1,m.ignoreMissing=!1,m.findInverseLinks=!1,m.findBelongsTo=!1,m.findHasOn=!1,m.findHasMany=!1,m.reapInterval=i.w?3e4:!1,m.reapAction=i.w?"inject":"none",m.maxAge=!1,m.ignoredChanges=[/\$/],m.beforeValidate=c,m.validate=c,m.afterValidate=c,m.beforeCreate=c,m.afterCreate=c,m.beforeUpdate=c,m.afterUpdate=c,m.beforeDestroy=c,m.afterDestroy=c,m.beforeCreateInstance=d,m.afterCreateInstance=d,m.beforeInject=d,m.afterInject=d,m.beforeEject=d,m.afterEject=d,m.defaultFilter=function(a,b,c,d){var f=this,g=a,h=null,j={skip:"",offset:"",where:"",limit:"",orderBy:"",sort:""};c=c||{},d=d||{},h=i.isObject(c.where)?c.where:{},d.allowSimpleWhere&&i.forOwn(c,function(a,b){b in j||b in h||(h[b]={"==":a})}),i.isEmpty(h)&&(h=null),h&&(g=i.filter(g,function(a){var b=!0,c=!0;return i.forOwn(h,function(d,e){i.isString(d)?d={"===":d}:(i.isNumber(d)||i.isBoolean(d))&&(d={"==":d}),i.isObject(d)&&i.forOwn(d,function(d,f){"=="===f?c=b?a[e]==d:c&&a[e]==d:"==="===f?c=b?a[e]===d:c&&a[e]===d:"!="===f?c=b?a[e]!=d:c&&a[e]!=d:"!=="===f?c=b?a[e]!==d:c&&a[e]!==d:">"===f?c=b?a[e]>d:c&&a[e]>d:">="===f?c=b?a[e]>=d:c&&a[e]>=d:"<"===f?c=b?a[e]<d:c&&a[e]<d:"<="===f?c=b?a[e]<=d:c&&a[e]<=d:"in"===f?c=i.isString(d)?b?-1!==d.indexOf(a[e]):c&&-1!==d.indexOf(a[e]):b?i.contains(d,a[e]):c&&i.contains(d,a[e]):"notIn"===f?c=i.isString(d)?b?-1===d.indexOf(a[e]):c&&-1===d.indexOf(a[e]):b?!i.contains(d,a[e]):c&&!i.contains(d,a[e]):"|=="===f?c=b?a[e]==d:c||a[e]==d:"|==="===f?c=b?a[e]===d:c||a[e]===d:"|!="===f?c=b?a[e]!=d:c||a[e]!=d:"|!=="===f?c=b?a[e]!==d:c||a[e]!==d:"|>"===f?c=b?a[e]>d:c||a[e]>d:"|>="===f?c=b?a[e]>=d:c||a[e]>=d:"|<"===f?c=b?a[e]<d:c||a[e]<d:"|<="===f?c=b?a[e]<=d:c||a[e]<=d:"|in"===f?c=i.isString(d)?b?-1!==d.indexOf(a[e]):c||-1!==d.indexOf(a[e]):b?i.contains(d,a[e]):c||i.contains(d,a[e]):"|notIn"===f&&(c=i.isString(d)?b?-1===d.indexOf(a[e]):c||-1===d.indexOf(a[e]):b?!i.contains(d,a[e]):c||!i.contains(d,a[e])),b=!1})}),c}));var k=null;if(i.isString(c.orderBy)?k=[[c.orderBy,"ASC"]]:i.isArray(c.orderBy)&&(k=c.orderBy),!k&&i.isString(c.sort)?k=[[c.sort,"ASC"]]:!k&&i.isArray(c.sort)&&(k=c.sort),k){var l=0;i.forEach(k,function(a,b){if(i.isString(a))k[b]=[a,"ASC"];else if(!i.isArray(a))throw new f.errors.IllegalArgumentError("DS.filter(resourceName[, params][, options]): "+i.toJson(a)+": Must be a string or an array!",{params:{"orderBy[i]":{actual:typeof a,expected:"string|array"}}})}),g=i.sort(g,function(a,b){return e(k,l,a,b)})}var m=i.isNumber(c.limit)?c.limit:null,n=null;return i.isNumber(c.skip)?n=c.skip:i.isNumber(c.offset)&&(n=c.offset),m&&n?g=i.slice(g,n,Math.min(g.length,n+m)):i.isNumber(m)?g=i.slice(g,0,Math.min(g.length,m)):i.isNumber(n)&&(g=n<g.length?i.slice(g,n):[]),g};var n=g.prototype;n.getAdapter=function(a){return a=a||{},this.adapters[a.adapter]||this.adapters[a.defaultAdapter]},n.registerAdapter=function(a,b,c){c=c||{},this.adapters[a]=i.isFunction(b)?new b(c):b,c.default&&(this.defaults.defaultAdapter=a)},n.emit=function(a,b){var c=Array.prototype.slice.call(arguments,2);c.unshift(a.name),c.unshift("DS."+b),a.emit.apply(a,c)},n.errors=a("../errors"),n.utils=i,i.deepMixIn(n,j),i.deepMixIn(n,k),b.exports=g},{"../../lib/observe-js/observe-js":1,"../errors":105,"../utils":107,"./async_methods":89,"./sync_methods":99,"js-data-schema":"js-data-schema"}],95:[function(require,module,exports){function Resource(a){DSUtils.deepMixIn(this,a),this.endpoint="endpoint"in a?a.endpoint:this.name}function defineResource(definition){var _this=this,definitions=_this.definitions;if(DSUtils.isString(definition)&&(definition={name:definition.replace(/\s/gi,"")}),!DSUtils.isObject(definition))throw new DSErrors.IA('"definition" must be an object!');if(!DSUtils.isString(definition.name))throw new DSErrors.IA('"name" must be a string!');if(_this.store[definition.name])throw new DSErrors.R(definition.name+" is already registered!");try{Resource.prototype=_this.defaults,definitions[definition.name]=new Resource(definition);var def=definitions[definition.name];if(!DSUtils.isString(def.idAttribute))throw new DSErrors.IA('"idAttribute" must be a string!');def.relations&&(def.relationList=[],def.relationFields=[],DSUtils.forOwn(def.relations,function(a,b){DSUtils.forOwn(a,function(c,d){DSUtils.isArray(c)||(a[d]=[c]),DSUtils.forEach(a[d],function(a){a.type=b,a.relation=d,a.name=def.name,def.relationList.push(a),def.relationFields.push(a.localField)})})}),def.relations.belongsTo&&DSUtils.forOwn(def.relations.belongsTo,function(a,b){DSUtils.forEach(a,function(a){a.parent&&(def.parent=b,def.parentKey=a.localKey)})}),"function"==typeof Object.freeze&&(Object.freeze(def.relations),Object.freeze(def.relationList))),def.getEndpoint=function(a,b){b=DSUtils.deepMixIn({},b);var c,d,e=this.parent,f=this.parentKey,g=b.endpoint||this.endpoint,h=definitions[e];return delete b.endpoint,b=b||{},b.params=b.params||{},e&&f&&h&&b.params[f]!==!1&&((DSUtils.isNumber(a)||DSUtils.isString(a))&&(c=_this.get(this.name,a)),DSUtils.isObject(a)&&f in a?(delete b.params[f],d=DSUtils.makePath(h.getEndpoint(a,b),a[f],g)):c&&f in c?(delete b.params[f],d=DSUtils.makePath(h.getEndpoint(a,b),c[f],g)):b&&b.params[f]&&(d=DSUtils.makePath(h.getEndpoint(a,b),b.params[f],g),delete b.params[f])),b.params[f]===!1&&delete b.params[f],d||g},def.filter&&(def.defaultFilter=def.filter,delete def.filter),def["class"]=DSUtils.pascalCase(definition.name);try{eval("function "+def["class"]+"() {}"),def[def["class"]]=eval(def["class"])}catch(e){def[def["class"]]=function(){}}def.methods&&DSUtils.deepMixIn(def[def["class"]].prototype,def.methods),def.computed&&DSUtils.forOwn(def.computed,function(a,b){DSUtils.isFunction(a)&&(def.computed[b]=[a],a=def.computed[b]),def.methods&&b in def.methods&&console.warn('Computed property "'+b+'" conflicts with previously defined prototype method!');var c;if(1===a.length){var d=a[0].toString().match(/function.*?\(([\s\S]*?)\)/);c=d[1].split(","),def.computed[b]=c.concat(a),a=def.computed[b],c.length&&console.warn("Use the computed property array syntax for compatibility with minified code!")}c=a.slice(0,a.length-1),DSUtils.forEach(c,function(a,b){c[b]=a.trim()}),a.deps=DSUtils.filter(c,function(a){return!!a})}),definition.schema&&_this.schemator&&(def.schema=_this.schemator.defineSchema(def.name,definition.schema),definition.hasOwnProperty("validate")||(def.validate=function(a,b,c){def.schema.validate(b,{ignoreMissing:def.ignoreMissing},function(a){return a?c(a):c(null,b)})})),DSUtils.forEach(instanceMethods,function(a){def[def["class"]].prototype["DS"+DSUtils.pascalCase(a)]=function(){var b=Array.prototype.slice.call(arguments);return b.unshift(this[def.idAttribute]||this),b.unshift(def.name),_this[a].apply(_this,b)}}),_this.store[def.name]={collection:[],expiresHeap:new DSUtils.DSBinaryHeap(function(a){return a.expires},function(a,b){return a.item===b}),completedQueries:{},pendingQueries:{},index:{},modified:{},saved:{},previousAttributes:{},observers:{},changeHistories:{},changeHistory:[],collectionModified:0},def.reapInterval&&setInterval(function(){_this.reap(def.name,{isInterval:!0})},def.reapInterval);for(var key in _this)"function"==typeof _this[key]&&"defineResource"!==key&&!function(a){def[a]=function(){var b=Array.prototype.slice.call(arguments);return b.unshift(def.name),_this[a].apply(_this,b)}}(key);return def.beforeValidate=DSUtils.promisify(def.beforeValidate),def.validate=DSUtils.promisify(def.validate),def.afterValidate=DSUtils.promisify(def.afterValidate),def.beforeCreate=DSUtils.promisify(def.beforeCreate),def.afterCreate=DSUtils.promisify(def.afterCreate),def.beforeUpdate=DSUtils.promisify(def.beforeUpdate),def.afterUpdate=DSUtils.promisify(def.afterUpdate),def.beforeDestroy=DSUtils.promisify(def.beforeDestroy),def.afterDestroy=DSUtils.promisify(def.afterDestroy),DSUtils.Events(def),def}catch(err){throw console.error(err),delete definitions[definition.name],delete _this.store[definition.name],err}}var DSUtils=require("../../utils"),DSErrors=require("../../errors"),instanceMethods=["compute","refresh","save","update","destroy","loadRelations","changeHistory","changes","hasChanges","lastModified","lastSaved","link","linkInverse","previous","unlinkInverse"];module.exports=defineResource},{"../../errors":105,"../../utils":107}],96:[function(a,b){function c(a,b,c){var f,g=this,h=g.definitions[a],i=g.store[a],j=!1;if(b=d.resolveId(h,b),!h)throw new e.NER(a);if(!d.isString(b)&&!d.isNumber(b))throw new e.IA('"id" must be a string or a number!');c=d._(h,c);for(var k=0;k<i.collection.length;k++)if(i.collection[k][h.idAttribute]==b){f=i.collection[k],i.expiresHeap.remove(f),j=!0;break}return j?(c.notify&&h.beforeEject(c,f),g.unlinkInverse(h.name,b),i.collection.splice(k,1),d.w&&i.observers[b].close(),delete i.observers[b],delete i.index[b],delete i.previousAttributes[b],delete i.completedQueries[b],delete i.pendingQueries[b],d.forEach(i.changeHistories[b],function(a){d.remove(i.changeHistory,a)}),delete i.changeHistories[b],delete i.modified[b],delete i.saved[b],i.collectionModified=d.updateTimestamp(i.collectionModified),c.notify&&(h.afterEject(c,f),g.emit(h,"eject",f)),f):void 0}var d=a("../../utils"),e=a("../../errors");b.exports=c},{"../../errors":105,"../../utils":107}],97:[function(a,b){function c(a,b,c){var f=this,g=f.definitions[a];if(b=b||{},!g)throw new e.NER(a);if(!d.isObject(b))throw new e.IA('"params" must be an object!');var h=f.store[a];d.isEmpty(b)&&(h.completedQueries={});var i=d.toJson(b),j=f.filter(g.name,b),k=d.toLookup(j,g.idAttribute);return d.forOwn(k,function(a,b){f.eject(g.name,b,c)}),delete h.completedQueries[i],h.collectionModified=d.updateTimestamp(h.collectionModified),j}var d=a("../../utils"),e=a("../../errors");b.exports=c},{"../../errors":105,"../../utils":107}],98:[function(a,b){function c(a,b,c){var f=this,g=f.definitions[a],h=f.store[a];if(!g)throw new e.NER(a);if(b&&!d.isObject(b))throw new e.IA('"params" must be an object!');c=d._(g,c),b=b||{};var i=d.toJson(b);return i in h.completedQueries||!c.loadFromServer||h.pendingQueries[i]||f.findAll(a,b,c),g.defaultFilter.call(f,h.collection,a,b,c)}var d=a("../../utils"),e=a("../../errors");b.exports=c},{"../../errors":105,"../../utils":107}],99:[function(a,b){function c(a,b,c){var d=this,e=d.definitions[a];if(c=c||{},b=o.resolveId(e,b),!e)throw new q(a);if(!o.isString(b)&&!o.isNumber(b))throw new r('"id" must be a string or a number!');c=o._(e,c);var f=d.get(a,b);if(f){o.w&&d.store[a].observers[b].deliver();var g=o.diffObjectFromOldObject(f,d.store[a].previousAttributes[b],c.ignoredChanges);return o.forOwn(g,function(a,b){var c=[];o.forOwn(a,function(a,b){o.isFunction(a)||c.push(b)}),g[b]=o.pick(g[b],c)}),o.forEach(e.relationFields,function(a){delete g.added[a],delete g.removed[a],delete g.changed[a]}),g}}function d(a,b){var c=this,d=c.definitions[a],e=c.store[a];if(b=o.resolveId(d,b),a&&!c.definitions[a])throw new q(a);if(b&&!o.isString(b)&&!o.isNumber(b))throw new r('"id" must be a string or a number!');if(d.keepChangeHistory){if(!a)return e.changeHistory;var f=c.get(a,b);if(f)return e.changeHistories[b]}else console.warn("changeHistory is disabled for this resource!")}function e(a,b){var c=this,d=c.definitions[a];if(b=o.resolveItem(c.store[a],b),!d)throw new q(a);if(!o.isObject(b)&&!o.isString(b)&&!o.isNumber(b))throw new r('"instance" must be an object, string or number!');return(o.isString(b)||o.isNumber(b))&&(b=c.get(a,b)),o.forOwn(d.computed,function(a,c){o.compute.call(b,a,c,o)}),b}function f(a,b,c){var d,e=this.definitions[a];if(b=b||{},!e)throw new q(a);if(b&&!o.isObject(b))throw new r('"attrs" must be an object!');if(c=o._(e,c),c.notify&&c.beforeCreateInstance(c,b),c.useClass){var f=e[e.class];d=new f}else d={};return o.deepMixIn(d,b),c.notify&&c.afterCreateInstance(c,b),d}function g(a){return!(o.isEmpty(a.added)&&o.isEmpty(a.removed)&&o.isEmpty(a.changed))}function h(){this.observe.Platform.performMicrotaskCheckpoint()}function i(a,b,c){var d=this,e=d.definitions[a];if(!e)throw new q(a);if(!o.isString(b)&&!o.isNumber(b))throw new r('"id" must be a string or a number!');c=o._(e,c);var f=d.store[a].index[b];return!f&&c.loadFromServer&&d.find(a,b,c),f}function j(a,b){var c=this,d=c.store[a],e=[];if(!c.definitions[a])throw new q(a);if(b&&!o.isArray(b))throw new r('"ids" must be an array!');if(o.isArray(b))for(var f=b.length,g=0;f>g;g++)d.index[b[g]]&&e.push(d.index[b[g]]);else e=d.collection.slice();return e}function k(a,b){var c=this;if(b=o.resolveId(c.definitions[a],b),!c.definitions[a])throw new q(a);if(!o.isString(b)&&!o.isNumber(b))throw new r('"id" must be a string or a number!');return c.get(a,b)?g(c.changes(a,b)):!1}function l(a,b){var c=this.definitions[a],d=this.store[a];if(b=o.resolveId(c,b),!c)throw new q(a);return b?(b in d.modified||(d.modified[b]=0),d.modified[b]):d.collectionModified}function m(a,b){var c=this.definitions[a],d=this.store[a];if(b=o.resolveId(c,b),!c)throw new q(a);return b in d.saved||(d.saved[b]=0),d.saved[b]}function n(a,b){var c=this,d=c.definitions[a],e=c.store[a];if(b=o.resolveId(d,b),!d)throw new q(a);if(!o.isString(b)&&!o.isNumber(b))throw new r('"id" must be a string or a number!');return e.previousAttributes[b]?o.merge({},e.previousAttributes[b]):void 0}var o=a("../../utils"),p=a("../../errors"),q=p.NER,r=p.IA;b.exports={changes:c,changeHistory:d,compute:e,createInstance:f,defineResource:a("./defineResource"),digest:h,eject:a("./eject"),ejectAll:a("./ejectAll"),filter:a("./filter"),get:i,getAll:j,hasChanges:k,inject:a("./inject"),lastModified:l,lastSaved:m,link:a("./link"),linkAll:a("./linkAll"),linkInverse:a("./linkInverse"),previous:n,unlinkInverse:a("./unlinkInverse")}},{"../../errors":105,"../../utils":107,"./defineResource":95,"./eject":96,"./ejectAll":97,"./filter":98,"./inject":100,"./link":101,"./linkAll":102,"./linkInverse":103,"./unlinkInverse":104}],100:[function(a,b){function c(a,b,c){var d=this;h.forEach(a.relationList,function(e){var f=e.relation,g=d.definitions[f];if(b[e.localField]){if(!g)throw new i.R(a.name+" relation is defined, but the resource is not!");try{b[e.localField]=d.inject(f,b[e.localField],c)}catch(h){console.error(a.name+": Failed to inject "+e.type+' relation: "'+f+'"!',h)}}})}function d(a,b,c){var d=b.name;return function(e,f,g,i,j){var k,l=this,m=i&&i(b.idAttribute)?i(b.idAttribute):l[b.idAttribute];if(h.forEach(b.relationFields,function(a){delete e[a],delete f[a],delete g[a]}),(!h.isEmpty(e)||!h.isEmpty(f)||!h.isEmpty(g)||j)&&(k=a.get(d,m),c.modified[m]=h.updateTimestamp(c.modified[m]),c.collectionModified=h.updateTimestamp(c.collectionModified),b.keepChangeHistory)){var n={resourceName:d,target:k,added:e,removed:f,changed:g,timestamp:c.modified[m]};c.changeHistories[m].push(n),c.changeHistory.push(n)}b.computed&&(k=k||a.get(d,m),h.forOwn(b.computed,function(a,b){var c=!1;h.forEach(a.deps,function(a){(a in e||a in f||a in g||!(b in k))&&(c=!0)}),c=c||!a.deps.length,c&&h.compute.call(k,a,b,h)})),b.relations&&(k=k||a.get(d,m),h.forEach(b.relationList,function(c){k[c.localField]&&(c.localKey in e||c.localKey in f||c.localKey in g)&&a.link(d,k[b.idAttribute],[c.relation])})),b.idAttribute in g&&console.error("Doh! You just changed the primary key of an object! Your data for the"+d+'" resource is now in an undefined (probably broken) state.')}}function e(a,b,f,g){var j,k=this,l=d(k,a,b,f,g);if(h.isArray(f)){j=[];for(var m=0;m<f.length;m++)j.push(e.call(k,a,b,f[m],g))}else{var n=a.computed,o=a.idAttribute;if(n&&n[o]){var p=[];h.forEach(n[o].deps,function(a){p.push(f[a])}),f[o]=n[o][n[o].length-1].apply(f,p)}if(!(o in f)){var q=new i.R(a.name+'.inject: "attrs" must contain the property specified by `idAttribute`!');throw console.error(q),q}try{var r=f[o],s=k.get(a.name,r),t=s?b.modified[r]:0;s?(h.deepMixIn(s,f),a.resetHistoryOnInject&&(b.previousAttributes[r]={},h.deepMixIn(b.previousAttributes[r],f),b.changeHistories[r].length&&(h.forEach(b.changeHistories[r],function(a){h.remove(b.changeHistory,a)}),b.changeHistories[r].splice(0,b.changeHistories[r].length))),h.w&&b.observers[r].deliver()):(s=g.useClass?f instanceof a[a["class"]]?f:new a[a["class"]]:{},b.previousAttributes[r]={},h.deepMixIn(s,f),h.deepMixIn(b.previousAttributes[r],f),b.collection.push(s),b.changeHistories[r]=[],h.w&&(b.observers[r]=new k.observe.ObjectObserver(s),b.observers[r].open(l,s)),b.index[r]=s,l.call(s,{},{},{},null,!0),a.relations&&c.call(k,a,s,g)),b.saved[r]=h.updateTimestamp(b.saved[r]),b.modified[r]=t&&b.modified[r]===t?h.updateTimestamp(b.modified[r]):b.modified[r],b.expiresHeap.remove(s),b.expiresHeap.push({item:s,timestamp:b.saved[r],expires:a.maxAge?b.saved[r]+a.maxAge:Number.MAX_VALUE}),j=s}catch(u){console.error(u.stack),console.error("inject failed!",a.name,f)}}return j}function f(a,b,c){var d=this;h.forEach(a.relationList,function(e){c.findBelongsTo&&"belongsTo"===e.type&&b[a.idAttribute]?d.link(a.name,b[a.idAttribute],[e.relation]):(c.findHasMany&&"hasMany"===e.type||c.findHasOne&&"hasOne"===e.type)&&d.link(a.name,b[a.idAttribute],[e.relation])})}function g(a,b,c){var d,g=this,j=g.definitions[a],k=g.store[a];if(!j)throw new i.NER(a);if(!h.isObject(b)&&!h.isArray(b))throw new i.IA(a+'.inject: "attrs" must be an object or an array!');var l=j.name;return c=h._(j,c),c.notify&&c.beforeInject(c,b),d=e.call(g,j,k,b,c),k.collectionModified=h.updateTimestamp(k.collectionModified),c.findInverseLinks&&(h.isArray(d)?d.length&&g.linkInverse(l,d[0][j.idAttribute]):g.linkInverse(l,d[j.idAttribute])),h.isArray(d)?h.forEach(d,function(a){f.call(g,j,a,c)}):f.call(g,j,d,c),c.notify&&(c.afterInject(c,d),g.emit(c,"inject",d)),d}var h=a("../../utils"),i=a("../../errors");b.exports=g},{"../../errors":105,"../../utils":107}],101:[function(a,b){function c(a,b,c){var f=this,g=f.definitions[a];if(c=c||[],b=d.resolveId(g,b),!g)throw new e.NER(a);if(!d.isString(b)&&!d.isNumber(b))throw new e.IA('"id" must be a string or a number!');if(!d.isArray(c))throw new e.IA('"relations" must be an array!');var h=f.get(a,b);return h&&d.forEach(g.relationList,function(a){var b=a.relation;if(!c.length||d.contains(c,b)){var e={};if("belongsTo"===a.type){var i=h[a.localKey]?f.get(b,h[a.localKey]):null;i&&(h[a.localField]=i)}else if("hasMany"===a.type)e[a.foreignKey]=h[g.idAttribute],h[a.localField]=f.defaults.constructor.prototype.defaultFilter.call(f,f.store[b].collection,b,e,{allowSimpleWhere:!0});else if("hasOne"===a.type){e[a.foreignKey]=h[g.idAttribute];var j=f.defaults.constructor.prototype.defaultFilter.call(f,f.store[b].collection,b,e,{allowSimpleWhere:!0});j.length&&(h[a.localField]=j[0])}}}),h}var d=a("../../utils"),e=a("../../errors");b.exports=c},{"../../errors":105,"../../utils":107}],102:[function(a,b){function c(a,b,c){var f=this,g=f.definitions[a];if(c=c||[],!g)throw new e.NER(a);if(!d.isArray(c))throw new e.IA('"relations" must be an array!');var h=f.filter(a,b);return h&&d.forEach(g.relationList,function(a){var b=a.relation;(!c.length||d.contains(c,b))&&("belongsTo"===a.type?d.forEach(h,function(c){var d=c[a.localKey]?f.get(b,c[a.localKey]):null;d&&(c[a.localField]=d)}):"hasMany"===a.type?d.forEach(h,function(c){var d={};d[a.foreignKey]=c[g.idAttribute],c[a.localField]=f.defaults.constructor.prototype.defaultFilter.call(f,f.store[b].collection,b,d,{allowSimpleWhere:!0})}):"hasOne"===a.type&&d.forEach(h,function(c){var d={};d[a.foreignKey]=c[g.idAttribute];var e=f.defaults.constructor.prototype.defaultFilter.call(f,f.store[b].collection,b,d,{allowSimpleWhere:!0});e.length&&(c[a.localField]=e[0])}))}),h}var d=a("../../utils"),e=a("../../errors");b.exports=c},{"../../errors":105,"../../utils":107}],103:[function(a,b){function c(a,b,c){var f=this,g=f.definitions[a];if(c=c||[],b=d.resolveId(g,b),!g)throw new e.NER(a);if(!d.isString(b)&&!d.isNumber(b))throw new e.IA('"id" must be a string or a number!');if(!d.isArray(c))throw new e.IA('"relations" must be an array!');var h=f.get(a,b);return h&&d.forOwn(f.definitions,function(a){d.forOwn(a.relations,function(b){d.forOwn(b,function(b,e){(!c.length||d.contains(c,a.name))&&g.name===e&&f.linkAll(a.name,{},[g.name])})})}),h}var d=a("../../utils"),e=a("../../errors");b.exports=c},{"../../errors":105,"../../utils":107}],104:[function(a,b){function c(a,b,c){var f=this,g=f.definitions[a];if(c=c||[],b=d.resolveId(g,b),!g)throw new e.NER(a);if(!d.isString(b)&&!d.isNumber(b))throw new e.IA('"id" must be a string or a number!');if(!d.isArray(c))throw new e.IA('"relations" must be an array!');var h=f.get(a,b);return h&&d.forOwn(f.definitions,function(a){d.forOwn(a.relations,function(a){d.forOwn(a,function(a,b){g.name===b&&d.forEach(a,function(a){d.forEach(f.store[a.name].collection,function(b){if("hasMany"===a.type&&b[a.localField]){var c;d.forEach(b[a.localField],function(a,b){a===h&&(c=b)}),b[a.localField].splice(c,1)}else b[a.localField]===h&&delete b[a.localField]})})})})}),h}var d=a("../../utils"),e=a("../../errors");b.exports=c},{"../../errors":105,"../../utils":107}],105:[function(a,b){function c(a){Error.call(this),"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.type=this.constructor.name,this.message=a||"Illegal Argument!"}function d(a){Error.call(this),"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.type=this.constructor.name,this.message=a||"RuntimeError Error!"}function e(a){Error.call(this),"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor),this.type=this.constructor.name,this.message=(a||"")+" is not a registered resource!"}c.prototype=new Error,c.prototype.constructor=c,d.prototype=new Error,d.prototype.constructor=d,e.prototype=new Error,e.prototype.constructor=e,b.exports={IllegalArgumentError:c,IA:c,RuntimeError:d,R:d,NonexistentResourceError:e,NER:e}},{}],106:[function(a,b){var c=a("./datastore");b.exports={DS:c,createStore:function(a){return new c(a)},DSUtils:a("./utils"),DSErrors:a("./errors")}},{"./datastore":94,"./errors":105,"./utils":107}],107:[function(a,b){function c(a){var b=this.constructor;return this.then(function(c){return b.resolve(a()).then(function(){return c})},function(c){return b.resolve(a()).then(function(){throw c})})}function d(a){var b="function"==typeof Date.now?Date.now():(new Date).getTime();return a&&a>=b?a+1:b}function e(a){var b={};a=a||this,a.on=function(a,c,d){b[a]=b[a]||[],b[a].push({f:c,c:d})},a.off=function(a,c){var d=b[a];if(d)if(c){for(var e=0;e<d.length;e++)if(d[e]===c){d.splice(e,1);break}}else d.splice(0,d.length);else b={}},a.emit=function(){var a=Array.prototype.slice.call(arguments),c=b[a.shift()]||[];if(c)for(var d=0;d<c.length;d++)c[d].f.apply(c[d].c,a)}}function f(a,b,c){for(var d=a[c],e=b(d);c>0;){var f=Math.floor((c+1)/2)-1,g=a[f];if(e>=b(g))break;a[f]=d,a[c]=g,c=f}}function g(a,b,c){for(var d=a.length,e=a[c],f=b(e);;){var g=2*(c+1),h=g-1,i=null;if(d>h){var j=a[h],k=b(j);f>k&&(i=h)}if(d>g){var l=a[g],m=b(l);m<(null===i?f:b(a[h]))&&(i=g)}if(null===i)break;a[c]=a[i],a[i]=e,c=i}}function h(a,b){if(a&&!m(a))throw new Error("DSBinaryHeap(weightFunc): weightFunc: must be a function!");a=a||function(a){return a},b=b||function(a,b){return a===b},this.weightFunc=a,this.compareFunc=b,this.heap=[]}function i(a,b){if(!b||!b.length)return!1;var c=r(b,function(b){return s(b)&&b.test(a)||b===a?a:void 0});return!!c}var j,k,l=a("./errors"),m=a("mout/lang/isFunction"),n=a("es6-promise");n.polyfill();try{j=window,j.Promise.prototype["finally"]||(j.Promise.prototype["finally"]=c),k=j.Promise,j={}}catch(o){j=null,k=a("bluebird")}var p=h.prototype;p.push=function(a){this.heap.push(a),f(this.heap,this.weightFunc,this.heap.length-1)},p.peek=function(){return this.heap[0]},p.pop=function(){var a=this.heap[0],b=this.heap.pop();return this.heap.length>0&&(this.heap[0]=b,g(this.heap,this.weightFunc,0)),a},p.remove=function(a){for(var b=this.heap.length,c=0;b>c;c++)if(this.compareFunc(this.heap[c],a)){var d=this.heap[c],e=this.heap.pop();return c!==b-1&&(this.heap[c]=e,f(this.heap,this.weightFunc,c),g(this.heap,this.weightFunc,c)),d}return null},p.removeAll=function(){this.heap=[]},p.size=function(){return this.heap.length};var q=["beforeValidate","validate","afterValidate","beforeCreate","afterCreate","beforeUpdate","afterUpdate","beforeDestroy","afterDestroy"],r=a("mout/array/find"),s=a("mout/lang/isRegExp");b.exports={w:j,DSBinaryHeap:h,isBoolean:a("mout/lang/isBoolean"),isString:a("mout/lang/isString"),isArray:a("mout/lang/isArray"),isObject:a("mout/lang/isObject"),isNumber:a("mout/lang/isNumber"),isFunction:m,isEmpty:a("mout/lang/isEmpty"),isRegExp:s,toJson:JSON.stringify,fromJson:function(a){return this.isString(a)?JSON.parse(a):a},makePath:a("mout/string/makePath"),upperCase:a("mout/string/upperCase"),pascalCase:a("mout/string/pascalCase"),deepMixIn:a("mout/object/deepMixIn"),mixIn:a("mout/object/mixIn"),forOwn:a("mout/object/forOwn"),forEach:a("mout/array/forEach"),pick:a("mout/object/pick"),set:a("mout/object/set"),merge:a("mout/object/merge"),contains:a("mout/array/contains"),filter:a("mout/array/filter"),find:r,toLookup:a("mout/array/toLookup"),remove:a("mout/array/remove"),slice:a("mout/array/slice"),sort:a("mout/array/sort"),_:function(a,b){var c=this;if(b=b||{},b&&b.constructor===a.constructor)return b;if(!c.isObject(b))throw new l.IA('"options" must be an object!');c.forEach(q,function(a){"function"==typeof b[a]&&-1===b[a].toString().indexOf("var args = Array")&&(b[a]=c.promisify(b[a]))});var d=function(a){c.mixIn(this,a)};return d.prototype=a,new d(b)},resolveItem:function(a,b){return a&&(this.isString(b)||this.isNumber(b))?a.index[b]||b:b
},resolveId:function(a,b){return this.isString(b)||this.isNumber(b)?b:b&&a?b[a.idAttribute]||b:b},updateTimestamp:d,Promise:k,compute:function(a,b,c){var d=this,e=[];c.forEach(a.deps,function(a){e.push(d[a])}),this[b]=a[a.length-1].apply(this,e)},diffObjectFromOldObject:function(a,b,c){var d={},e={},f={};c=c||[];for(var g in b){var h=a[g];i(g,c)||(void 0===h||h!==b[g])&&(g in a?h!==b[g]&&(f[g]=h):e[g]=void 0)}for(var j in a)j in b||i(j,c)||(d[j]=a[j]);return{added:d,removed:e,changed:f}},promisify:function(a,b){var c=this.Promise;if(a){if("function"!=typeof a)throw new Error("Can only promisify functions!");return function(){var d=Array.prototype.slice.apply(arguments);return new c(function(c,e){d.push(function(a,b){a?e(a):c(b)});try{var f=a.apply(b||this,d);f&&f.then&&f.then(c,e)}catch(g){e(g)}})}}},Events:e}},{"./errors":105,bluebird:4,"es6-promise":37,"mout/array/contains":39,"mout/array/filter":40,"mout/array/find":41,"mout/array/forEach":43,"mout/array/remove":46,"mout/array/slice":47,"mout/array/sort":48,"mout/array/toLookup":49,"mout/lang/isArray":55,"mout/lang/isBoolean":56,"mout/lang/isEmpty":57,"mout/lang/isFunction":58,"mout/lang/isNumber":60,"mout/lang/isObject":61,"mout/lang/isRegExp":63,"mout/lang/isString":64,"mout/object/deepMixIn":68,"mout/object/forOwn":70,"mout/object/merge":72,"mout/object/mixIn":73,"mout/object/pick":75,"mout/object/set":76,"mout/string/makePath":79,"mout/string/pascalCase":80,"mout/string/upperCase":83}]},{},[106])(106)});